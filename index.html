
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Trading Manager Pro - AriParFue Trader</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body {
            margin: 0;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background-color: #1a1d29;
            color: #E8ECEF;
        }
        #root {
            width: 100%;
            min-height: 100vh;
        }
        
        /* RESPONSIVE DESIGN */
        @media (max-width: 768px) {
            .desktop-only { display: none !important; }
            .mobile-stack { flex-direction: column !important; }
            .mobile-full { width: 100% !important; }
            .mobile-small { font-size: 0.8rem !important; }
            .mobile-padding { padding: 1rem !important; }
        }
    </style>
</head>
<body>
    <div id="root"></div>
    
    <script type="text/babel">
        const { useState, useEffect } = React;

        // Initialize Supabase
        const supabaseUrl = 'https://rdnxrmmgcsieuttwucty.supabase.co';
        const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InJkbnhybW1nY3NpZXV0dHd1Y3R5Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjkxODQxNTIsImV4cCI6MjA4NDc2MDE1Mn0.aAeygiTwO9TvFJcrpVYe5GYpOYStiGtTwPmWrk5D6n4';
        const supabaseClient = supabase.createClient(supabaseUrl, supabaseKey);
        
        const REAL_USER_ID = 'd4c4fa87-3488-483e-bd0f-11908186bc83';

        const formatCurrency = (value) => {
            const numValue = parseFloat(value) || 0;
            
            // For very small values (< 0.01), show up to 8 decimals
            if (numValue > 0 && numValue < 0.01) {
                // Count significant digits after decimal point
                const str = numValue.toString();
                const decimalPart = str.split('.')[1] || '';
                let significantDecimals = 0;
                
                // Find first non-zero digit and add 2 more digits
                for (let i = 0; i < decimalPart.length; i++) {
                    if (decimalPart[i] !== '0') {
                        significantDecimals = Math.min(i + 3, 8); // Show up to 8 decimals max
                        break;
                    }
                }
                
                return new Intl.NumberFormat('es-ES', { 
                    style: 'currency', 
                    currency: 'USD',
                    minimumFractionDigits: significantDecimals,
                    maximumFractionDigits: significantDecimals
                }).format(numValue);
            }
            
            // For normal values (>= 0.01), use 2 decimals
            return new Intl.NumberFormat('es-ES', { 
                style: 'currency', 
                currency: 'USD',
                minimumFractionDigits: 2,
                maximumFractionDigits: 2
            }).format(numValue);
        };

        function TradingApp() {
            const [user, setUser] = useState(null);
            const [loading, setLoading] = useState(true);
            const [currentView, setCurrentView] = useState('dashboard');
            const [selectedOperation, setSelectedOperation] = useState(null);
            const [operationEntries, setOperationEntries] = useState([]);
            const [operationTPs, setOperationTPs] = useState([]);
            const [showConfigureTPs, setShowConfigureTPs] = useState(false);
            const [tpConfig, setTpConfig] = useState([]);
            const [savingTPs, setSavingTPs] = useState(false);
            const [tpError, setTpError] = useState('');
            const [showAddMargin, setShowAddMargin] = useState(false);
            const [newMargin, setNewMargin] = useState('');
            const [marginError, setMarginError] = useState('');
            const [savingMargin, setSavingMargin] = useState(false);
            const [showRemoveMargin, setShowRemoveMargin] = useState(false);
            const [marginToRemove, setMarginToRemove] = useState('');
            const [newSpotOperation, setNewSpotOperation] = useState({
                crypto: '',
                type: 'LONG',
                capital: '',
                entryPrice: '',
                operationDate: new Date().toISOString().slice(0, 16) // YYYY-MM-DDTHH:MM
            });
            const [spotOperationError, setSpotOperationError] = useState('');
            const [savingSpotOperation, setSavingSpotOperation] = useState(false);
            const [showAddEntry, setShowAddEntry] = useState(false);
            const [newEntry, setNewEntry] = useState({
                entryPrice: '',
                margin: '',
                entryDate: new Date().toISOString().slice(0, 16) // YYYY-MM-DDTHH:MM
            });
            const [entryError, setEntryError] = useState('');
            const [savingEntry, setSavingEntry] = useState(false);
            const [operations, setOperations] = useState([]);
            const [spotOperations, setSpotOperations] = useState([]);
            const [activeTab, setActiveTab] = useState('futuros');
            const [activeAnalyticsTab, setActiveAnalyticsTab] = useState('distribution');
            const [closedOperations, setClosedOperations] = useState([]);
            const [selectedClosedOperation, setSelectedClosedOperation] = useState(null);
            const [closedOperationEntries, setClosedOperationEntries] = useState([]);
            const [closedOperationTPs, setClosedOperationTPs] = useState([]);
            const [portfolio, setPortfolio] = useState({ totalCapital: 98500, availableLiquidity: 98500 });
            const [email, setEmail] = useState('');
            const [password, setPassword] = useState('');
            const [authError, setAuthError] = useState('');
            const [connectionStatus, setConnectionStatus] = useState('Conectando...');

            // Nueva operaci√≥n state
            const [newOperation, setNewOperation] = useState({
                crypto: '',
                type: 'LONG',
                operationType: 'futuros',
                leverage: 1,
                ownCapital: '',
                entryPrice: '',
                operationDate: new Date().toISOString().slice(0, 16) // YYYY-MM-DDTHH:MM
            });
            const [operationError, setOperationError] = useState('');
            const [saving, setSaving] = useState(false);

            useEffect(() => {
                setLoading(false);
            }, []);

            const testSupabaseConnection = async () => {
                try {
                    setConnectionStatus('Probando conexi√≥n...');
                    const { data, error } = await supabaseClient
                        .from('operations')
                        .select('count', { count: 'exact' })
                        .eq('user_id', REAL_USER_ID);
                    
                    if (error) throw error;
                    setConnectionStatus('‚úÖ Conectado a Supabase');
                    return true;
                } catch (error) {
                    setConnectionStatus('Error: ' + error.message);
                    return false;
                }
            };

            const loadOperations = async () => {
                try {
                    setConnectionStatus('Cargando operaciones...');
                    
                    const { data: operationsData, error: opsError } = await supabaseClient
                        .from('operations')
                        .select(`
                            id, crypto, type, operation_type, leverage,
                            own_capital, borrowed_capital, total_investment,
                            additional_margin, status, created_at
                        `)
                        .eq('user_id', REAL_USER_ID)
                        .eq('operation_type', 'futuros')
                        .eq('status', 'open')
                        .order('created_at', { ascending: false });

                    if (opsError) throw opsError;

                    const formattedOps = operationsData ? operationsData.map(op => ({
                        id: op.id,
                        crypto: op.crypto,
                        type: op.type,
                        operationType: op.operation_type || 'futuros',
                        leverage: op.leverage || 1,
                        ownCapital: parseFloat(op.own_capital) || 0,
                        borrowedCapital: parseFloat(op.borrowed_capital) || 0,
                        totalInvestment: parseFloat(op.total_investment) || 0,
                        additionalMargin: parseFloat(op.additional_margin) || 0,
                        createdAt: op.created_at
                    })) : [];

                    setOperations(formattedOps);

                    const capitalInvertido = formattedOps.reduce((sum, op) => 
                        sum + op.ownCapital + op.additionalMargin, 0);
                    
                    setPortfolio({
                        totalCapital: 98500,
                        availableLiquidity: 98500 - capitalInvertido
                    });

                    setConnectionStatus(`‚úÖ ${formattedOps.length + spotOperations.length} operaciones cargadas`);

                } catch (error) {
                    setConnectionStatus('Error: ' + error.message);
                }
            };

            const loadClosedOperations = async () => {
                try {
                    const { data: closedOpsData, error: closedError } = await supabaseClient
                        .from('operations')
                        .select(`
                            id, crypto, type, operation_type, leverage,
                            status, created_at
                        `)
                        .eq('user_id', REAL_USER_ID)
                        .eq('status', 'closed')
                        .order('created_at', { ascending: false });

                    if (closedError) throw closedError;

                    // Para cada operaci√≥n cerrada, calcular valores reales consolidados
                    const consolidatedOps = [];
                    
                    for (const op of closedOpsData || []) {
                        // Obtener todas las entradas DCA de esta operaci√≥n
                        const { data: entries, error: entriesError } = await supabaseClient
                            .from('entries')
                            .select('margin, executed, entry_price, units')
                            .eq('operation_id', op.id);

                        if (!entriesError && entries && entries.length > 0) {
                            // Calcular totales REALES de todas las entradas DCA
                            const totalRealMargin = entries.reduce((sum, entry) => sum + parseFloat(entry.margin || 0), 0);
                            const totalRealExecuted = entries.reduce((sum, entry) => sum + parseFloat(entry.executed || 0), 0);
                            const totalRealUnits = entries.reduce((sum, entry) => sum + parseFloat(entry.units || 0), 0);
                            const totalRealLeveraged = totalRealExecuted - totalRealMargin;
                            
                            // PEPP (Precio Entrada Promedio Ponderado) - CORREGIDO
                            const totalIPonderada = entries.reduce((sum, entry) => {
                                const executed = parseFloat(entry.executed || 0);
                                const price = parseFloat(entry.entry_price || 0);
                                return sum + (executed * price);
                            }, 0);
                            const pepp = totalRealExecuted > 0 ? totalIPonderada / totalRealExecuted : 0;

                            // Calcular fechas de apertura y cierre
                            const entryDates = entries.map(e => new Date(e.created_at)).sort((a, b) => a - b);
                            const openingDate = entryDates[0]; // Primera entrada DCA

                            // Buscar fecha del √∫ltimo TP ejecutado
                            const { data: executedTPs, error: tpError } = await supabaseClient
                                .from('take_profits')
                                .select('percentage, price, executed, created_at')
                                .eq('operation_id', op.id)
                                .eq('executed', true)
                                .order('created_at', { ascending: false });

                            let closingDate = openingDate;
                            let totalPnL = 0;
                            
                            if (!tpError && executedTPs && executedTPs.length > 0) {
                                // Usar fecha del TP si existe, sino usar fecha de creaci√≥n de la operaci√≥n como fallback
                                const lastTPDate = executedTPs[0].created_at;
                                closingDate = lastTPDate && lastTPDate !== null 
                                    ? new Date(lastTPDate) 
                                    : new Date(op.created_at); // Fallback para operaciones antiguas
                                
                                totalPnL = executedTPs.reduce((sum, tp) => {
                                    const unitsToSell = (totalRealUnits * tp.percentage) / 100;
                                    const profit = (tp.price - pepp) * unitsToSell;
                                    return sum + profit;
                                }, 0);
                            }

                            // Calcular duraci√≥n en d√≠as
                            const durationMs = closingDate.getTime() - openingDate.getTime();
                            const durationDays = Math.ceil(durationMs / (1000 * 60 * 60 * 24));

                            consolidatedOps.push({
                                id: op.id,
                                crypto: op.crypto,
                                type: op.type,
                                operationType: op.operation_type || 'futuros',
                                leverage: op.leverage || 1,
                                // Valores REALES consolidados de todas las entradas DCA
                                realMargin: totalRealMargin,
                                realLeveraged: totalRealLeveraged,
                                realTotalExecuted: totalRealExecuted,
                                realUnits: totalRealUnits,
                                pepp: pepp,
                                totalPnL: totalPnL,
                                // Fechas detalladas
                                openingDate: openingDate,
                                closingDate: closingDate,
                                durationDays: durationDays,
                                entriesCount: entries.length,
                                createdAt: op.created_at
                            });
                        } else {
                            // Fallback si no hay entradas (caso raro)
                            consolidatedOps.push({
                                id: op.id,
                                crypto: op.crypto,
                                type: op.type,
                                operationType: op.operation_type || 'futuros',
                                leverage: op.leverage || 1,
                                realMargin: 0,
                                realLeveraged: 0,
                                realTotalExecuted: 0,
                                realUnits: 0,
                                pepp: 0,
                                entriesCount: 0,
                                createdAt: op.created_at
                            });
                        }
                    }

                    setClosedOperations(consolidatedOps);
                    console.log('üìã Operaciones cerradas cargadas con valores consolidados:', consolidatedOps);

                } catch (error) {
                    console.error('Error cargando operaciones cerradas:', error);
                    setClosedOperations([]);
                }
            };

            const loadSpotOperations = async () => {
                try {
                    const { data: spotOpsData, error: spotError } = await supabaseClient
                        .from('operations')
                        .select(`
                            id, crypto, type, operation_type, leverage,
                            own_capital, borrowed_capital, total_investment,
                            additional_margin, status, created_at
                        `)
                        .eq('user_id', REAL_USER_ID)
                        .eq('operation_type', 'spot')
                        .eq('status', 'open')
                        .order('created_at', { ascending: false });

                    if (spotError) throw spotError;

                    const formattedSpotOps = spotOpsData ? spotOpsData.map(op => ({
                        id: op.id,
                        crypto: op.crypto,
                        type: op.type,
                        operationType: op.operation_type || 'spot',
                        leverage: 1, // SPOT siempre es 1x
                        ownCapital: parseFloat(op.own_capital) || 0,
                        borrowedCapital: 0, // SPOT sin apalancamiento
                        totalInvestment: parseFloat(op.own_capital) || 0,
                        additionalMargin: parseFloat(op.additional_margin) || 0,
                        createdAt: op.created_at
                    })) : [];

                    setSpotOperations(formattedSpotOps);
                    console.log('üìà Operaciones SPOT cargadas:', formattedSpotOps);

                } catch (error) {
                    console.error('Error cargando operaciones SPOT:', error);
                    setSpotOperations([]);
                }
            };

            const handleLogin = async (e) => {
                e.preventDefault();
                setAuthError('');
                
                if (email === 'admin' && password === 'admin') {
                    setUser({ 
                        id: 'admin-user',
                        email: 'admin@tradingpro.com',
                        role: 'admin'
                    });
                    
                    const connected = await testSupabaseConnection();
                    if (connected) {
                        await loadOperations();
                        await loadClosedOperations();
                        await loadSpotOperations();
                    }
                    return;
                }
                
                setAuthError('Usa: admin / admin para acceso de administrador');
            };

            const handleLogout = () => {
                setUser(null);
                setOperations([]);
                setEmail('');
                setPassword('');
                setCurrentView('dashboard');
                setConnectionStatus('Desconectado');
            };

            const checkAndFixOperations = async () => {
                if (!confirm('¬øRevisar y corregir operaciones que deber√≠an estar cerradas?')) {
                    return;
                }

                try {
                    console.log('üîç Revisando operaciones abiertas...');
                    
                    for (const operation of operations) {
                        const { data: tps, error } = await supabaseClient
                            .from('take_profits')
                            .select('percentage, executed')
                            .eq('operation_id', operation.id);

                        if (!error && tps) {
                            const totalExecuted = tps
                                .filter(tp => tp.executed === true)
                                .reduce((sum, tp) => sum + parseFloat(tp.percentage), 0);

                            console.log(`üìä Operaci√≥n ${operation.crypto}: ${totalExecuted}% ejecutado`);

                            if (totalExecuted >= 100) {
                                console.log(`üéØ Cerrando ${operation.crypto}...`);
                                
                                await supabaseClient
                                    .from('operations')
                                    .update({ status: 'closed' })
                                    .eq('id', operation.id);
                            }
                        }
                    }

                    await loadOperations();
                    await loadClosedOperations();
                    alert('‚úÖ Revisi√≥n completada');

                } catch (error) {
                    alert('Error: ' + error.message);
                }
            };

            const handleViewClosedDetail = async (closedOperation) => {
                try {
                    setSelectedClosedOperation(closedOperation);
                    setCurrentView('closed-detail');

                    // Cargar entradas de la operaci√≥n cerrada
                    const { data: entries, error: entriesError } = await supabaseClient
                        .from('entries')
                        .select('*')
                        .eq('operation_id', closedOperation.id)
                        .order('created_at', { ascending: false });

                    if (entriesError) throw entriesError;
                    setClosedOperationEntries(entries || []);

                    // Cargar TPs de la operaci√≥n cerrada
                    const { data: tps, error: tpsError } = await supabaseClient
                        .from('take_profits')
                        .select('*')
                        .eq('operation_id', closedOperation.id)
                        .order('level', { ascending: true });

                    if (tpsError) throw tpsError;

                    const formattedTPs = [];
                    for (let i = 1; i <= 5; i++) {
                        const existingTP = tps?.find(tp => tp.level === i);
                        formattedTPs.push({
                            number: i,
                            price: existingTP?.price || '',
                            percentage: existingTP?.percentage || '',
                            executed: existingTP?.executed || false,
                            executedDate: existingTP?.created_at || null,
                            id: existingTP?.id || null
                        });
                    }
                    setClosedOperationTPs(formattedTPs);

                } catch (error) {
                    console.error('Error cargando detalle de operaci√≥n cerrada:', error);
                    alert('Error: ' + error.message);
                }
            };

            const handleViewSpotDetail = async (spotOperation) => {
                try {
                    setSelectedOperation({
                        ...spotOperation,
                        additionalMargin: spotOperation.additionalMargin || 0
                    });
                    setCurrentView('spot-detail');
                    
                    console.log('üìà Cargando detalle operaci√≥n SPOT:', spotOperation.id);

                    // Cargar entradas de la operaci√≥n SPOT
                    const { data: entries, error: entriesError } = await supabaseClient
                        .from('entries')
                        .select('*')
                        .eq('operation_id', spotOperation.id)
                        .order('created_at', { ascending: false });

                    if (entriesError) throw entriesError;
                    setOperationEntries(entries || []);

                    // Cargar TPs de la operaci√≥n SPOT
                    const { data: tps, error: tpsError } = await supabaseClient
                        .from('take_profits')
                        .select('*')
                        .eq('operation_id', spotOperation.id)
                        .order('level', { ascending: true });

                    if (tpsError) throw tpsError;

                    const formattedTPs = [];
                    for (let i = 1; i <= 5; i++) {
                        const existingTP = tps?.find(tp => tp.level === i);
                        formattedTPs.push({
                            number: i,
                            price: existingTP?.price || '',
                            percentage: existingTP?.percentage || '',
                            executed: existingTP?.executed || false,
                            id: existingTP?.id || null
                        });
                    }
                    setOperationTPs(formattedTPs);
                    console.log('‚úÖ SPOT TPs cargados:', formattedTPs);

                } catch (error) {
                    console.error('Error cargando detalle SPOT:', error);
                    alert('Error: ' + error.message);
                }
            };

            const handleShowAddMargin = () => {
                setShowAddMargin(true);
                setNewMargin('');
                setMarginError('');
            };

            const handleAddMargin = async (e) => {
                e.preventDefault();
                setMarginError('');
                setSavingMargin(true);

                try {
                    if (!newMargin || parseFloat(newMargin) <= 0) {
                        throw new Error('El margen adicional debe ser mayor a 0');
                    }

                    const marginAmount = parseFloat(newMargin);
                    
                    // Verificar liquidez disponible
                    if (marginAmount > portfolio.availableLiquidity) {
                        throw new Error(`Liquidez insuficiente. Disponible: ${formatCurrency(portfolio.availableLiquidity)}`);
                    }

                    console.log('üí∞ Agregando margen adicional:', {
                        operacionId: selectedOperation.id,
                        margenActual: selectedOperation.additionalMargin,
                        nuevoMargen: marginAmount,
                        totalMargen: selectedOperation.additionalMargin + marginAmount
                    });

                    // Actualizar operaci√≥n con margen adicional
                    const newAdditionalMargin = selectedOperation.additionalMargin + marginAmount;
                    
                    const { error } = await supabaseClient
                        .from('operations')
                        .update({
                            additional_margin: newAdditionalMargin
                        })
                        .eq('id', selectedOperation.id);

                    if (error) throw error;

                    alert(`‚úÖ Margen adicional agregado exitosamente\n\n${formatCurrency(marginAmount)} agregado\nTotal margen adicional: ${formatCurrency(newAdditionalMargin)}\n\nüìâ Stop Danger reducido\nüõ°Ô∏è Riesgo de liquidaci√≥n menor`);

                    // Actualizar operaci√≥n local y recargar datos
                    setSelectedOperation({
                        ...selectedOperation,
                        additionalMargin: newAdditionalMargin
                    });

                    // Recargar dashboard y cerrar formulario
                    await loadOperations();
                    setNewMargin('');
                    setShowAddMargin(false);

                } catch (error) {
                    console.error('‚ùå Error agregando margen:', error);
                    setMarginError(error.message);
                } finally {
                    setSavingMargin(false);
                }
            };

            const handleShowRemoveMargin = () => {
                setShowRemoveMargin(true);
                setMarginToRemove('');
                setMarginError('');
            };

            const handleRemoveMargin = async (e) => {
                e.preventDefault();
                setMarginError('');
                setSavingMargin(true);

                try {
                    if (!marginToRemove || parseFloat(marginToRemove) <= 0) {
                        throw new Error('El monto a retirar debe ser mayor a 0');
                    }

                    const removeAmount = parseFloat(marginToRemove);
                    const currentAdditionalMargin = selectedOperation.additionalMargin || 0;
                    
                    // Validar que no retire m√°s del margen adicional disponible
                    if (removeAmount > currentAdditionalMargin) {
                        throw new Error(`Solo puedes retirar hasta ${formatCurrency(currentAdditionalMargin)} de margen adicional`);
                    }

                    // Calcular nuevo leverage efectivo despu√©s de retirar margen
                    const totalExecutedAmount = operationEntries.reduce((sum, entry) => sum + parseFloat(entry.executed || 0), 0);
                    const newTotalMargin = selectedOperation.ownCapital + (currentAdditionalMargin - removeAmount);
                    const newEffectiveLeverage = totalExecutedAmount / newTotalMargin;
                    
                    // Validar que el nuevo leverage no supere el original + un buffer de seguridad
                    const maxSafeLeverage = selectedOperation.leverage * 0.9; // 10% de margen de seguridad
                    if (newEffectiveLeverage > maxSafeLeverage) {
                        const minSafeMargin = totalExecutedAmount / maxSafeLeverage;
                        const maxRemovable = (selectedOperation.ownCapital + currentAdditionalMargin) - minSafeMargin;
                        throw new Error(`Retirar ${formatCurrency(removeAmount)} aumentar√≠a el riesgo demasiado. M√°ximo retirable: ${formatCurrency(Math.max(0, maxRemovable))}`);
                    }

                    console.log('üí∏ Retirando margen:', {
                        operacionId: selectedOperation.id,
                        margenActual: currentAdditionalMargin,
                        montoRetirar: removeAmount,
                        nuevoMargen: currentAdditionalMargin - removeAmount
                    });

                    // Actualizar operaci√≥n con menos margen adicional
                    const newAdditionalMargin = currentAdditionalMargin - removeAmount;
                    
                    const { error } = await supabaseClient
                        .from('operations')
                        .update({
                            additional_margin: newAdditionalMargin
                        })
                        .eq('id', selectedOperation.id);

                    if (error) throw error;

                    alert(`‚úÖ Margen retirado exitosamente\n\n${formatCurrency(removeAmount)} retirado\nMargen adicional restante: ${formatCurrency(newAdditionalMargin)}\n\nüìà Liquidez disponible aumentada\n‚ö†Ô∏è Riesgo ligeramente incrementado`);

                    // Actualizar operaci√≥n local y recargar datos
                    setSelectedOperation({
                        ...selectedOperation,
                        additionalMargin: newAdditionalMargin
                    });

                    // Recargar dashboard y cerrar formulario
                    await loadOperations();
                    setMarginToRemove('');
                    setShowRemoveMargin(false);

                } catch (error) {
                    console.error('‚ùå Error retirando margen:', error);
                    setMarginError(error.message);
                } finally {
                    setSavingMargin(false);
                }
            };

            const handleCreateSpotOperation = async (e) => {
                e.preventDefault();
                setSpotOperationError('');
                setSavingSpotOperation(true);

                try {
                    if (!newSpotOperation.crypto.trim()) {
                        throw new Error('Ingresa el nombre de la criptomoneda');
                    }
                    if (!newSpotOperation.capital || parseFloat(newSpotOperation.capital) <= 0) {
                        throw new Error('El capital debe ser mayor a 0');
                    }
                    if (!newSpotOperation.entryPrice || parseFloat(newSpotOperation.entryPrice) <= 0) {
                        throw new Error('El precio de entrada debe ser mayor a 0');
                    }

                    const capital = parseFloat(newSpotOperation.capital);
                    const entryPrice = parseFloat(newSpotOperation.entryPrice);

                    // Verificar liquidez disponible
                    if (capital > portfolio.availableLiquidity) {
                        throw new Error(`Liquidez insuficiente. Disponible: ${formatCurrency(portfolio.availableLiquidity)}`);
                    }

                    console.log('üìà Creando operaci√≥n SPOT:', {
                        crypto: newSpotOperation.crypto.toUpperCase(),
                        type: newSpotOperation.type,
                        capital,
                        entryPrice
                    });

                    // PASO 1: Crear operaci√≥n SPOT (sin apalancamiento)
                    const customDate = new Date(newSpotOperation.operationDate).toISOString();
                    const { data, error } = await supabaseClient
                        .from('operations')
                        .insert({
                            user_id: REAL_USER_ID,
                            crypto: newSpotOperation.crypto.toUpperCase(),
                            type: newSpotOperation.type,
                            operation_type: 'spot',
                            leverage: 1, // SPOT siempre 1x
                            own_capital: capital,
                            borrowed_capital: 0, // SPOT sin apalancamiento
                            total_investment: capital, // SPOT: capital = inversi√≥n
                            additional_margin: 0,
                            status: 'open',
                            created_at: customDate
                        })
                        .select();

                    if (error) throw error;

                    const newOperationId = data[0].id;
                    console.log('‚úÖ Operaci√≥n SPOT creada con ID:', newOperationId);

                    // PASO 2: Crear entrada inicial autom√°ticamente
                    const unitsSpot = capital / entryPrice; // SPOT: capital directo / precio
                    const iPonderada = capital * entryPrice;

                    const { error: entryError } = await supabaseClient
                        .from('entries')
                        .insert({
                            operation_id: newOperationId,
                            entry_price: entryPrice,
                            margin: capital, // En SPOT el margen = capital total
                            executed: capital, // En SPOT ejecutado = capital (sin leverage)
                            units: unitsSpot,
                            i_ponderada: iPonderada,
                            created_at: customDate
                        });

                    if (entryError) {
                        console.error('‚ö†Ô∏è Error creando entrada inicial SPOT:', entryError);
                    } else {
                        console.log('‚úÖ Entrada inicial SPOT creada exitosamente');
                    }

                    alert(`‚úÖ Operaci√≥n SPOT creada exitosamente\n\n${newSpotOperation.type} ${newSpotOperation.crypto}\nCapital: ${formatCurrency(capital)}\nUnidades: ${unitsSpot.toFixed(8)}`);

                    // Resetear formulario
                    setNewSpotOperation({
                        crypto: '',
                        type: 'LONG',
                        capital: '',
                        entryPrice: '',
                        operationDate: new Date().toISOString().slice(0, 16)
                    });

                    // Recargar datos y volver al dashboard SPOT
                    await loadOperations();
                    await loadSpotOperations();
                    setCurrentView('spot');

                } catch (error) {
                    console.error('‚ùå Error:', error);
                    setSpotOperationError(error.message);
                } finally {
                    setSavingSpotOperation(false);
                }
            };

            const handleDeleteOperation = async (operationId) => {
                if (!user || user.role !== 'admin') return;
                if (!confirm('¬øEst√°s seguro de que quieres eliminar esta operaci√≥n?')) return;

                try {
                    setConnectionStatus('Eliminando operaci√≥n...');
                    const { error } = await supabaseClient
                        .from('operations')
                        .delete()
                        .eq('id', operationId);

                    if (error) throw error;
                    alert('‚úÖ Operaci√≥n eliminada correctamente');
                    await loadOperations();
                } catch (error) {
                    alert('Error: ' + error.message);
                }
            };

            // Same function for SPOT operations
            const handleDeleteSpotOperation = async (operationId) => {
                if (!user || user.role !== 'admin') return;
                if (!confirm('¬øEst√°s seguro de que quieres eliminar esta operaci√≥n SPOT?')) return;

                try {
                    setConnectionStatus('Eliminando operaci√≥n SPOT...');
                    const { error } = await supabaseClient
                        .from('operations')
                        .delete()
                        .eq('id', operationId);

                    if (error) throw error;
                    alert('‚úÖ Operaci√≥n SPOT eliminada correctamente');
                    await loadSpotOperations();
                } catch (error) {
                    alert('Error: ' + error.message);
                }
            };

            // Cleanup closed operations function
            const handleCleanupClosedOperations = async () => {
                if (!user || user.role !== 'admin') return;
                if (!confirm(`‚ö†Ô∏è ¬øEliminar ${closedOperations.length} operaciones cerradas?\n\nEsta acci√≥n NO se puede deshacer.`)) return;
                
                try {
                    setConnectionStatus('Limpiando historial...');
                    const { error } = await supabaseClient
                        .from('operations')
                        .delete()
                        .eq('user_id', REAL_USER_ID)
                        .eq('status', 'closed');
                        
                    if (error) throw error;
                    
                    await loadClosedOperations(); // Reload to refresh the view
                    setConnectionStatus('‚úÖ Historial limpiado');
                    alert('‚úÖ Historial limpiado correctamente');
                } catch (error) {
                    console.error('Error:', error);
                    setConnectionStatus('‚ùå Error al limpiar');
                    alert('‚ùå Error al limpiar el historial');
                }
            };

            const handleViewDetail = (operation) => {
                setSelectedOperation(operation);
                setCurrentView('detail');
                loadOperationEntries(operation.id);
                loadOperationTPs(operation.id);
            };

            const loadOperationEntries = async (operationId) => {
                try {
                    const { data: entries, error } = await supabaseClient
                        .from('entries')
                        .select('*')
                        .eq('operation_id', operationId)
                        .order('created_at', { ascending: false });

                    if (error) throw error;

                    const formattedEntries = entries || [];
                    setOperationEntries(formattedEntries);
                } catch (error) {
                    console.error('Error cargando entradas:', error);
                    setOperationEntries([]);
                }
            };

            const loadOperationTPs = async (operationId) => {
                try {
                    const { data: tps, error } = await supabaseClient
                        .from('take_profits')
                        .select('*')
                        .eq('operation_id', operationId)
                        .order('level', { ascending: true });

                    if (error) throw error;

                    // Crear array de 5 TPs (del 1 al 5)
                    const tpArray = [];
                    for (let i = 1; i <= 5; i++) {
                        const existingTP = tps?.find(tp => tp.level === i);
                        tpArray.push({
                            number: i,
                            price: existingTP?.price || '',
                            percentage: existingTP?.percentage || '',
                            executed: existingTP?.executed || false,
                            id: existingTP?.id || null
                        });
                    }

                    setOperationTPs(tpArray);
                } catch (error) {
                    console.error('Error cargando TPs:', error);
                    // Crear array vac√≠o con 5 TPs
                    const emptyTPs = [];
                    for (let i = 1; i <= 5; i++) {
                        emptyTPs.push({
                            number: i,
                            price: '',
                            percentage: '',
                            executed: false,
                            id: null
                        });
                    }
                    setOperationTPs(emptyTPs);
                }
            };

            const handleShowAddEntry = () => {
                setShowAddEntry(true);
                const now = new Date();
                setNewEntry({
                    entryPrice: '',
                    margin: '',
                    date: now.toISOString().split('T')[0],
                    time: now.toTimeString().split(' ')[0].substring(0, 5)
                });
                setEntryError('');
            };

            const handleAddEntry = async (e) => {
                e.preventDefault();
                setEntryError('');
                setSavingEntry(true);

                try {
                    if (!newEntry.entryPrice || parseFloat(newEntry.entryPrice) <= 0) {
                        throw new Error('El precio de entrada debe ser mayor a 0');
                    }
                    if (!newEntry.margin || parseFloat(newEntry.margin) <= 0) {
                        throw new Error('El margen debe ser mayor a 0');
                    }

                    const entryPrice = parseFloat(newEntry.entryPrice);
                    const margin = parseFloat(newEntry.margin);
                    
                    // Detectar si es operaci√≥n SPOT o Futuros
                    const isSpotOperation = selectedOperation.operationType === 'spot' || selectedOperation.leverage === 1;
                    const leverage = isSpotOperation ? 1 : selectedOperation.leverage;
                    
                    // C√°lculos para la entrada (adaptados para SPOT)
                    const executed = isSpotOperation ? margin : margin * leverage; // SPOT: margin = executed (1:1)
                    const units = executed / entryPrice;
                    const iPonderada = executed * entryPrice;

                    console.log(`üìù Creando entrada ${isSpotOperation ? 'SPOT' : 'FUTUROS'}:`, {
                        operationId: selectedOperation.id,
                        type: isSpotOperation ? 'SPOT' : 'FUTUROS',
                        entryPrice,
                        margin,
                        executed,
                        units,
                        iPonderada,
                        leverage
                    });

                    // Usar fecha personalizada del formulario
                    const entryDateTime = new Date(newEntry.entryDate);

                    console.log('üìù Creando entrada:', {
                        operationId: selectedOperation.id,
                        entryPrice,
                        margin,
                        executed,
                        units,
                        iPonderada
                    });

                    const { data, error } = await supabaseClient
                        .from('entries')
                        .insert({
                            operation_id: selectedOperation.id,
                            entry_price: entryPrice,
                            margin: margin,
                            executed: executed,
                            units: units,
                            i_ponderada: iPonderada,
                            created_at: entryDateTime.toISOString()
                        })
                        .select();

                    if (error) throw error;

                    console.log('‚úÖ Entrada creada exitosamente:', data);
                    alert('‚úÖ Entrada agregada exitosamente');

                    // Resetear formulario y recargar
                    setNewEntry({
                        entryPrice: '',
                        margin: '',
                        entryDate: new Date().toISOString().slice(0, 16)
                    });
                    setShowAddEntry(false);
                    await loadOperationEntries(selectedOperation.id);

                } catch (error) {
                    console.error('‚ùå Error:', error);
                    setEntryError(error.message);
                } finally {
                    setSavingEntry(false);
                }
            };

            const handleConfigureTPs = () => {
                setShowConfigureTPs(true);
                // Inicializar configuraci√≥n con valores existentes
                const initialConfig = operationTPs.map(tp => ({
                    number: tp.number,
                    price: tp.price || '',
                    percentage: tp.percentage || ''
                }));
                setTpConfig(initialConfig);
                setTpError('');
            };

            const handleSaveTPs = async () => {
                setSavingTPs(true);
                setTpError('');

                try {
                    console.log('üíæ Guardando configuraci√≥n de TPs:', tpConfig);

                    // Validar que al menos un TP est√© configurado
                    const configuredTPs = tpConfig.filter(tp => tp.price && tp.percentage);
                    if (configuredTPs.length === 0) {
                        throw new Error('Configura al menos un Take Profit');
                    }

                    // Validar rangos
                    for (const tp of configuredTPs) {
                        if (parseFloat(tp.price) <= 0) {
                            throw new Error(`TP${tp.number}: El precio debe ser mayor a 0`);
                        }
                        if (parseFloat(tp.percentage) <= 0 || parseFloat(tp.percentage) > 100) {
                            throw new Error(`TP${tp.number}: El porcentaje debe estar entre 1 y 100`);
                        }
                    }

                    // Eliminar TPs existentes de esta operaci√≥n
                    await supabaseClient
                        .from('take_profits')
                        .delete()
                        .eq('operation_id', selectedOperation.id);

                    // Insertar TPs configurados
                    const tpsToInsert = configuredTPs.map(tp => ({
                        operation_id: selectedOperation.id,
                        level: tp.number,
                        price: parseFloat(tp.price),
                        percentage: parseFloat(tp.percentage),
                        executed: false,
                        status: 'pending'
                    }));

                    if (tpsToInsert.length > 0) {
                        const { error } = await supabaseClient
                            .from('take_profits')
                            .insert(tpsToInsert);

                        if (error) throw error;
                    }

                    console.log('‚úÖ TPs guardados exitosamente');
                    alert('‚úÖ Take Profits configurados exitosamente');

                    // Recargar TPs y cerrar formulario
                    await loadOperationTPs(selectedOperation.id);
                    setShowConfigureTPs(false);

                } catch (error) {
                    console.error('‚ùå Error:', error);
                    setTpError(error.message);
                } finally {
                    setSavingTPs(false);
                }
            };

            const updateTPConfig = (index, field, value) => {
                const updated = [...tpConfig];
                updated[index][field] = value;
                setTpConfig(updated);
            };

            const handleExecuteTP = async (tp, isSpot = false) => {
                // Detectar si es SPOT o usar par√°metros espec√≠ficos
                const operationType = isSpot || selectedOperation.operationType === 'spot' ? 'SPOT' : 'FUTUROS';
                
                if (!confirm(`¬øEjecutar ${tp.number === 1 ? 'TP1' : tp.number === 2 ? 'TP2' : tp.number === 3 ? 'TP3' : tp.number === 4 ? 'TP4' : 'TP5'} ${operationType} a ${formatCurrency(tp.price)}?`)) {
                    return;
                }

                try {
                    console.log(`üéØ Ejecutando TP ${operationType}:`, tp);
                    
                    // Calcular totales para la operaci√≥n actual
                    const currentTotalUnits = operationEntries.reduce((sum, entry) => sum + parseFloat(entry.units || 0), 0);
                    const currentTotalExecuted = operationEntries.reduce((sum, entry) => sum + parseFloat(entry.executed || 0), 0);
                    const currentTotalIPonderada = operationEntries.reduce((sum, entry) => sum + parseFloat(entry.i_ponderada || 0), 0);
                    const currentPEPP = currentTotalExecuted > 0 ? currentTotalIPonderada / currentTotalExecuted : 0;
                    
                    // C√°lculos para la ejecuci√≥n
                    const unitsToSell = (currentTotalUnits * tp.percentage) / 100;
                    const executedAmount = unitsToSell * tp.price;
                    const profit = (tp.price - currentPEPP) * unitsToSell;
                    
                    console.log('üìä C√°lculos TP:', {
                        unitsToSell,
                        executedAmount,
                        profit,
                        currentPEPP: pepp,
                        tpPrice: tp.price
                    });

                    // Marcar TP como ejecutado en Supabase
                    const { error } = await supabaseClient
                        .from('take_profits')
                        .update({ 
                            executed: true
                        })
                        .eq('id', tp.id);

                    if (error) throw error;

                    // Actualizar la operaci√≥n reduciendo el capital proporcionalmente
                    // Para SPOT: solo capital propio, sin apalancamiento
                    const isSpotOp = isSpot || selectedOperation.operationType === 'spot' || selectedOperation.leverage === 1;
                    
                    if (isSpotOp) {
                        // SPOT: Solo reducir capital propio (sin borrowed capital)
                        const totalRealMargin = operationEntries.reduce((sum, entry) => sum + parseFloat(entry.margin || 0), 0);
                        const reductionPercentage = tp.percentage / 100;
                        const marginToReduce = totalRealMargin * reductionPercentage;
                        const newOwnCapital = totalRealMargin - marginToReduce;

                        console.log('üí∞ Actualizando capital SPOT:', {
                            antes: { margen: totalRealMargin },
                            reduccion: { porcentaje: tp.percentage + '%', margen: marginToReduce },
                            despues: { margen: newOwnCapital }
                        });

                        const { error: updateError } = await supabaseClient
                            .from('operations')
                            .update({
                                own_capital: newOwnCapital,
                                borrowed_capital: 0, // SPOT no tiene capital prestado
                                total_investment: newOwnCapital // SPOT: capital = inversi√≥n
                            })
                            .eq('id', selectedOperation.id);

                        if (updateError) {
                            console.error('‚ö†Ô∏è Error actualizando operaci√≥n SPOT:', updateError);
                        }
                    } else {
                        // FUTUROS: Reducir tanto capital propio como prestado
                        const totalRealMargin = operationEntries.reduce((sum, entry) => sum + parseFloat(entry.margin || 0), 0);
                        const totalRealExecuted = operationEntries.reduce((sum, entry) => sum + parseFloat(entry.executed || 0), 0);
                        const totalRealLeveraged = totalRealExecuted - totalRealMargin;
                        
                        const reductionPercentage = tp.percentage / 100;
                        const marginToReduce = totalRealMargin * reductionPercentage;
                        const leveragedToReduce = totalRealLeveraged * reductionPercentage;
                        
                        const newOwnCapital = totalRealMargin - marginToReduce;
                        const newBorrowedCapital = totalRealLeveraged - leveragedToReduce;
                        const newTotalInvestment = newOwnCapital + newBorrowedCapital;

                        console.log('üí∞ Actualizando capital FUTUROS:', {
                            antes: { margen: totalRealMargin, prestado: totalRealLeveraged, total: totalRealExecuted },
                            reduccion: { porcentaje: tp.percentage + '%', margen: marginToReduce, prestado: leveragedToReduce },
                            despues: { margen: newOwnCapital, prestado: newBorrowedCapital, total: newTotalInvestment }
                        });

                        const { error: updateError } = await supabaseClient
                            .from('operations')
                            .update({
                                own_capital: newOwnCapital,
                                borrowed_capital: newBorrowedCapital,
                                total_investment: newTotalInvestment
                            })
                            .eq('id', selectedOperation.id);

                        if (updateError) {
                            console.error('‚ö†Ô∏è Error actualizando operaci√≥n FUTUROS:', updateError);
                        }
                    }

                    // Verificar si la operaci√≥n debe cerrarse (100% ejecutado)
                    const { data: allTPs, error: tpCheckError } = await supabaseClient
                        .from('take_profits')
                        .select('percentage, executed')
                        .eq('operation_id', selectedOperation.id);

                    if (!tpCheckError && allTPs) {
                        const totalExecutedPercentage = allTPs
                            .filter(tp => tp.executed === true)
                            .reduce((sum, tp) => sum + (parseFloat(tp.percentage) || 0), 0);

                        console.log('üìä An√°lisis de cierre autom√°tico:', {
                            operationId: selectedOperation.id,
                            tpsEncontrados: allTPs.length,
                            tpsEjecutados: allTPs.filter(tp => tp.executed === true).length,
                            porcentajes: allTPs.map(tp => ({ percentage: tp.percentage, executed: tp.executed })),
                            totalEjecutado: totalExecutedPercentage + '%'
                        });

                        // Si se ejecut√≥ 100% o m√°s, cerrar la operaci√≥n
                        if (totalExecutedPercentage >= 100) {
                            console.log('üéØ Cerrando operaci√≥n autom√°ticamente...');
                            
                            const { error: closeError } = await supabaseClient
                                .from('operations')
                                .update({
                                    status: 'closed'
                                })
                                .eq('id', selectedOperation.id);

                            if (closeError) {
                                console.error('‚ö†Ô∏è Error cerrando operaci√≥n:', closeError);
                            } else {
                                console.log('üéâ Operaci√≥n cerrada autom√°ticamente (100% ejecutado)');
                                alert(`üéâ ¬°Operaci√≥n ${selectedOperation.crypto} cerrada completamente!\n\nTodos los TPs ejecutados (${totalExecutedPercentage}%)\nLa operaci√≥n se movi√≥ a "Operaciones Cerradas"`);
                                
                                // Recargar operaciones cerradas y volver al dashboard
                                await loadClosedOperations();
                                setCurrentView('dashboard');
                            }
                        } else {
                            console.log(`üìä Operaci√≥n a√∫n abierta: ${totalExecutedPercentage}% ejecutado`);
                        }
                    }

                    console.log('‚úÖ TP marcado como ejecutado');
                    const tpName = tp.number === 1 ? 'TP1' : tp.number === 2 ? 'TP2' : tp.number === 3 ? 'TP3' : tp.number === 4 ? 'TP4' : 'TP5';
                    alert(`‚úÖ ${tpName} ${operationType} ejecutado exitosamente\n\nProfit: ${formatCurrency(profit)}\nUnidades vendidas: ${unitsToSell.toFixed(8)} ${selectedOperation.crypto}\nPrecio: ${formatCurrency(tp.price)}\nPorcentaje: ${tp.percentage}%`);

                    // Recargar TPs y operaciones para actualizar dashboard
                    await loadOperationTPs(selectedOperation.id);
                    await loadOperations(); // Actualiza m√©tricas del dashboard
                    await loadSpotOperations(); // Actualiza operaciones SPOT
                    
                    // Recargar la operaci√≥n actual para actualizar Ver Detalle
                    const { data: updatedOp, error: opError } = await supabaseClient
                        .from('operations')
                        .select(`
                            id, crypto, type, operation_type, leverage,
                            own_capital, borrowed_capital, total_investment,
                            additional_margin, status, created_at
                        `)
                        .eq('id', selectedOperation.id)
                        .single();
                    
                    if (!opError && updatedOp) {
                        const refreshedOperation = {
                            id: updatedOp.id,
                            crypto: updatedOp.crypto,
                            type: updatedOp.type,
                            operationType: updatedOp.operation_type || 'futuros',
                            leverage: updatedOp.leverage || 1,
                            ownCapital: parseFloat(updatedOp.own_capital) || 0,
                            borrowedCapital: parseFloat(updatedOp.borrowed_capital) || 0,
                            totalInvestment: parseFloat(updatedOp.total_investment) || 0,
                            additionalMargin: parseFloat(updatedOp.additional_margin) || 0,
                            createdAt: updatedOp.created_at
                        };
                        setSelectedOperation(refreshedOperation);
                    }

                } catch (error) {
                    console.error('‚ùå Error ejecutando TP:', error);
                    alert('Error: ' + error.message);
                }
            };

            const handleCreateOperation = async (e) => {
                e.preventDefault();
                setOperationError('');
                setSaving(true);

                try {
                    if (!newOperation.crypto.trim()) {
                        throw new Error('Ingresa el nombre de la criptomoneda');
                    }
                    if (!newOperation.ownCapital || parseFloat(newOperation.ownCapital) <= 0) {
                        throw new Error('El capital propio debe ser mayor a 0');
                    }
                    if (!newOperation.entryPrice || parseFloat(newOperation.entryPrice) <= 0) {
                        throw new Error('El precio de entrada debe ser mayor a 0');
                    }

                    const ownCapital = parseFloat(newOperation.ownCapital);
                    const leverage = parseInt(newOperation.leverage);
                    const entryPrice = parseFloat(newOperation.entryPrice);
                    const borrowedCapital = ownCapital * (leverage - 1);
                    const totalInvestment = ownCapital + borrowedCapital;

                    console.log('üìù Creando operaci√≥n:', {
                        crypto: newOperation.crypto.toUpperCase(),
                        ownCapital,
                        leverage,
                        entryPrice
                    });

                    // PASO 1: Crear operaci√≥n
                    const customDate = new Date(newOperation.operationDate).toISOString();
                    const { data, error } = await supabaseClient
                        .from('operations')
                        .insert({
                            user_id: REAL_USER_ID,
                            crypto: newOperation.crypto.toUpperCase(),
                            type: newOperation.type,
                            operation_type: newOperation.operationType,
                            leverage: leverage,
                            own_capital: ownCapital,
                            borrowed_capital: borrowedCapital,
                            total_investment: totalInvestment,
                            additional_margin: 0,
                            status: 'open',
                            created_at: customDate
                        })
                        .select();

                    if (error) throw error;

                    const newOperationId = data[0].id;
                    console.log('‚úÖ Operaci√≥n creada con ID:', newOperationId);

                    // PASO 2: Crear entrada inicial autom√°ticamente
                    const executed = ownCapital * leverage;
                    const units = executed / entryPrice;
                    const iPonderada = executed * entryPrice;

                    console.log('üìù Creando entrada inicial:', {
                        operationId: newOperationId,
                        entryPrice,
                        margin: ownCapital,
                        executed,
                        units
                    });

                    const { error: entryError } = await supabaseClient
                        .from('entries')
                        .insert({
                            operation_id: newOperationId,
                            entry_price: entryPrice,
                            margin: ownCapital,
                            executed: executed,
                            units: units,
                            i_ponderada: iPonderada,
                            created_at: customDate
                        });

                    if (entryError) {
                        console.error('‚ö†Ô∏è Error creando entrada inicial:', entryError);
                        // No lanzamos error, la operaci√≥n se cre√≥ exitosamente
                    } else {
                        console.log('‚úÖ Entrada inicial creada exitosamente');
                    }

                    alert('‚úÖ Operaci√≥n y entrada inicial creadas exitosamente');
                    setNewOperation({
                        crypto: '',
                        type: 'LONG',
                        operationType: 'futuros',
                        leverage: 1,
                        ownCapital: '',
                        entryPrice: '',
                        operationDate: new Date().toISOString().slice(0, 16)
                    });

                    await loadOperations();
                    setCurrentView('dashboard');

                } catch (error) {
                    setOperationError(error.message);
                } finally {
                    setSaving(false);
                }
            };

            const calculatePreview = () => {
                if (!newOperation.ownCapital || !newOperation.leverage) return null;
                
                const ownCapital = parseFloat(newOperation.ownCapital);
                const leverage = parseInt(newOperation.leverage);
                const borrowedCapital = ownCapital * (leverage - 1);
                const totalInvestment = ownCapital + borrowedCapital;
                
                return { ownCapital, borrowedCapital, totalInvestment };
            };

            const preview = calculatePreview();
            const capitalInvertido = operations.reduce((sum, op) => sum + op.ownCapital + op.additionalMargin, 0);
            const stopDangerTotal = operations.reduce((sum, op) => {
                return sum + Math.max(0, op.totalInvestment - op.ownCapital - op.additionalMargin);
            }, 0);

            if (loading) {
                return React.createElement('div', { style: styles.loading }, 
                    'Cargando Trading Manager Pro...'
                );
            }

            if (!user) {
                return React.createElement('div', { style: styles.authContainer },
                    React.createElement('div', { style: styles.authCard },
                        React.createElement('div', { style: styles.authHeader },
                            React.createElement('div', { style: styles.logo }, 'TP'),
                            React.createElement('h1', { style: styles.authTitle }, 
                                'Trading Manager Pro - AriParFue Trader'
                            ),
                            React.createElement('p', { 
                                style: { 
                                    color: connectionStatus.includes('‚úÖ') ? '#88D498' : '#F4D896', 
                                    fontSize: '0.9rem', 
                                    margin: '1rem 0' 
                                } 
                            }, connectionStatus)
                        ),
                        React.createElement('form', { onSubmit: handleLogin, style: styles.authForm },
                            React.createElement('div', { style: styles.inputGroup },
                                React.createElement('label', { style: styles.label }, 'Usuario'),
                                React.createElement('input', {
                                    type: 'text',
                                    value: email,
                                    onChange: (e) => setEmail(e.target.value),
                                    style: styles.input,
                                    placeholder: 'admin',
                                    required: true
                                })
                            ),
                            React.createElement('div', { style: styles.inputGroup },
                                React.createElement('label', { style: styles.label }, 'Contrase√±a'),
                                React.createElement('input', {
                                    type: 'password',
                                    value: password,
                                    onChange: (e) => setPassword(e.target.value),
                                    style: styles.input,
                                    placeholder: 'admin',
                                    required: true
                                })
                            ),
                            authError && React.createElement('div', { style: styles.error }, authError),
                            React.createElement('button', { type: 'submit', style: styles.authButton }, 
                                'Iniciar Sesi√≥n'
                            )
                        )
                    )
                );
            }

            // VISTA NUEVA OPERACI√ìN
            if (currentView === 'new-operation') {
                return React.createElement('div', { style: styles.app },
                    React.createElement('header', { style: styles.header },
                        React.createElement('div', { style: styles.headerContent },
                            React.createElement('div', { style: styles.headerLeft },
                                React.createElement('div', { style: styles.logo }, 'TP'),
                                React.createElement('h1', { style: styles.title }, 'Nueva Operaci√≥n')
                            ),
                            React.createElement('div', { style: styles.headerRight },
                                React.createElement('button', { 
                                    onClick: () => setCurrentView('dashboard'), 
                                    style: styles.backBtn 
                                }, '‚Üê Volver'),
                                React.createElement('button', { 
                                    onClick: handleLogout, 
                                    style: styles.logoutBtn 
                                }, 'Salir')
                            )
                        )
                    ),

                    React.createElement('main', { style: styles.main },
                        React.createElement('div', { style: styles.formContainer },
                            React.createElement('div', { style: styles.formCard },
                                React.createElement('h2', { style: styles.formTitle }, 'Crear Nueva Operaci√≥n'),
                                React.createElement('p', { style: styles.formSubtitle }, 
                                    'Completa los datos para abrir una nueva posici√≥n'
                                ),

                                React.createElement('form', { onSubmit: handleCreateOperation, style: styles.form },
                                    React.createElement('div', { style: styles.inputGroup },
                                        React.createElement('label', { style: styles.label }, 'Criptomoneda'),
                                        React.createElement('input', {
                                            type: 'text',
                                            value: newOperation.crypto,
                                            onChange: (e) => setNewOperation({...newOperation, crypto: e.target.value}),
                                            style: styles.input,
                                            placeholder: 'BTC, ETH, SOL...',
                                            required: true
                                        })
                                    ),

                                    React.createElement('div', { style: styles.row },
                                        React.createElement('div', { style: styles.inputGroup },
                                            React.createElement('label', { style: styles.label }, 'Tipo de Posici√≥n'),
                                            React.createElement('select', {
                                                value: newOperation.type,
                                                onChange: (e) => setNewOperation({...newOperation, type: e.target.value}),
                                                style: styles.select
                                            },
                                                React.createElement('option', { value: 'LONG' }, 'LONG (Compra)'),
                                                React.createElement('option', { value: 'SHORT' }, 'SHORT (Venta)')
                                            )
                                        ),
                                        React.createElement('div', { style: styles.inputGroup },
                                            React.createElement('label', { style: styles.label }, 'Tipo de Operaci√≥n'),
                                            React.createElement('select', {
                                                value: newOperation.operationType,
                                                onChange: (e) => setNewOperation({...newOperation, operationType: e.target.value}),
                                                style: styles.select
                                            },
                                                React.createElement('option', { value: 'futuros' }, 'Futuros Perpetuos'),
                                                React.createElement('option', { value: 'spot' }, 'Spot'),
                                                React.createElement('option', { value: 'standar' }, 'Standard')
                                            )
                                        )
                                    ),

                                    React.createElement('div', { style: styles.row },
                                        React.createElement('div', { style: styles.inputGroup },
                                            React.createElement('label', { style: styles.label }, 'Palanca (Leverage)'),
                                            React.createElement('select', {
                                                value: newOperation.leverage,
                                                onChange: (e) => setNewOperation({...newOperation, leverage: e.target.value}),
                                                style: styles.select
                                            },
                                                [1,2,3,4,5,10,20,25,50,75,100].map(lev => 
                                                    React.createElement('option', { key: lev, value: lev }, `${lev}x`)
                                                )
                                            )
                                        ),
                                        React.createElement('div', { style: styles.inputGroup },
                                            React.createElement('label', { style: styles.label }, 'Capital Propio (Margen)'),
                                            React.createElement('input', {
                                                type: 'number',
                                                step: '0.01',
                                                value: newOperation.ownCapital,
                                                onChange: (e) => setNewOperation({...newOperation, ownCapital: e.target.value}),
                                                style: styles.input,
                                                placeholder: '1000.00',
                                                required: true
                                            })
                                        )
                                    ),

                                    React.createElement('div', { style: styles.inputGroup },
                                        React.createElement('label', { style: styles.label }, 'Precio de Entrada'),
                                        React.createElement('input', {
                                            type: 'number',
                                            step: '0.00000001',
                                            value: newOperation.entryPrice,
                                            onChange: (e) => setNewOperation({...newOperation, entryPrice: e.target.value}),
                                            style: styles.input,
                                            placeholder: '95000.00',
                                            required: true
                                        })
                                    ),

                                    React.createElement('div', { style: styles.inputGroup },
                                        React.createElement('label', { style: styles.label }, 'Fecha y Hora de Operaci√≥n'),
                                        React.createElement('input', {
                                            type: 'datetime-local',
                                            value: newOperation.operationDate,
                                            onChange: (e) => setNewOperation({...newOperation, operationDate: e.target.value}),
                                            style: styles.input,
                                            required: true
                                        })
                                    ),

                                    preview && React.createElement('div', { style: styles.previewBox },
                                        React.createElement('h4', { style: styles.previewTitle }, 'üìä C√°lculos Autom√°ticos'),
                                        React.createElement('div', { style: styles.previewGrid },
                                            React.createElement('div', { style: styles.previewItem },
                                                React.createElement('span', { style: styles.previewLabel }, 'Capital Prestado:'),
                                                React.createElement('span', { style: styles.previewValue }, 
                                                    formatCurrency(preview.borrowedCapital)
                                                )
                                            ),
                                            React.createElement('div', { style: styles.previewItem },
                                                React.createElement('span', { style: styles.previewLabel }, 'Total Inversi√≥n:'),
                                                React.createElement('span', { style: {...styles.previewValue, color: '#7C9DD4'} }, 
                                                    formatCurrency(preview.totalInvestment)
                                                )
                                            )
                                        )
                                    ),

                                    operationError && React.createElement('div', { style: styles.error }, operationError),

                                    React.createElement('div', { style: styles.formActions },
                                        React.createElement('button', { 
                                            type: 'button',
                                            onClick: () => setCurrentView('dashboard'),
                                            style: styles.cancelBtn 
                                        }, 'Cancelar'),
                                        React.createElement('button', { 
                                            type: 'submit',
                                            disabled: saving,
                                            style: {...styles.submitBtn, opacity: saving ? 0.6 : 1} 
                                        }, saving ? 'Guardando...' : 'Crear Operaci√≥n')
                                    )
                                )
                            )
                        )
                    )
                );
            }

            // VISTA VER DETALLE - B√ÅSICA
            if (currentView === 'detail' && selectedOperation) {
                // C√°lculos avanzados
                const totalEntries = operationEntries.length;
                const totalExecuted = operationEntries.reduce((sum, entry) => sum + parseFloat(entry.executed || 0), 0);
                const totalMargin = operationEntries.reduce((sum, entry) => sum + parseFloat(entry.margin || 0), 0);
                const totalUnits = operationEntries.reduce((sum, entry) => sum + parseFloat(entry.units || 0), 0);
                const totalIPonderada = operationEntries.reduce((sum, entry) => sum + parseFloat(entry.i_ponderada || 0), 0);
                
                // PEPP (Precio Entrada Promedio Ponderado)
                const pepp = totalExecuted > 0 ? totalIPonderada / totalExecuted : 0;
                
                // Precio de liquidaci√≥n - F√ìRMULA CORREGIDA
                const totalMarginWithAdditional = selectedOperation.ownCapital + (selectedOperation.additionalMargin || 0);
                const leverage = selectedOperation.leverage || 1;
                
                // F√≥rmula correcta para posici√≥n LONG
                const liquidationPrice = selectedOperation.type === 'LONG' 
                    ? pepp * (1 - (1 / leverage))
                    : pepp * (1 + (1 / leverage));

                return React.createElement('div', { style: styles.app },
                    React.createElement('header', { style: styles.header },
                        React.createElement('div', { style: styles.headerContent },
                            React.createElement('div', { style: styles.headerLeft },
                                React.createElement('div', { style: styles.logo }, 'TP'),
                                React.createElement('h1', { style: styles.title }, 
                                    `Detalle: ${selectedOperation.crypto}`
                                )
                            ),
                            React.createElement('div', { style: styles.headerRight },
                                React.createElement('button', { 
                                    onClick: () => setCurrentView('dashboard'), 
                                    style: styles.backBtn 
                                }, '‚Üê Volver'),
                                React.createElement('button', { 
                                    onClick: handleLogout, 
                                    style: styles.logoutBtn 
                                }, 'Salir')
                            )
                        )
                    ),

                    React.createElement('main', { style: styles.main },
                        React.createElement('div', { style: styles.detailContainer },
                            React.createElement('div', { style: styles.detailCard },
                                React.createElement('div', { style: styles.detailHeader },
                                    React.createElement('h2', { style: styles.detailTitle }, 
                                        `${selectedOperation.crypto} - ${selectedOperation.type}`
                                    ),
                                    React.createElement('div', { style: styles.detailBadges },
                                        React.createElement('span', {
                                            style: {
                                                ...styles.detailBadge,
                                                backgroundColor: selectedOperation.type === 'LONG' ? 'rgba(136, 212, 152, 0.15)' : 'rgba(232, 155, 165, 0.15)',
                                                color: selectedOperation.type === 'LONG' ? '#88D498' : '#E89BA5'
                                            }
                                        }, selectedOperation.type),
                                        React.createElement('span', {
                                            style: {
                                                ...styles.detailBadge,
                                                backgroundColor: 'rgba(124, 157, 212, 0.15)',
                                                color: '#7C9DD4'
                                            }
                                        }, selectedOperation.operationType.toUpperCase()),
                                        React.createElement('span', { style: styles.detailBadge }, 
                                            `${selectedOperation.leverage}x`
                                        )
                                    )
                                ),

                                // M√âTRICAS AVANZADAS
                                React.createElement('div', { style: styles.advancedMetrics },
                                    React.createElement('h3', { style: styles.sectionTitle }, 'M√©tricas de Operaci√≥n'),
                                    React.createElement('div', { style: styles.metricsGrid },
                                        React.createElement('div', { style: styles.metricItem },
                                            React.createElement('span', { style: styles.metricLabel }, 'PEPP'),
                                            React.createElement('span', { 
                                                style: {...styles.metricValue, color: '#7C9DD4'} 
                                            }, pepp > 0 ? formatCurrency(pepp) : 'N/A')
                                        ),
                                        React.createElement('div', { style: styles.metricItem },
                                            React.createElement('span', { style: styles.metricLabel }, 'Precio Liquidaci√≥n'),
                                            React.createElement('span', { 
                                                style: {...styles.metricValue, color: '#E89BA5'} 
                                            }, pepp > 0 ? formatCurrency(liquidationPrice) : 'N/A')
                                        ),
                                        React.createElement('div', { style: styles.metricItem },
                                            React.createElement('span', { style: styles.metricLabel }, 'Total Ejecutado'),
                                            React.createElement('span', { style: styles.metricValue }, 
                                                formatCurrency(totalExecuted)
                                            )
                                        ),
                                        React.createElement('div', { style: styles.metricItem },
                                            React.createElement('span', { style: styles.metricLabel }, 'Total Unidades'),
                                            React.createElement('span', { style: styles.metricValue }, 
                                                totalUnits.toFixed(8)
                                            )
                                        )
                                    )
                                ),

                                // TABLA DE ENTRADAS
                                React.createElement('div', { style: styles.entriesSection },
                                    React.createElement('div', { style: styles.entriesHeader },
                                        React.createElement('h3', { style: styles.sectionTitle }, 
                                            `Historial de Entradas (${totalEntries})`
                                        ),
                                        React.createElement('button', {
                                            onClick: handleShowAddEntry,
                                            style: styles.addEntryBtn
                                        }, '+ Agregar Entrada')
                                    ),

                                    operationEntries.length === 0 ? 
                                        React.createElement('div', { style: styles.emptyEntries },
                                            React.createElement('p', null, 'No hay entradas registradas a√∫n'),
                                            React.createElement('p', { 
                                                style: { fontSize: '0.85rem', color: '#A8B2C1' } 
                                            }, 'Las entradas se crear√°n cuando agregues m√∫ltiples compras a esta operaci√≥n')
                                        ) :
                                        React.createElement('div', { style: styles.entriesTable },
                                            React.createElement('table', { style: styles.table },
                                                React.createElement('thead', null,
                                                    React.createElement('tr', { style: styles.tableHeaderRow },
                                                        React.createElement('th', { style: styles.th }, 'Fecha'),
                                                        React.createElement('th', { style: styles.th }, 'Ejecutado'),
                                                        React.createElement('th', { style: styles.th }, 'Margen'),
                                                        React.createElement('th', { style: styles.th }, 'Precio'),
                                                        React.createElement('th', { style: styles.th }, 'Unidades'),
                                                        React.createElement('th', { style: styles.th }, 'I-Ponderada')
                                                    )
                                                ),
                                                React.createElement('tbody', null,
                                                    operationEntries.map((entry, index) => (
                                                        React.createElement('tr', { key: entry.id, style: styles.tableRow },
                                                            React.createElement('td', { style: styles.td }, 
                                                                new Date(entry.created_at).toLocaleDateString('es-ES')
                                                            ),
                                                            React.createElement('td', { style: styles.td }, 
                                                                formatCurrency(entry.executed || 0)
                                                            ),
                                                            React.createElement('td', { style: styles.td }, 
                                                                formatCurrency(entry.margin || 0)
                                                            ),
                                                            React.createElement('td', { style: styles.td }, 
                                                                formatCurrency(entry.entry_price || 0)
                                                            ),
                                                            React.createElement('td', { style: styles.td }, 
                                                                (entry.units || 0).toFixed(8)
                                                            ),
                                                            React.createElement('td', { style: styles.td }, 
                                                                formatCurrency(entry.i_ponderada || 0)
                                                            )
                                                        )
                                                    ))
                                                )
                                            )
                                        )
                                ),

                                // FORMULARIO AGREGAR ENTRADA
                                showAddEntry && React.createElement('div', { style: styles.addEntryForm },
                                    React.createElement('h4', { style: styles.formTitle }, 'Agregar Nueva Entrada'),
                                    React.createElement('form', { onSubmit: handleAddEntry, style: styles.entryForm },
                                        React.createElement('div', { style: styles.formRow },
                                            React.createElement('div', { style: styles.inputGroup },
                                                React.createElement('label', { style: styles.label }, 'Precio de Entrada'),
                                                React.createElement('input', {
                                                    type: 'number',
                                                    step: '0.00000001',
                                                    value: newEntry.entryPrice,
                                                    onChange: (e) => setNewEntry({...newEntry, entryPrice: e.target.value}),
                                                    style: styles.input,
                                                    placeholder: '95000.00',
                                                    required: true
                                                })
                                            ),
                                            React.createElement('div', { style: styles.inputGroup },
                                                React.createElement('label', { style: styles.label }, 'Margen (Capital)'),
                                                React.createElement('input', {
                                                    type: 'number',
                                                    step: '0.01',
                                                    value: newEntry.margin,
                                                    onChange: (e) => setNewEntry({...newEntry, margin: e.target.value}),
                                                    style: styles.input,
                                                    placeholder: '500.00',
                                                    required: true
                                                })
                                            )
                                        ),

                                        React.createElement('div', { style: styles.formRow },
                                            React.createElement('div', { style: styles.inputGroup },
                                                React.createElement('label', { style: styles.label }, 'Fecha'),
                                                React.createElement('input', {
                                                    type: 'date',
                                                    value: newEntry.date,
                                                    onChange: (e) => setNewEntry({...newEntry, date: e.target.value}),
                                                    style: styles.input,
                                                    required: true
                                                })
                                            ),
                                            React.createElement('div', { style: styles.inputGroup },
                                                React.createElement('label', { style: styles.label }, 'Hora'),
                                                React.createElement('input', {
                                                    type: 'time',
                                                    value: newEntry.time,
                                                    onChange: (e) => setNewEntry({...newEntry, time: e.target.value}),
                                                    style: styles.input,
                                                    required: true
                                                })
                                            )
                                        ),

                                        React.createElement('div', { style: styles.inputGroup },
                                            React.createElement('label', { style: styles.label }, 'Fecha y Hora de Entrada'),
                                            React.createElement('input', {
                                                type: 'datetime-local',
                                                value: newEntry.entryDate,
                                                onChange: (e) => setNewEntry({...newEntry, entryDate: e.target.value}),
                                                style: styles.input,
                                                required: true
                                            })
                                        ),

                                        // Preview de c√°lculos
                                        newEntry.entryPrice && newEntry.margin && React.createElement('div', { style: styles.entryPreview },
                                            React.createElement('h5', { style: styles.previewTitle }, 'üìä C√°lculos Autom√°ticos'),
                                            React.createElement('div', { style: styles.previewRow },
                                                React.createElement('span', { style: styles.previewLabel }, 'Ejecutado:'),
                                                React.createElement('span', { style: styles.previewValue }, 
                                                    formatCurrency(parseFloat(newEntry.margin || 0) * selectedOperation.leverage)
                                                )
                                            ),
                                            React.createElement('div', { style: styles.previewRow },
                                                React.createElement('span', { style: styles.previewLabel }, 'Unidades:'),
                                                React.createElement('span', { style: styles.previewValue }, 
                                                    newEntry.entryPrice ? 
                                                    ((parseFloat(newEntry.margin || 0) * selectedOperation.leverage) / parseFloat(newEntry.entryPrice)).toFixed(8)
                                                    : '0.00000000'
                                                )
                                            )
                                        ),

                                        entryError && React.createElement('div', { style: styles.error }, entryError),

                                        React.createElement('div', { style: styles.formActions },
                                            React.createElement('button', { 
                                                type: 'button',
                                                onClick: () => setShowAddEntry(false),
                                                style: styles.cancelBtn 
                                            }, 'Cancelar'),
                                            React.createElement('button', { 
                                                type: 'submit',
                                                disabled: savingEntry,
                                                style: {...styles.saveEntryBtn, opacity: savingEntry ? 0.6 : 1} 
                                            }, savingEntry ? 'Guardando...' : 'Agregar Entrada')
                                        )
                                    )
                                ),

                                // SECCI√ìN GESTI√ìN DE MARGEN
                                React.createElement('div', { style: styles.marginSection },
                                    React.createElement('div', { style: styles.marginHeader },
                                        React.createElement('h3', { style: styles.sectionTitle }, 'Gesti√≥n de Margen'),
                                        React.createElement('div', { style: styles.marginButtons },
                                            React.createElement('button', {
                                                onClick: handleShowAddMargin,
                                                style: styles.addMarginBtn
                                            }, 'üí∞ Agregar Margen'),
                                            selectedOperation.additionalMargin > 0 && React.createElement('button', {
                                                onClick: handleShowRemoveMargin,
                                                style: styles.removeMarginBtn
                                            }, 'üí∏ Quitar Margen')
                                        )
                                    ),

                                    React.createElement('div', { style: styles.marginInfo },
                                        React.createElement('div', { style: styles.marginGrid },
                                            React.createElement('div', { style: styles.marginItem },
                                                React.createElement('span', { style: styles.marginLabel }, 'Margen Inicial:'),
                                                React.createElement('span', { style: styles.marginValue }, 
                                                    formatCurrency(selectedOperation.ownCapital)
                                                )
                                            ),
                                            React.createElement('div', { style: styles.marginItem },
                                                React.createElement('span', { style: styles.marginLabel }, 'Margen Adicional:'),
                                                React.createElement('span', { 
                                                    style: { 
                                                        ...styles.marginValue, 
                                                        color: selectedOperation.additionalMargin > 0 ? '#88D498' : '#A8B2C1' 
                                                    } 
                                                }, formatCurrency(selectedOperation.additionalMargin || 0))
                                            ),
                                            React.createElement('div', { style: styles.marginItem },
                                                React.createElement('span', { style: styles.marginLabel }, 'Margen Total:'),
                                                React.createElement('span', { 
                                                    style: { ...styles.marginValue, color: '#7C9DD4', fontSize: '1.1rem' } 
                                                }, formatCurrency(selectedOperation.ownCapital + (selectedOperation.additionalMargin || 0)))
                                            ),
                                            React.createElement('div', { style: styles.marginItem },
                                                React.createElement('span', { style: styles.marginLabel }, 'Liquidez Disponible:'),
                                                React.createElement('span', { 
                                                    style: { ...styles.marginValue, color: '#88D498' } 
                                                }, formatCurrency(portfolio.availableLiquidity))
                                            )
                                        )
                                    ),

                                    // FORMULARIO QUITAR MARGEN
                                    showRemoveMargin && React.createElement('div', { style: styles.removeMarginForm },
                                        React.createElement('h4', { style: styles.formTitle }, 
                                            'üí∏ Quitar Margen Adicional'
                                        ),
                                        React.createElement('p', { style: styles.formSubtitle },
                                            'Libera capital cuando el riesgo sea bajo. Solo puedes retirar margen adicional.'
                                        ),

                                        React.createElement('form', { onSubmit: handleRemoveMargin, style: styles.marginForm },
                                            React.createElement('div', { style: styles.inputGroup },
                                                React.createElement('label', { style: styles.label }, 
                                                    `Monto a Retirar (M√°ximo: ${formatCurrency(selectedOperation.additionalMargin || 0)})`
                                                ),
                                                React.createElement('input', {
                                                    type: 'number',
                                                    step: '0.01',
                                                    value: marginToRemove,
                                                    onChange: (e) => setMarginToRemove(e.target.value),
                                                    style: styles.input,
                                                    placeholder: '300.00',
                                                    max: selectedOperation.additionalMargin || 0,
                                                    required: true
                                                })
                                            ),

                                            // Preview del impacto de retirar margen
                                            marginToRemove && parseFloat(marginToRemove) > 0 && parseFloat(marginToRemove) <= (selectedOperation.additionalMargin || 0) && (() => {
                                                const removeAmount = parseFloat(marginToRemove);
                                                const newAdditionalMargin = (selectedOperation.additionalMargin || 0) - removeAmount;
                                                const newTotalMargin = selectedOperation.ownCapital + newAdditionalMargin;
                                                const currentTotalExecuted = totalExecuted;
                                                const newEffectiveLeverage = currentTotalExecuted / newTotalMargin;
                                                const newLiquidationPrice = pepp * (1 - (1 / newEffectiveLeverage));

                                                return React.createElement('div', { style: styles.removeMarginPreview },
                                                    React.createElement('h5', { style: styles.previewTitle }, 'üìä Impacto de Retirar Margen'),
                                                    React.createElement('div', { style: styles.previewInfo },
                                                        React.createElement('div', { style: styles.previewRow },
                                                            React.createElement('span', { style: styles.previewLabel }, 'Nuevo Margen Total:'),
                                                            React.createElement('span', { style: styles.previewValue }, 
                                                                formatCurrency(newTotalMargin)
                                                            )
                                                        ),
                                                        React.createElement('div', { style: styles.previewRow },
                                                            React.createElement('span', { style: styles.previewLabel }, 'Nuevo Precio Liquidaci√≥n:'),
                                                            React.createElement('span', { 
                                                                style: { 
                                                                    ...styles.previewValue, 
                                                                    color: newLiquidationPrice > 0 ? '#E89BA5' : '#88D498' 
                                                                } 
                                                            }, newLiquidationPrice > 0 ? formatCurrency(newLiquidationPrice) : 'Sin riesgo')
                                                        ),
                                                        React.createElement('div', { style: styles.previewRow },
                                                            React.createElement('span', { style: styles.previewLabel }, 'Liquidez Liberada:'),
                                                            React.createElement('span', { 
                                                                style: { ...styles.previewValue, color: '#88D498' } 
                                                            }, '+' + formatCurrency(removeAmount))
                                                        ),
                                                        React.createElement('div', { style: styles.previewRow },
                                                            React.createElement('span', { style: styles.previewLabel }, 'Riesgo:'),
                                                            React.createElement('span', { 
                                                                style: { ...styles.previewValue, color: '#F4D896' } 
                                                            }, newEffectiveLeverage > selectedOperation.leverage ? '‚ö†Ô∏è Aumentado' : '‚úÖ Controlado')
                                                        )
                                                    )
                                                );
                                            })(),

                                            marginError && React.createElement('div', { style: styles.error }, marginError),

                                            React.createElement('div', { style: styles.formActions },
                                                React.createElement('button', { 
                                                    type: 'button',
                                                    onClick: () => setShowRemoveMargin(false),
                                                    style: styles.cancelBtn 
                                                }, 'Cancelar'),
                                                React.createElement('button', { 
                                                    type: 'submit',
                                                    disabled: savingMargin || !marginToRemove || parseFloat(marginToRemove) <= 0 || parseFloat(marginToRemove) > (selectedOperation.additionalMargin || 0),
                                                    style: {
                                                        ...styles.removeMarginSubmitBtn, 
                                                        opacity: (savingMargin || !marginToRemove || parseFloat(marginToRemove) <= 0 || parseFloat(marginToRemove) > (selectedOperation.additionalMargin || 0)) ? 0.6 : 1
                                                    }
                                                }, savingMargin ? 'Retirando...' : 'Quitar Margen')
                                            )
                                        )
                                    ),

                                    // FORMULARIO AGREGAR MARGEN
                                    showAddMargin && React.createElement('div', { style: styles.addMarginForm },
                                        React.createElement('h4', { style: styles.formTitle }, 
                                            'üí∞ Agregar Margen Adicional'
                                        ),
                                        React.createElement('p', { style: styles.formSubtitle },
                                            'Reduce el riesgo de liquidaci√≥n agregando m√°s capital propio'
                                        ),

                                        React.createElement('form', { onSubmit: handleAddMargin, style: styles.marginForm },
                                            React.createElement('div', { style: styles.inputGroup },
                                                React.createElement('label', { style: styles.label }, 'Monto a Agregar'),
                                                React.createElement('input', {
                                                    type: 'number',
                                                    step: '0.01',
                                                    value: newMargin,
                                                    onChange: (e) => setNewMargin(e.target.value),
                                                    style: styles.input,
                                                    placeholder: '500.00',
                                                    required: true
                                                })
                                            ),

                                            // Preview del impacto
                                            newMargin && parseFloat(newMargin) > 0 && (() => {
                                                const newTotalMargin = selectedOperation.ownCapital + (selectedOperation.additionalMargin || 0) + parseFloat(newMargin);
                                                const currentTotalExecuted = totalExecuted;
                                                const newMarginRatio = newTotalMargin / currentTotalExecuted;
                                                
                                                // F√ìRMULA CORRECTA: PEPP √ó (1 - 1/leverage_efectivo)
                                                const newEffectiveLeverage = currentTotalExecuted / newTotalMargin;
                                                const newLiquidationPrice = pepp * (1 - (1 / newEffectiveLeverage));

                                                return React.createElement('div', { style: styles.marginPreview },
                                                    React.createElement('h5', { style: styles.previewTitle }, 'üìä Impacto del Margen'),
                                                    React.createElement('div', { style: styles.previewInfo },
                                                        React.createElement('div', { style: styles.previewRow },
                                                            React.createElement('span', { style: styles.previewLabel }, 'Nuevo Total Margen:'),
                                                            React.createElement('span', { style: styles.previewValue }, 
                                                                formatCurrency(newTotalMargin)
                                                            )
                                                        ),
                                                        React.createElement('div', { style: styles.previewRow },
                                                            React.createElement('span', { style: styles.previewLabel }, 'Nuevo Precio Liquidaci√≥n:'),
                                                            React.createElement('span', { 
                                                                style: { ...styles.previewValue, color: '#88D498' } 
                                                            }, formatCurrency(newLiquidationPrice))
                                                        ),
                                                        React.createElement('div', { style: styles.previewRow },
                                                            React.createElement('span', { style: styles.previewLabel }, 'Stop Danger Reducido:'),
                                                            React.createElement('span', { 
                                                                style: { ...styles.previewValue, color: '#88D498' } 
                                                            }, '‚Üì Menor riesgo liquidaci√≥n')
                                                        ),
                                                        React.createElement('div', { style: styles.previewRow },
                                                            React.createElement('span', { style: styles.previewLabel }, 'Liquidez Restante:'),
                                                            React.createElement('span', { style: styles.previewValue }, 
                                                                formatCurrency(portfolio.availableLiquidity - parseFloat(newMargin))
                                                            )
                                                        )
                                                    )
                                                );
                                            })(),

                                            marginError && React.createElement('div', { style: styles.error }, marginError),

                                            React.createElement('div', { style: styles.formActions },
                                                React.createElement('button', { 
                                                    type: 'button',
                                                    onClick: () => setShowAddMargin(false),
                                                    style: styles.cancelBtn 
                                                }, 'Cancelar'),
                                                React.createElement('button', { 
                                                    type: 'submit',
                                                    disabled: savingMargin || !newMargin || parseFloat(newMargin) <= 0,
                                                    style: {
                                                        ...styles.addMarginSubmitBtn, 
                                                        opacity: (savingMargin || !newMargin || parseFloat(newMargin) <= 0) ? 0.6 : 1
                                                    }
                                                }, savingMargin ? 'Agregando...' : 'Agregar Margen')
                                            )
                                        )
                                    )
                                ),

                                // SECCI√ìN TAKE PROFITS
                                React.createElement('div', { style: styles.tpSection },
                                    React.createElement('div', { style: styles.tpHeader },
                                        React.createElement('h3', { style: styles.sectionTitle }, 'Take Profits'),
                                        React.createElement('button', {
                                            onClick: handleConfigureTPs,
                                            style: styles.configureTPBtn
                                        }, '‚öôÔ∏è Configurar TPs')
                                    ),

                                    React.createElement('div', { style: styles.tpGrid },
                                        operationTPs.map((tp, index) => (
                                            React.createElement('div', { 
                                                key: tp.number, 
                                                style: {
                                                    ...styles.tpCard,
                                                    backgroundColor: tp.executed 
                                                        ? 'rgba(136, 212, 152, 0.08)' 
                                                        : tp.price 
                                                            ? 'rgba(244, 216, 150, 0.08)'
                                                            : '#252936',
                                                    borderColor: tp.executed 
                                                        ? 'rgba(136, 212, 152, 0.2)' 
                                                        : tp.price 
                                                            ? 'rgba(244, 216, 150, 0.2)'
                                                            : 'rgba(124, 157, 212, 0.1)'
                                                }
                                            },
                                                React.createElement('div', { style: styles.tpHeader },
                                                    React.createElement('span', { style: styles.tpNumber }, `TP${tp.number}`),
                                                    tp.executed && React.createElement('span', { 
                                                        style: styles.executedBadge 
                                                    }, '‚úÖ Ejecutado')
                                                ),
                                                
                                                tp.price ? (
                                                    React.createElement('div', { style: styles.tpInfo },
                                                        React.createElement('div', { style: styles.tpRow },
                                                            React.createElement('span', { style: styles.tpLabel }, 'Precio:'),
                                                            React.createElement('span', { style: styles.tpValue }, 
                                                                formatCurrency(tp.price)
                                                            )
                                                        ),
                                                        React.createElement('div', { style: styles.tpRow },
                                                            React.createElement('span', { style: styles.tpLabel }, 'Vender:'),
                                                            React.createElement('span', { style: styles.tpValue }, 
                                                                `${tp.percentage}%`
                                                            )
                                                        ),
                                                        
                                                        // Mostrar profit potencial si hay PEPP y unidades
                                                        pepp > 0 && totalUnits > 0 && React.createElement('div', { style: styles.tpProfitInfo },
                                                            React.createElement('div', { style: styles.tpRow },
                                                                React.createElement('span', { style: styles.tpLabel }, 'Profit:'),
                                                                React.createElement('span', { 
                                                                    style: {
                                                                        ...styles.tpValue, 
                                                                        color: tp.price > pepp ? '#88D498' : '#E89BA5'
                                                                    } 
                                                                }, formatCurrency((tp.price - pepp) * ((totalUnits * tp.percentage) / 100)))
                                                            ),
                                                            React.createElement('div', { style: styles.tpRow },
                                                                React.createElement('span', { style: styles.tpLabel }, 'Unidades:'),
                                                                React.createElement('span', { style: styles.tpValue }, 
                                                                    ((totalUnits * tp.percentage) / 100).toFixed(8)
                                                                )
                                                            ),
                                                            
                                                            // Informaci√≥n adicional para TPs ejecutados
                                                            tp.executed && (() => {
                                                                // Calcular basado en el total REAL de todas las entradas (DCA)
                                                                const totalRealMargin = operationEntries.reduce((sum, entry) => sum + parseFloat(entry.margin || 0), 0);
                                                                const totalRealExecuted = operationEntries.reduce((sum, entry) => sum + parseFloat(entry.executed || 0), 0);
                                                                const totalRealLeveraged = totalRealExecuted - totalRealMargin;
                                                                
                                                                const executedMargin = (totalRealMargin * tp.percentage) / 100;
                                                                const executedLeveraged = (totalRealLeveraged * tp.percentage) / 100;
                                                                
                                                                return React.createElement('div', { style: styles.executedInfo },
                                                                    React.createElement('div', { style: styles.tpRow },
                                                                        React.createElement('span', { style: styles.tpLabel }, 'Margen Ejecutado:'),
                                                                        React.createElement('span', { style: styles.tpValue }, 
                                                                            formatCurrency(executedMargin)
                                                                        )
                                                                    ),
                                                                    React.createElement('div', { style: styles.tpRow },
                                                                        React.createElement('span', { style: styles.tpLabel }, 'Capital Apalancado:'),
                                                                        React.createElement('span', { style: styles.tpValue }, 
                                                                            formatCurrency(executedLeveraged)
                                                                        )
                                                                    )
                                                                );
                                                            })()
                                                        ),
                                                        
                                                        // Bot√≥n ejecutar solo si no est√° ejecutado
                                                        !tp.executed && React.createElement('button', {
                                                            onClick: () => handleExecuteTP(tp, pepp, totalUnits),
                                                            style: styles.executeTPBtn
                                                        }, 'üéØ Ejecutar TP')
                                                    )
                                                ) : (
                                                    React.createElement('div', { style: styles.tpEmpty },
                                                        React.createElement('span', { style: styles.tpEmptyText }, 
                                                            'No configurado'
                                                        )
                                                    )
                                                )
                                            )
                                        ))
                                    ),

                                    // FORMULARIO CONFIGURAR TPs
                                    showConfigureTPs && React.createElement('div', { style: styles.tpConfigForm },
                                        React.createElement('h4', { style: styles.configFormTitle }, 
                                            '‚öôÔ∏è Configurar Take Profits'
                                        ),
                                        React.createElement('p', { style: styles.configFormSubtitle },
                                            'Define precios objetivo y porcentajes de venta para cada TP'
                                        ),

                                        React.createElement('div', { style: styles.tpConfigGrid },
                                            tpConfig.map((tp, index) => (
                                                React.createElement('div', { key: tp.number, style: styles.tpConfigCard },
                                                    React.createElement('h5', { style: styles.tpConfigTitle }, 
                                                        `TP${tp.number}`
                                                    ),
                                                    React.createElement('div', { style: styles.tpConfigInputs },
                                                        React.createElement('div', { style: styles.inputGroup },
                                                            React.createElement('label', { style: styles.label }, 
                                                                'Precio Objetivo'
                                                            ),
                                                            React.createElement('input', {
                                                                type: 'number',
                                                                step: '0.00000001',
                                                                value: tp.price,
                                                                onChange: (e) => updateTPConfig(index, 'price', e.target.value),
                                                                style: styles.input,
                                                                placeholder: '100000'
                                                            })
                                                        ),
                                                        React.createElement('div', { style: styles.inputGroup },
                                                            React.createElement('label', { style: styles.label }, 
                                                                '% a Vender'
                                                            ),
                                                            React.createElement('input', {
                                                                type: 'number',
                                                                min: '1',
                                                                max: '100',
                                                                step: '1',
                                                                value: tp.percentage,
                                                                onChange: (e) => updateTPConfig(index, 'percentage', e.target.value),
                                                                style: styles.input,
                                                                placeholder: '25'
                                                            })
                                                        )
                                                    )
                                                )
                                            ))
                                        ),

                                        tpError && React.createElement('div', { style: styles.error }, tpError),

                                        React.createElement('div', { style: styles.tpConfigActions },
                                            React.createElement('button', { 
                                                type: 'button',
                                                onClick: () => setShowConfigureTPs(false),
                                                style: styles.cancelBtn 
                                            }, 'Cancelar'),
                                            React.createElement('button', { 
                                                onClick: handleSaveTPs,
                                                disabled: savingTPs,
                                                style: {...styles.saveTPsBtn, opacity: savingTPs ? 0.6 : 1} 
                                            }, savingTPs ? 'Guardando...' : 'Guardar TPs')
                                        )
                                    )
                                ),

                                React.createElement('div', { style: styles.detailActions },
                                    React.createElement('p', { 
                                        style: { color: '#A8B2C1', fontSize: '0.9rem', margin: '0 0 1rem 0' } 
                                    }, 'Pr√≥ximamente: Configuraci√≥n avanzada de TPs, margen adicional'),
                                    React.createElement('button', {
                                        onClick: () => setCurrentView('dashboard'),
                                        style: styles.primaryBtn
                                    }, 'Volver al Dashboard')
                                )
                            )
                        )
                    )
                );
            }

            // VISTA OPERACIONES CERRADAS
            if (currentView === 'closed-operations') {
                return React.createElement('div', { style: styles.app },
                    React.createElement('header', { style: styles.header },
                        React.createElement('div', { style: styles.headerContent },
                            React.createElement('div', { style: styles.headerLeft },
                                React.createElement('div', { style: styles.logo }, 'TP'),
                                React.createElement('h1', { style: styles.title }, 'Operaciones Cerradas')
                            ),
                            React.createElement('div', { style: styles.headerRight },
                                React.createElement('button', { 
                                    onClick: () => setCurrentView('dashboard'), 
                                    style: styles.backBtn 
                                }, '‚Üê Dashboard'),
                                React.createElement('button', { 
                                    onClick: handleLogout, 
                                    style: styles.logoutBtn 
                                }, 'Salir')
                            )
                        )
                    ),

                    React.createElement('main', { style: styles.main },
                        React.createElement('div', { style: styles.operationsCard },
                            React.createElement('div', { style: styles.operationsHeader },
                                React.createElement('div', { style: { display: 'flex', justifyContent: 'space-between', alignItems: 'center', width: '100%' } },
                                    React.createElement('div', null,
                                        React.createElement('h2', { style: styles.sectionTitle }, `Historial de Operaciones (${closedOperations.length})`),
                                        React.createElement('p', { style: { color: '#A8B2C1', fontSize: '0.9rem', margin: 0 } }, 'Operaciones completamente ejecutadas')
                                    ),
                                    user.email === 'admin@tradingpro.com' && closedOperations.length > 0 && 
                                    React.createElement('button', {
                                        onClick: () => handleCleanupClosedOperations(),
                                        style: { padding: '0.5rem 1rem', backgroundColor: 'rgba(232, 155, 165, 0.15)', color: '#E89BA5', border: '1px solid rgba(232, 155, 165, 0.3)', borderRadius: '6px', fontSize: '0.8rem', cursor: 'pointer' }
                                    }, 'üßπ Limpiar')
                                )
                            ),

                            closedOperations.length === 0 ? 
                                React.createElement('div', { style: styles.emptyState },
                                    React.createElement('div', { style: styles.emptyStateContent },
                                        React.createElement('h3', { style: styles.emptyStateTitle }, 
                                            'üìã Sin operaciones cerradas'
                                        ),
                                        React.createElement('p', { style: styles.emptyStateText }, 
                                            'Cuando ejecutes todos los TPs de una operaci√≥n, aparecer√° aqu√≠.'
                                        )
                                    )
                                ) :
                                React.createElement('div', { style: styles.tableWrapper },
                                    React.createElement('table', { style: styles.table },
                                        React.createElement('thead', null,
                                            React.createElement('tr', { style: styles.tableHeaderRow },
                                                React.createElement('th', { style: styles.th }, 'Fecha Apertura'),
                                                React.createElement('th', { style: styles.th }, 'Fecha Cierre'),
                                                React.createElement('th', { style: styles.th }, 'Duraci√≥n'),
                                                React.createElement('th', { style: styles.th }, 'Par'),
                                                React.createElement('th', { style: styles.th }, 'Tipo'),
                                                React.createElement('th', { style: styles.th }, 'Palanca'),
                                                React.createElement('th', { style: {...styles.th, className: 'desktop-only'} }, 'DCA'),
                                                React.createElement('th', { style: styles.th }, 'Margen Total'),
                                                React.createElement('th', { style: {...styles.th, className: 'desktop-only'} }, 'Capital Prestado'),
                                                React.createElement('th', { style: styles.th }, 'Total Ejecutado'),
                                                React.createElement('th', { style: styles.th }, 'PEPP'),
                                                React.createElement('th', { style: styles.th }, 'P&L Total'),
                                                React.createElement('th', { style: styles.th }, 'Acciones')
                                            )
                                        ),
                                        React.createElement('tbody', null,
                                            closedOperations.map((op) => {
                                                const formatDate = (date) => {
                                                    if (!date || isNaN(date.getTime())) {
                                                        return 'N/A';
                                                    }
                                                    return date.toLocaleDateString('es-ES', {
                                                        day: '2-digit',
                                                        month: '2-digit',
                                                        year: '2-digit'
                                                    });
                                                };

                                                const formatDuration = (days) => {
                                                    if (days === 0) return 'Mismo d√≠a';
                                                    if (days === 1) return '1 d√≠a';
                                                    if (days < 30) return `${days} d√≠as`;
                                                    const months = Math.floor(days / 30);
                                                    const remainingDays = days % 30;
                                                    if (remainingDays === 0) return `${months} mes${months > 1 ? 'es' : ''}`;
                                                    return `${months}m ${remainingDays}d`;
                                                };

                                                return React.createElement('tr', { key: op.id, style: styles.tableRow },
                                                    React.createElement('td', { style: styles.td },
                                                        React.createElement('div', { style: { fontSize: '0.9rem' } },
                                                            formatDate(op.openingDate)
                                                        )
                                                    ),
                                                    React.createElement('td', { style: styles.td },
                                                        React.createElement('div', { style: { fontSize: '0.9rem' } },
                                                            formatDate(op.closingDate)
                                                        )
                                                    ),
                                                    React.createElement('td', { style: styles.td },
                                                        React.createElement('span', { 
                                                            style: { 
                                                                ...styles.typeBadge, 
                                                                backgroundColor: op.durationDays <= 1 ? 'rgba(244, 216, 150, 0.15)' : 'rgba(124, 157, 212, 0.15)',
                                                                color: op.durationDays <= 1 ? '#F4D896' : '#7C9DD4'
                                                            } 
                                                        }, formatDuration(op.durationDays))
                                                    ),
                                                    React.createElement('td', { style: styles.td },
                                                        React.createElement('span', { style: styles.cryptoName }, op.crypto)
                                                    ),
                                                    React.createElement('td', { style: styles.td },
                                                        React.createElement('span', {
                                                            style: {
                                                                ...styles.typeBadge,
                                                                backgroundColor: op.type === 'LONG' ? 'rgba(136, 212, 152, 0.15)' : 'rgba(232, 155, 165, 0.15)',
                                                                color: op.type === 'LONG' ? '#88D498' : '#E89BA5'
                                                            }
                                                        }, op.type)
                                                    ),
                                                    React.createElement('td', { style: styles.td }, op.leverage + 'x'),
                                                    React.createElement('td', { style: {...styles.td, className: 'desktop-only'} }, 
                                                        React.createElement('span', { 
                                                            style: { ...styles.typeBadge, backgroundColor: 'rgba(124, 157, 212, 0.15)', color: '#7C9DD4' } 
                                                        }, `${op.entriesCount}`)
                                                    ),
                                                    React.createElement('td', { style: styles.td }, 
                                                        formatCurrency(op.realMargin)
                                                    ),
                                                    React.createElement('td', { style: {...styles.td, className: 'desktop-only'} }, 
                                                        formatCurrency(op.realLeveraged)
                                                    ),
                                                    React.createElement('td', { style: styles.td }, 
                                                        formatCurrency(op.realTotalExecuted)
                                                    ),
                                                    React.createElement('td', { style: styles.td }, 
                                                        React.createElement('span', { style: {...styles.typeBadge, backgroundColor: 'rgba(244, 216, 150, 0.15)', color: '#F4D896'} }, 
                                                            formatCurrency(op.pepp)
                                                        )
                                                    ),
                                                    React.createElement('td', { style: styles.td }, 
                                                        React.createElement('span', { 
                                                            style: {
                                                                ...styles.typeBadge,
                                                                backgroundColor: op.totalPnL >= 0 ? 'rgba(136, 212, 152, 0.15)' : 'rgba(232, 155, 165, 0.15)',
                                                                color: op.totalPnL >= 0 ? '#88D498' : '#E89BA5',
                                                                fontWeight: '700'
                                                            }
                                                        }, 
                                                            (op.totalPnL >= 0 ? '+' : '') + formatCurrency(op.totalPnL)
                                                        )
                                                    ),
                                                    React.createElement('td', { style: styles.td },
                                                        React.createElement('button', {
                                                            onClick: () => handleViewClosedDetail(op),
                                                            style: styles.actionBtn
                                                        }, 'Ver Detalle')
                                                    )
                                                );
                                            })
                                        )
                                    )
                                )
                        )
                    )
                );
            }

            // VISTA DETALLE OPERACI√ìN CERRADA
            if (currentView === 'closed-detail' && selectedClosedOperation) {
                const totalExecutedFromEntries = closedOperationEntries.reduce((sum, entry) => sum + parseFloat(entry.executed || 0), 0);
                const totalUnitsFromEntries = closedOperationEntries.reduce((sum, entry) => sum + parseFloat(entry.units || 0), 0);
                
                // Precio de liquidaci√≥n
                const liquidationPercent = 100 / selectedClosedOperation.leverage;
                const liquidationPrice = selectedClosedOperation.type === 'LONG' 
                    ? selectedClosedOperation.pepp * (1 - (liquidationPercent / 100))
                    : selectedClosedOperation.pepp * (1 + (liquidationPercent / 100));

                return React.createElement('div', { style: styles.app },
                    React.createElement('header', { style: styles.header },
                        React.createElement('div', { style: styles.headerContent },
                            React.createElement('div', { style: styles.headerLeft },
                                React.createElement('div', { style: styles.logo }, 'TP'),
                                React.createElement('h1', { style: styles.title }, 
                                    `Operaci√≥n Cerrada: ${selectedClosedOperation.crypto}`
                                )
                            ),
                            React.createElement('div', { style: styles.headerRight },
                                React.createElement('button', { 
                                    onClick: () => setCurrentView('closed-operations'), 
                                    style: styles.backBtn 
                                }, '‚Üê Historial'),
                                React.createElement('button', { 
                                    onClick: handleLogout, 
                                    style: styles.logoutBtn 
                                }, 'Salir')
                            )
                        )
                    ),

                    React.createElement('main', { style: styles.main },
                        React.createElement('div', { style: styles.detailContainer },
                            React.createElement('div', { style: styles.detailCard },
                                // HEADER
                                React.createElement('div', { style: styles.detailHeader },
                                    React.createElement('h2', { style: styles.detailTitle }, 
                                        `${selectedClosedOperation.crypto} - ${selectedClosedOperation.type} (CERRADA)`
                                    ),
                                    React.createElement('div', { style: styles.detailBadges },
                                        React.createElement('span', {
                                            style: {
                                                ...styles.detailBadge,
                                                backgroundColor: selectedClosedOperation.type === 'LONG' ? 'rgba(136, 212, 152, 0.15)' : 'rgba(232, 155, 165, 0.15)',
                                                color: selectedClosedOperation.type === 'LONG' ? '#88D498' : '#E89BA5'
                                            }
                                        }, selectedClosedOperation.type),
                                        React.createElement('span', {
                                            style: {
                                                ...styles.detailBadge,
                                                backgroundColor: 'rgba(124, 157, 212, 0.15)',
                                                color: '#7C9DD4'
                                            }
                                        }, selectedClosedOperation.operationType.toUpperCase()),
                                        React.createElement('span', { style: styles.detailBadge }, 
                                            `${selectedClosedOperation.leverage}x`
                                        ),
                                        React.createElement('span', { 
                                            style: { ...styles.detailBadge, backgroundColor: 'rgba(136, 212, 152, 0.15)', color: '#88D498' } 
                                        }, 'üéØ CERRADA')
                                    )
                                ),

                                // RESUMEN FINAL
                                React.createElement('div', { style: styles.finalSummary },
                                    React.createElement('h3', { style: styles.sectionTitle }, 'Resumen Final'),
                                    React.createElement('div', { style: styles.summaryGrid },
                                        React.createElement('div', { style: styles.summaryItem },
                                            React.createElement('span', { style: styles.summaryLabel }, 'P&L Total:'),
                                            React.createElement('span', { 
                                                style: {
                                                    ...styles.summaryValue,
                                                    color: selectedClosedOperation.totalPnL >= 0 ? '#88D498' : '#E89BA5',
                                                    fontSize: '1.2rem',
                                                    fontWeight: '700'
                                                } 
                                            }, (selectedClosedOperation.totalPnL >= 0 ? '+' : '') + formatCurrency(selectedClosedOperation.totalPnL))
                                        ),
                                        React.createElement('div', { style: styles.summaryItem },
                                            React.createElement('span', { style: styles.summaryLabel }, 'PEPP Final:'),
                                            React.createElement('span', { style: styles.summaryValue }, 
                                                formatCurrency(selectedClosedOperation.pepp)
                                            )
                                        ),
                                        React.createElement('div', { style: styles.summaryItem },
                                            React.createElement('span', { style: styles.summaryLabel }, 'Precio Liquidaci√≥n:'),
                                            React.createElement('span', { style: styles.summaryValue }, 
                                                formatCurrency(liquidationPrice)
                                            )
                                        ),
                                        React.createElement('div', { style: styles.summaryItem },
                                            React.createElement('span', { style: styles.summaryLabel }, 'Total Ejecutado:'),
                                            React.createElement('span', { style: styles.summaryValue }, 
                                                formatCurrency(selectedClosedOperation.realTotalExecuted)
                                            )
                                        )
                                    )
                                ),

                                // HISTORIAL ENTRADAS
                                React.createElement('div', { style: styles.entriesSection },
                                    React.createElement('h3', { style: styles.sectionTitle }, 
                                        `Historial de Entradas DCA (${closedOperationEntries.length})`
                                    ),
                                    closedOperationEntries.length > 0 && React.createElement('div', { style: styles.entriesTable },
                                        React.createElement('table', { style: styles.table },
                                            React.createElement('thead', null,
                                                React.createElement('tr', { style: styles.tableHeaderRow },
                                                    React.createElement('th', { style: styles.th }, 'Fecha'),
                                                    React.createElement('th', { style: styles.th }, 'Ejecutado'),
                                                    React.createElement('th', { style: styles.th }, 'Margen'),
                                                    React.createElement('th', { style: styles.th }, 'Precio'),
                                                    React.createElement('th', { style: styles.th }, 'Unidades')
                                                )
                                            ),
                                            React.createElement('tbody', null,
                                                closedOperationEntries.map((entry) => (
                                                    React.createElement('tr', { key: entry.id, style: styles.tableRow },
                                                        React.createElement('td', { style: styles.td }, 
                                                            new Date(entry.created_at).toLocaleDateString('es-ES')
                                                        ),
                                                        React.createElement('td', { style: styles.td }, 
                                                            formatCurrency(entry.executed || 0)
                                                        ),
                                                        React.createElement('td', { style: styles.td }, 
                                                            formatCurrency(entry.margin || 0)
                                                        ),
                                                        React.createElement('td', { style: styles.td }, 
                                                            formatCurrency(entry.entry_price || 0)
                                                        ),
                                                        React.createElement('td', { style: styles.td }, 
                                                            (entry.units || 0).toFixed(8)
                                                        )
                                                    )
                                                ))
                                            )
                                        )
                                    )
                                ),

                                // TPs EJECUTADOS
                                React.createElement('div', { style: styles.tpSection },
                                    React.createElement('h3', { style: styles.sectionTitle }, 'Take Profits Ejecutados'),
                                    React.createElement('div', { style: styles.tpGrid },
                                        closedOperationTPs.filter(tp => tp.executed).map((tp) => {
                                            const unitsExecuted = (totalUnitsFromEntries * tp.percentage) / 100;
                                            const profit = (tp.price - selectedClosedOperation.pepp) * unitsExecuted;
                                            const executedValue = unitsExecuted * tp.price;
                                            const executedMargin = executedValue / selectedClosedOperation.leverage;
                                            const executedLeveraged = executedValue - executedMargin;

                                            return React.createElement('div', { 
                                                key: tp.number, 
                                                style: { ...styles.tpCard, backgroundColor: 'rgba(136, 212, 152, 0.08)', borderColor: 'rgba(136, 212, 152, 0.2)' }
                                            },
                                                React.createElement('div', { style: styles.tpHeader },
                                                    React.createElement('span', { style: styles.tpNumber }, `TP${tp.number}`),
                                                    React.createElement('span', { style: styles.executedBadge }, '‚úÖ Ejecutado')
                                                ),
                                                React.createElement('div', { style: styles.tpInfo },
                                                    React.createElement('div', { style: styles.tpRow },
                                                        React.createElement('span', { style: styles.tpLabel }, 'Precio:'),
                                                        React.createElement('span', { style: styles.tpValue }, formatCurrency(tp.price))
                                                    ),
                                                    React.createElement('div', { style: styles.tpRow },
                                                        React.createElement('span', { style: styles.tpLabel }, 'Vendido:'),
                                                        React.createElement('span', { style: styles.tpValue }, `${tp.percentage}%`)
                                                    ),
                                                    React.createElement('div', { style: styles.tpRow },
                                                        React.createElement('span', { style: styles.tpLabel }, 'Ejecutado:'),
                                                        React.createElement('span', { style: styles.tpValue }, 
                                                            tp.executedDate ? new Date(tp.executedDate).toLocaleDateString('es-ES', {
                                                                day: '2-digit',
                                                                month: '2-digit',
                                                                year: '2-digit',
                                                                hour: '2-digit',
                                                                minute: '2-digit'
                                                            }) : '-'
                                                        )
                                                    ),
                                                    React.createElement('div', { style: styles.tpRow },
                                                        React.createElement('span', { style: styles.tpLabel }, 'Profit:'),
                                                        React.createElement('span', { 
                                                            style: { ...styles.tpValue, color: profit >= 0 ? '#88D498' : '#E89BA5' } 
                                                        }, (profit >= 0 ? '+' : '') + formatCurrency(profit))
                                                    )
                                                )
                                            );
                                        })
                                    )
                                ),

                                React.createElement('div', { style: styles.detailActions },
                                    React.createElement('button', {
                                        onClick: () => setCurrentView('closed-operations'),
                                        style: styles.primaryBtn
                                    }, 'Volver al Historial')
                                )
                            )
                        )
                    )
                );
            }

            // VISTA SPOT TRADING
            if (currentView === 'spot') {
                return React.createElement('div', { style: styles.app },
                    React.createElement('header', { style: styles.header },
                        React.createElement('div', { style: styles.headerContent },
                            React.createElement('div', { style: styles.headerLeft },
                                React.createElement('div', { style: styles.logo }, 'SP'),
                                React.createElement('h1', { style: styles.title }, 'SPOT Trading')
                            ),
                            React.createElement('div', { style: styles.headerRight },
                                React.createElement('button', { 
                                    onClick: () => setCurrentView('dashboard'), 
                                    style: styles.backBtn 
                                }, '‚Üê Futuros'),
                                React.createElement('button', { 
                                    onClick: handleLogout, 
                                    style: styles.logoutBtn 
                                }, 'Salir')
                            )
                        )
                    ),

                    React.createElement('main', { style: styles.main },
                        // M√âTRICAS CONSOLIDADAS SPOT
                        React.createElement('div', { style: styles.metricsGrid },
                            React.createElement('div', { style: styles.metricCard },
                                React.createElement('div', { style: styles.metricContent },
                                    React.createElement('div', { style: styles.metricHeader },
                                        React.createElement('span', { style: styles.metricTitle }, 'CAPITAL SPOT'),
                                        React.createElement('span', { style: styles.metricIcon }, 'üìà')
                                    ),
                                    React.createElement('div', { style: styles.metricValue },
                                        formatCurrency(spotOperations.reduce((sum, op) => 
                                            sum + op.ownCapital + op.additionalMargin, 0))
                                    ),
                                    React.createElement('div', { style: styles.metricLabel }, 'Total invertido en SPOT')
                                )
                            ),
                            React.createElement('div', { style: styles.metricCard },
                                React.createElement('div', { style: styles.metricContent },
                                    React.createElement('div', { style: styles.metricHeader },
                                        React.createElement('span', { style: styles.metricTitle }, 'OPERACIONES ACTIVAS'),
                                        React.createElement('span', { style: styles.metricIcon }, 'üíé')
                                    ),
                                    React.createElement('div', { style: styles.metricValue },
                                        spotOperations.length
                                    ),
                                    React.createElement('div', { style: styles.metricLabel }, 'Posiciones abiertas')
                                )
                            ),
                            React.createElement('div', { style: styles.metricCard },
                                React.createElement('div', { style: styles.metricContent },
                                    React.createElement('div', { style: styles.metricHeader },
                                        React.createElement('span', { style: styles.metricTitle }, 'LIQUIDEZ DISPONIBLE'),
                                        React.createElement('span', { style: styles.metricIcon }, 'üí∞')
                                    ),
                                    React.createElement('div', { style: styles.metricValue },
                                        formatCurrency(portfolio.availableLiquidity)
                                    ),
                                    React.createElement('div', { style: styles.metricLabel }, 'Para nuevas inversiones')
                                )
                            )
                        ),

                        // OPERACIONES SPOT ACTIVAS
                        React.createElement('div', { style: styles.operationsCard },
                            React.createElement('div', { style: styles.operationsHeader },
                                React.createElement('h2', { style: styles.sectionTitle }, 
                                    `Operaciones SPOT (${spotOperations.length})`
                                ),
                                React.createElement('button', {
                                    onClick: () => setCurrentView('new-spot-operation'),
                                    style: styles.newOperationBtn
                                }, '+ Nueva SPOT')
                            ),

                            spotOperations.length === 0 ? 
                                React.createElement('div', { style: styles.emptyState },
                                    React.createElement('div', { style: styles.emptyStateContent },
                                        React.createElement('h3', { style: styles.emptyStateTitle }, 
                                            'üìà Sin operaciones SPOT'
                                        ),
                                        React.createElement('p', { style: styles.emptyStateText }, 
                                            'Crea tu primera operaci√≥n SPOT sin apalancamiento para empezar a construir tu portafolio.'
                                        )
                                    )
                                ) :
                                React.createElement('div', { style: styles.tableWrapper },
                                    React.createElement('table', { style: styles.table },
                                        React.createElement('thead', null,
                                            React.createElement('tr', { style: styles.tableHeaderRow },
                                                React.createElement('th', { style: styles.th }, 'CRYPTO'),
                                                React.createElement('th', { style: styles.th }, 'TIPO'),
                                                React.createElement('th', { style: styles.th }, 'OPERACI√ìN'),
                                                React.createElement('th', { style: styles.th }, 'CAPITAL'),
                                                React.createElement('th', { style: styles.th }, 'TOTAL'),
                                                React.createElement('th', { style: styles.th }, 'ACCIONES')
                                            )
                                        ),
                                        React.createElement('tbody', null,
                                            spotOperations.map((operation) => {
                                                return React.createElement('tr', { key: operation.id, style: styles.tableRow },
                                                    React.createElement('td', { style: styles.td },
                                                        React.createElement('span', { style: styles.cryptoName }, operation.crypto)
                                                    ),
                                                    React.createElement('td', { style: styles.td },
                                                        React.createElement('span', {
                                                            style: {
                                                                ...styles.typeBadge,
                                                                backgroundColor: operation.type === 'BUY' ? 'rgba(136, 212, 152, 0.15)' : 'rgba(232, 155, 165, 0.15)',
                                                                color: operation.type === 'BUY' ? '#88D498' : '#E89BA5'
                                                            }
                                                        }, operation.type)
                                                    ),
                                                    React.createElement('td', { style: styles.td },
                                                        React.createElement('span', { style: styles.operationTypeBadge }, 
                                                            'SPOT'
                                                        )
                                                    ),
                                                    React.createElement('td', { style: styles.td }, 
                                                        formatCurrency(operation.ownCapital + operation.additionalMargin)
                                                    ),
                                                    React.createElement('td', { style: styles.td }, 
                                                        formatCurrency(operation.totalInvestment + operation.additionalMargin)
                                                    ),
                                                    React.createElement('td', { style: styles.td },
                                                        React.createElement('div', { style: styles.actionButtons },
                                                            React.createElement('button', {
                                                                onClick: () => handleViewSpotDetail(operation),
                                                                style: styles.actionBtn
                                                            }, 'Ver'),
                                                            user.role === 'admin' && React.createElement('button', {
                                                                onClick: () => handleDeleteSpotOperation(operation.id),
                                                                style: {...styles.actionBtn, backgroundColor: 'rgba(232, 155, 165, 0.15)', color: '#E89BA5'}
                                                            }, 'üóëÔ∏è')
                                                        )
                                                    )
                                                );
                                            })
                                        )
                                    )
                                )
                        )
                    )
                );
            }

            // VISTA NUEVA OPERACI√ìN SPOT
            if (currentView === 'new-spot-operation') {
                return React.createElement('div', { style: styles.app },
                    React.createElement('header', { style: styles.header },
                        React.createElement('div', { style: styles.headerContent },
                            React.createElement('div', { style: styles.headerLeft },
                                React.createElement('div', { style: styles.logo }, 'SP'),
                                React.createElement('h1', { style: styles.title }, 'Nueva Operaci√≥n SPOT')
                            ),
                            React.createElement('div', { style: styles.headerRight },
                                React.createElement('button', { 
                                    onClick: () => setCurrentView('dashboard'), 
                                    style: styles.backBtn 
                                }, '‚Üê Dashboard'),
                                React.createElement('button', { 
                                    onClick: handleLogout, 
                                    style: styles.logoutBtn 
                                }, 'Salir')
                            )
                        )
                    ),

                    React.createElement('main', { style: styles.main },
                        React.createElement('div', { style: styles.formContainer },
                            React.createElement('div', { style: styles.formCard },
                                React.createElement('h2', { style: styles.formTitle }, 'üìà Nueva Operaci√≥n SPOT'),
                                React.createElement('p', { style: styles.formSubtitle }, 
                                    'Inversi√≥n directa sin apalancamiento. Tu capital = tu posici√≥n.'
                                ),

                                React.createElement('form', { onSubmit: handleCreateSpotOperation, style: styles.form },
                                    React.createElement('div', { style: styles.inputRow },
                                        React.createElement('div', { style: styles.inputGroup },
                                            React.createElement('label', { style: styles.label }, 'Criptomoneda'),
                                            React.createElement('input', {
                                                type: 'text',
                                                placeholder: 'BTC, ETH, ADA...',
                                                style: styles.input,
                                                value: newSpotOperation.crypto,
                                                onChange: (e) => setNewSpotOperation({...newSpotOperation, crypto: e.target.value.toUpperCase()}),
                                                required: true
                                            })
                                        ),
                                        React.createElement('div', { style: styles.inputGroup },
                                            React.createElement('label', { style: styles.label }, 'Tipo de Operaci√≥n'),
                                            React.createElement('select', {
                                                style: styles.select,
                                                value: newSpotOperation.type,
                                                onChange: (e) => setNewSpotOperation({...newSpotOperation, type: e.target.value}),
                                                required: true
                                            },
                                                React.createElement('option', { value: 'LONG' }, 'LONG (Comprar)'),
                                                React.createElement('option', { value: 'SHORT' }, 'SHORT (Vender)')
                                            )
                                        )
                                    ),

                                    React.createElement('div', { style: styles.inputRow },
                                        React.createElement('div', { style: styles.inputGroup },
                                            React.createElement('label', { style: styles.label }, 
                                                `Capital a Invertir (Disponible: ${formatCurrency(portfolio.availableLiquidity)})`
                                            ),
                                            React.createElement('input', {
                                                type: 'number',
                                                step: '0.01',
                                                placeholder: '1000.00',
                                                style: styles.input,
                                                value: newSpotOperation.capital,
                                                onChange: (e) => setNewSpotOperation({...newSpotOperation, capital: e.target.value}),
                                                max: portfolio.availableLiquidity,
                                                required: true
                                            })
                                        ),
                                        React.createElement('div', { style: styles.inputGroup },
                                            React.createElement('label', { style: styles.label }, 'Precio de Entrada'),
                                            React.createElement('input', {
                                                type: 'number',
                                                step: '0.00000001',
                                                placeholder: '95000.00',
                                                style: styles.input,
                                                value: newSpotOperation.entryPrice,
                                                onChange: (e) => setNewSpotOperation({...newSpotOperation, entryPrice: e.target.value}),
                                                required: true
                                            })
                                        )
                                    ),

                                    React.createElement('div', { style: styles.inputGroup },
                                        React.createElement('label', { style: styles.label }, 'Fecha y Hora de Operaci√≥n'),
                                        React.createElement('input', {
                                            type: 'datetime-local',
                                            value: newSpotOperation.operationDate,
                                            onChange: (e) => setNewSpotOperation({...newSpotOperation, operationDate: e.target.value}),
                                            style: styles.input,
                                            required: true
                                        })
                                    ),

                                    // Preview de la operaci√≥n SPOT
                                    newSpotOperation.capital && newSpotOperation.entryPrice && parseFloat(newSpotOperation.capital) > 0 && parseFloat(newSpotOperation.entryPrice) > 0 && React.createElement('div', { style: styles.spotPreview },
                                        React.createElement('h4', { style: styles.previewTitle }, 'üìä Preview Operaci√≥n SPOT'),
                                        React.createElement('div', { style: styles.previewInfo },
                                            React.createElement('div', { style: styles.previewRow },
                                                React.createElement('span', { style: styles.previewLabel }, 'Unidades a Comprar:'),
                                                React.createElement('span', { style: styles.previewValue }, 
                                                    (parseFloat(newSpotOperation.capital) / parseFloat(newSpotOperation.entryPrice)).toFixed(8)
                                                )
                                            ),
                                            React.createElement('div', { style: styles.previewRow },
                                                React.createElement('span', { style: styles.previewLabel }, 'Inversi√≥n Total:'),
                                                React.createElement('span', { style: styles.previewValue }, 
                                                    formatCurrency(parseFloat(newSpotOperation.capital))
                                                )
                                            ),
                                            React.createElement('div', { style: styles.previewRow },
                                                React.createElement('span', { style: styles.previewLabel }, 'Liquidez Restante:'),
                                                React.createElement('span', { 
                                                    style: { 
                                                        ...styles.previewValue, 
                                                        color: (portfolio.availableLiquidity - parseFloat(newSpotOperation.capital)) >= 0 ? '#88D498' : '#E89BA5'
                                                    } 
                                                }, formatCurrency(portfolio.availableLiquidity - parseFloat(newSpotOperation.capital)))
                                            )
                                        )
                                    ),

                                    React.createElement('div', { style: styles.spotInfo },
                                        React.createElement('h4', { style: styles.infoTitle }, 'üìä Informaci√≥n SPOT'),
                                        React.createElement('div', { style: styles.infoGrid },
                                            React.createElement('div', { style: styles.infoItem },
                                                React.createElement('span', { style: styles.infoLabel }, 'Apalancamiento:'),
                                                React.createElement('span', { style: styles.infoValue }, '1x (Sin leverage)')
                                            ),
                                            React.createElement('div', { style: styles.infoItem },
                                                React.createElement('span', { style: styles.infoLabel }, 'Riesgo de Liquidaci√≥n:'),
                                                React.createElement('span', { 
                                                    style: { ...styles.infoValue, color: '#88D498' } 
                                                }, 'NINGUNO ‚úÖ')
                                            ),
                                            React.createElement('div', { style: styles.infoItem },
                                                React.createElement('span', { style: styles.infoLabel }, 'Capital = Posici√≥n:'),
                                                React.createElement('span', { style: styles.infoValue }, '100% propio')
                                            )
                                        )
                                    ),

                                    spotOperationError && React.createElement('div', { style: styles.error }, spotOperationError),

                                    React.createElement('div', { style: styles.formActions },
                                        React.createElement('button', { 
                                            type: 'button',
                                            onClick: () => setCurrentView('dashboard'),
                                            style: styles.cancelBtn 
                                        }, 'Cancelar'),
                                        React.createElement('button', { 
                                            type: 'submit',
                                            disabled: savingSpotOperation || !newSpotOperation.crypto || !newSpotOperation.capital || !newSpotOperation.entryPrice,
                                            style: {
                                                ...styles.createBtn,
                                                opacity: (savingSpotOperation || !newSpotOperation.crypto || !newSpotOperation.capital || !newSpotOperation.entryPrice) ? 0.6 : 1
                                            }
                                        }, savingSpotOperation ? 'Creando...' : 'Crear Operaci√≥n SPOT')
                                    )
                                )
                            )
                        )
                    )
                );
            }

            // VISTA DETALLE OPERACI√ìN SPOT
            if (currentView === 'spot-detail' && selectedOperation) {
                const totalExecuted = operationEntries.reduce((sum, entry) => sum + parseFloat(entry.executed || 0), 0);
                const totalMargin = operationEntries.reduce((sum, entry) => sum + parseFloat(entry.margin || 0), 0);
                const totalUnits = operationEntries.reduce((sum, entry) => sum + parseFloat(entry.units || 0), 0);
                const totalIPonderada = operationEntries.reduce((sum, entry) => sum + parseFloat(entry.i_ponderada || 0), 0);
                
                // PEPP (Precio Entrada Promedio Ponderado)
                const pepp = totalExecuted > 0 ? totalIPonderada / totalExecuted : 0;
                
                // SPOT no tiene liquidaci√≥n (sin apalancamiento)
                const noLiquidationRisk = true;

                return React.createElement('div', { style: styles.app },
                    React.createElement('header', { style: styles.header },
                        React.createElement('div', { style: styles.headerContent },
                            React.createElement('div', { style: styles.headerLeft },
                                React.createElement('div', { style: styles.logo }, 'SP'),
                                React.createElement('h1', { style: styles.title }, 
                                    `${selectedOperation.crypto} - ${selectedOperation.type} SPOT`
                                )
                            ),
                            React.createElement('div', { style: styles.headerRight },
                                React.createElement('button', { 
                                    onClick: () => setCurrentView('dashboard'), 
                                    style: styles.backBtn 
                                }, '‚Üê Dashboard'),
                                React.createElement('button', { 
                                    onClick: handleLogout, 
                                    style: styles.logoutBtn 
                                }, 'Salir')
                            )
                        )
                    ),

                    React.createElement('main', { style: styles.main },
                        React.createElement('div', { style: styles.detailContainer },
                            React.createElement('div', { style: styles.detailCard },
                                // HEADER
                                React.createElement('div', { style: styles.detailHeader },
                                    React.createElement('h2', { style: styles.detailTitle }, 
                                        `${selectedOperation.crypto} - ${selectedOperation.type} SPOT`
                                    ),
                                    React.createElement('div', { style: styles.detailBadges },
                                        React.createElement('span', {
                                            style: {
                                                ...styles.detailBadge,
                                                backgroundColor: selectedOperation.type === 'LONG' ? 'rgba(136, 212, 152, 0.15)' : 'rgba(232, 155, 165, 0.15)',
                                                color: selectedOperation.type === 'LONG' ? '#88D498' : '#E89BA5'
                                            }
                                        }, selectedOperation.type),
                                        React.createElement('span', {
                                            style: {
                                                ...styles.detailBadge,
                                                backgroundColor: 'rgba(136, 212, 152, 0.15)',
                                                color: '#88D498'
                                            }
                                        }, 'SPOT'),
                                        React.createElement('span', { style: styles.detailBadge }, '1x'),
                                        React.createElement('span', { 
                                            style: { ...styles.detailBadge, backgroundColor: 'rgba(136, 212, 152, 0.15)', color: '#88D498' } 
                                        }, 'SIN RIESGO')
                                    )
                                ),

                                // M√âTRICAS DE OPERACI√ìN SPOT
                                React.createElement('div', { style: styles.metricsSection },
                                    React.createElement('h3', { style: styles.sectionTitle }, 'M√©tricas de Operaci√≥n'),
                                    React.createElement('div', { style: styles.metricsGrid },
                                        React.createElement('div', { style: styles.metricItem },
                                            React.createElement('span', { style: styles.metricLabel }, 'PEPP'),
                                            React.createElement('span', { style: styles.metricValue }, 
                                                pepp > 0 ? formatCurrency(pepp) : 'N/A'
                                            )
                                        ),
                                        React.createElement('div', { style: styles.metricItem },
                                            React.createElement('span', { style: styles.metricLabel }, 'RIESGO LIQUIDACI√ìN'),
                                            React.createElement('span', { 
                                                style: {...styles.metricValue, color: '#88D498'} 
                                            }, 'NINGUNO ‚úÖ')
                                        ),
                                        React.createElement('div', { style: styles.metricItem },
                                            React.createElement('span', { style: styles.metricLabel }, 'TOTAL EJECUTADO'),
                                            React.createElement('span', { style: styles.metricValue }, 
                                                formatCurrency(totalExecuted)
                                            )
                                        ),
                                        React.createElement('div', { style: styles.metricItem },
                                            React.createElement('span', { style: styles.metricLabel }, 'TOTAL UNIDADES'),
                                            React.createElement('span', { style: styles.metricValue }, 
                                                totalUnits.toFixed(8)
                                            )
                                        )
                                    )
                                ),

                                // HISTORIAL ENTRADAS SPOT
                                React.createElement('div', { style: styles.entriesSection },
                                    React.createElement('div', { style: styles.entriesHeader },
                                        React.createElement('h3', { style: styles.sectionTitle }, 
                                            `Historial de Entradas (${operationEntries.length})`
                                        ),
                                        React.createElement('button', {
                                            onClick: () => setShowAddEntry(true),
                                            style: styles.addEntryBtn
                                        }, '+ Agregar Entrada')
                                    ),

                                    operationEntries.length > 0 && React.createElement('div', { style: styles.entriesTable },
                                        React.createElement('table', { style: styles.table },
                                            React.createElement('thead', null,
                                                React.createElement('tr', { style: styles.tableHeaderRow },
                                                    React.createElement('th', { style: styles.th }, 'Fecha'),
                                                    React.createElement('th', { style: styles.th }, 'Ejecutado'),
                                                    React.createElement('th', { style: styles.th }, 'Capital'),
                                                    React.createElement('th', { style: styles.th }, 'Precio'),
                                                    React.createElement('th', { style: styles.th }, 'Unidades'),
                                                    React.createElement('th', { style: styles.th }, 'I-Ponderada')
                                                )
                                            ),
                                            React.createElement('tbody', null,
                                                operationEntries.map((entry) => (
                                                    React.createElement('tr', { key: entry.id, style: styles.tableRow },
                                                        React.createElement('td', { style: styles.td }, 
                                                            new Date(entry.created_at).toLocaleDateString('es-ES')
                                                        ),
                                                        React.createElement('td', { style: styles.td }, 
                                                            formatCurrency(entry.executed || 0)
                                                        ),
                                                        React.createElement('td', { style: styles.td }, 
                                                            formatCurrency(entry.margin || 0)
                                                        ),
                                                        React.createElement('td', { style: styles.td }, 
                                                            formatCurrency(entry.entry_price || 0)
                                                        ),
                                                        React.createElement('td', { style: styles.td }, 
                                                            (entry.units || 0).toFixed(8)
                                                        ),
                                                        React.createElement('td', { style: styles.td }, 
                                                            formatCurrency(entry.i_ponderada || 0)
                                                        )
                                                    )
                                                ))
                                            )
                                        )
                                    ),

                                    // FORMULARIO AGREGAR ENTRADA SPOT
                                    showAddEntry && React.createElement('div', { style: styles.addEntryForm },
                                        React.createElement('h4', { style: styles.formTitle }, 'üí∞ Agregar Entrada SPOT'),
                                        React.createElement('p', { style: styles.formSubtitle }, 'DCA sin apalancamiento. Tu capital = tu inversi√≥n directa.'),

                                        React.createElement('form', { onSubmit: handleAddEntry, style: styles.entryForm },
                                            React.createElement('div', { style: styles.formRow },
                                                React.createElement('div', { style: styles.inputGroup },
                                                    React.createElement('label', { style: styles.label }, 'Precio de Entrada'),
                                                    React.createElement('input', {
                                                        type: 'number',
                                                        step: '0.00000001',
                                                        value: newEntry.entryPrice,
                                                        onChange: (e) => setNewEntry({...newEntry, entryPrice: e.target.value}),
                                                        style: styles.input,
                                                        placeholder: '95000.00',
                                                        required: true
                                                    })
                                                ),
                                                React.createElement('div', { style: styles.inputGroup },
                                                    React.createElement('label', { style: styles.label }, `Capital SPOT (Disponible: ${formatCurrency(portfolio.availableLiquidity)})`),
                                                    React.createElement('input', {
                                                        type: 'number',
                                                        step: '0.01',
                                                        value: newEntry.margin,
                                                        onChange: (e) => setNewEntry({...newEntry, margin: e.target.value}),
                                                        style: styles.input,
                                                        placeholder: '1000.00',
                                                        max: portfolio.availableLiquidity,
                                                        required: true
                                                    })
                                                )
                                            ),

                                            React.createElement('div', { style: styles.inputGroup },
                                                React.createElement('label', { style: styles.label }, 'Fecha y Hora de Entrada'),
                                                React.createElement('input', {
                                                    type: 'datetime-local',
                                                    value: newEntry.entryDate,
                                                    onChange: (e) => setNewEntry({...newEntry, entryDate: e.target.value}),
                                                    style: styles.input,
                                                    required: true
                                                })
                                            ),

                                            // Preview SPOT (sin apalancamiento)
                                            newEntry.entryPrice && newEntry.margin && React.createElement('div', { style: styles.entryPreview },
                                                React.createElement('h5', { style: styles.previewTitle }, 'üìä Preview SPOT (Sin Apalancamiento)'),
                                                React.createElement('div', { style: styles.previewRow },
                                                    React.createElement('span', { style: styles.previewLabel }, 'Ejecutado:'),
                                                    React.createElement('span', { style: styles.previewValue }, 
                                                        formatCurrency(parseFloat(newEntry.margin || 0)) + ' (1:1)'
                                                    )
                                                ),
                                                React.createElement('div', { style: styles.previewRow },
                                                    React.createElement('span', { style: styles.previewLabel }, 'Unidades:'),
                                                    React.createElement('span', { style: styles.previewValue }, 
                                                        newEntry.entryPrice ? 
                                                        (parseFloat(newEntry.margin || 0) / parseFloat(newEntry.entryPrice)).toFixed(8)
                                                        : '0.00000000'
                                                    )
                                                )
                                            ),

                                            entryError && React.createElement('div', { style: styles.error }, entryError),

                                            React.createElement('div', { style: styles.entryFormActions },
                                                React.createElement('button', { 
                                                    type: 'button',
                                                    onClick: () => setShowAddEntry(false),
                                                    style: styles.cancelBtn 
                                                }, 'Cancelar'),
                                                React.createElement('button', { 
                                                    type: 'submit',
                                                    disabled: savingEntry,
                                                    style: {
                                                        ...styles.submitBtn,
                                                        opacity: savingEntry ? 0.6 : 1
                                                    }
                                                }, savingEntry ? 'Agregando...' : 'Agregar Entrada SPOT')
                                            )
                                        )
                                    )
                                ),

                                // SECCI√ìN TAKE PROFITS SPOT
                                React.createElement('div', { style: styles.tpSection },
                                    React.createElement('div', { style: styles.tpHeader },
                                        React.createElement('h3', { style: styles.sectionTitle }, 'Take Profits SPOT'),
                                        React.createElement('button', {
                                            onClick: () => setShowConfigureTPs(true),
                                            style: styles.configureTpsBtn
                                        }, '‚öôÔ∏è Configurar TPs')
                                    ),

                                    React.createElement('div', { style: styles.tpGrid },
                                        operationTPs.slice(0, 3).map((tp) => {
                                            return React.createElement('div', { 
                                                key: tp.number, 
                                                style: {
                                                    ...styles.tpCard,
                                                    backgroundColor: tp.executed ? 'rgba(136, 212, 152, 0.08)' : 'rgba(37, 41, 54, 0.6)',
                                                    borderColor: tp.executed ? 'rgba(136, 212, 152, 0.2)' : 'rgba(168, 178, 193, 0.1)'
                                                }
                                            },
                                                React.createElement('div', { style: styles.tpHeader },
                                                    React.createElement('span', { style: styles.tpNumber }, `TP${tp.number}`),
                                                    tp.executed && React.createElement('span', { style: styles.executedBadge }, '‚úÖ Ejecutado')
                                                ),
                                                tp.price ? React.createElement('div', { style: styles.tpInfo },
                                                    React.createElement('div', { style: styles.tpRow },
                                                        React.createElement('span', { style: styles.tpLabel }, 'Precio:'),
                                                        React.createElement('span', { style: styles.tpValue }, formatCurrency(tp.price))
                                                    ),
                                                    React.createElement('div', { style: styles.tpRow },
                                                        React.createElement('span', { style: styles.tpLabel }, 'Vender:'),
                                                        React.createElement('span', { style: styles.tpValue }, `${tp.percentage}%`)
                                                    ),
                                                    !tp.executed && React.createElement('div', { style: styles.tpActions },
                                                        React.createElement('button', {
                                                            onClick: () => handleExecuteTP(tp, true),
                                                            style: styles.executeTpBtn
                                                        }, 'üöÄ Ejecutar SPOT')
                                                    )
                                                ) : React.createElement('div', { style: styles.tpInfo },
                                                    React.createElement('span', { style: styles.tpNotConfigured }, 'No configurado')
                                                )
                                            );
                                        })
                                    )
                                ),

                                // FORMULARIO CONFIGURAR TPS SPOT
                                showConfigureTPs && React.createElement('div', { style: styles.configureTpsForm },
                                    React.createElement('h4', { style: styles.formTitle }, '‚öôÔ∏è Configurar Take Profits SPOT'),
                                    React.createElement('p', { style: styles.formSubtitle }, 'Define los precios para vender por partes tu posici√≥n SPOT.'),

                                    React.createElement('form', { onSubmit: (e) => { e.preventDefault(); handleSaveTPs(); }, style: styles.tpConfigForm },
                                        React.createElement('div', { style: styles.tpConfigGrid },
                                            tpConfig.map((tp, index) => (
                                                React.createElement('div', { key: index, style: styles.tpConfigRow },
                                                    React.createElement('div', { style: styles.tpConfigLabel },
                                                        React.createElement('span', { style: styles.tpConfigNumber }, `TP${index + 1}`)
                                                    ),
                                                    React.createElement('div', { style: styles.tpConfigInputs },
                                                        React.createElement('input', {
                                                            type: 'number',
                                                            step: '0.00000001',
                                                            placeholder: 'Precio',
                                                            value: tp.price,
                                                            onChange: (e) => {
                                                                const newConfig = [...tpConfig];
                                                                newConfig[index].price = e.target.value;
                                                                setTpConfig(newConfig);
                                                            },
                                                            style: styles.tpInput
                                                        }),
                                                        React.createElement('input', {
                                                            type: 'number',
                                                            step: '0.01',
                                                            placeholder: '% Vender',
                                                            value: tp.percentage,
                                                            min: 0,
                                                            max: 100,
                                                            onChange: (e) => {
                                                                const newConfig = [...tpConfig];
                                                                newConfig[index].percentage = e.target.value;
                                                                setTpConfig(newConfig);
                                                            },
                                                            style: styles.tpInput
                                                        })
                                                    )
                                                )
                                            ))
                                        ),

                                        // Preview total percentage for SPOT
                                        tpConfig.some(tp => tp.percentage) && React.createElement('div', { style: styles.tpPreview },
                                            React.createElement('div', { style: styles.tpPreviewRow },
                                                React.createElement('span', { style: styles.tpPreviewLabel }, 'Total a vender:'),
                                                React.createElement('span', {
                                                    style: {
                                                        ...styles.tpPreviewValue,
                                                        color: tpConfig.reduce((sum, tp) => sum + parseFloat(tp.percentage || 0), 0) > 100 ? '#E89BA5' : '#88D498'
                                                    }
                                                }, `${tpConfig.reduce((sum, tp) => sum + parseFloat(tp.percentage || 0), 0).toFixed(1)}%`)
                                            ),
                                            React.createElement('div', { style: styles.tpPreviewRow },
                                                React.createElement('span', { style: styles.tpPreviewLabel }, 'Unidades totales:'),
                                                React.createElement('span', { style: styles.tpPreviewValue }, 
                                                    `${totalUnits.toFixed(8)} ${selectedOperation.crypto}`
                                                )
                                            )
                                        ),

                                        tpError && React.createElement('div', { style: styles.error }, tpError),

                                        React.createElement('div', { style: styles.tpConfigActions },
                                            React.createElement('button', {
                                                type: 'button',
                                                onClick: () => setShowConfigureTPs(false),
                                                style: styles.cancelBtn
                                            }, 'Cancelar'),
                                            React.createElement('button', {
                                                type: 'submit',
                                                disabled: savingTPs,
                                                style: {
                                                    ...styles.saveConfigBtn,
                                                    opacity: savingTPs ? 0.6 : 1
                                                }
                                            }, savingTPs ? 'Guardando...' : 'Guardar TPs SPOT')
                                        )
                                    )
                                ),

                                React.createElement('div', { style: styles.detailActions },
                                    React.createElement('button', {
                                        onClick: () => setCurrentView('dashboard'),
                                        style: styles.primaryBtn
                                    }, 'Volver al Dashboard')
                                )
                            )
                        )
                    )
                );
            }

            // VISTA NUEVA OPERACI√ìN UNIFICADA
            if (currentView === 'new-operation-unified') {
                const [operationType, setOperationType] = useState('futuros');
                
                return React.createElement('div', { style: styles.app },
                    React.createElement('header', { style: styles.header },
                        React.createElement('div', { style: styles.headerContent },
                            React.createElement('div', { style: styles.headerLeft },
                                React.createElement('div', { style: styles.logo }, 'NO'),
                                React.createElement('h1', { style: styles.title }, 'Nueva Operaci√≥n')
                            ),
                            React.createElement('div', { style: styles.headerRight },
                                React.createElement('button', { 
                                    onClick: () => setCurrentView('dashboard'), 
                                    style: styles.backBtn 
                                }, '‚Üê Dashboard'),
                                React.createElement('button', { 
                                    onClick: handleLogout, 
                                    style: styles.logoutBtn 
                                }, 'Salir')
                            )
                        )
                    ),

                    React.createElement('main', { style: styles.main },
                        React.createElement('div', { style: styles.formContainer },
                            React.createElement('div', { style: styles.formCard },
                                React.createElement('h2', { style: styles.formTitle }, 'üéØ Nueva Operaci√≥n'),
                                React.createElement('p', { style: styles.formSubtitle }, 'Elige el tipo de operaci√≥n y configura los par√°metros.'),

                                // SELECTOR DE TIPO MODERNO
                                React.createElement('div', { style: styles.operationTypeSelector },
                                    React.createElement('label', { style: styles.label }, 'Tipo de Operaci√≥n'),
                                    React.createElement('div', { style: styles.typeToggle },
                                        React.createElement('button', {
                                            type: 'button',
                                            onClick: () => setOperationType('futuros'),
                                            style: {
                                                ...styles.typeOption,
                                                ...(operationType === 'futuros' ? styles.typeOptionActive : {})
                                            }
                                        }, 
                                            React.createElement('div', { style: styles.typeIcon }, 'üöÄ'),
                                            React.createElement('div', null,
                                                React.createElement('div', { style: styles.typeTitle }, 'Futuros Perpetuos'),
                                                React.createElement('div', { style: styles.typeDescription }, 'Con apalancamiento')
                                            )
                                        ),
                                        React.createElement('button', {
                                            type: 'button',
                                            onClick: () => setOperationType('spot'),
                                            style: {
                                                ...styles.typeOption,
                                                ...(operationType === 'spot' ? styles.typeOptionActive : {})
                                            }
                                        },
                                            React.createElement('div', { style: styles.typeIcon }, 'üìà'),
                                            React.createElement('div', null,
                                                React.createElement('div', { style: styles.typeTitle }, 'SPOT Trading'),
                                                React.createElement('div', { style: styles.typeDescription }, 'Sin apalancamiento')
                                            )
                                        )
                                    )
                                ),

                                // FORMULARIO DIN√ÅMICO SEG√öN TIPO
                                operationType === 'futuros' ? (
                                    React.createElement('div', { style: styles.dynamicForm },
                                        React.createElement('p', { style: styles.operationInfo }, 
                                            'üöÄ Operaci√≥n con apalancamiento - Mayor ganancia, mayor riesgo'
                                        ),
                                        React.createElement('button', {
                                            onClick: () => setCurrentView('new-operation'),
                                            style: styles.continueBtn
                                        }, 'Continuar con Futuros')
                                    )
                                ) : (
                                    React.createElement('div', { style: styles.dynamicForm },
                                        React.createElement('p', { style: styles.operationInfo }, 
                                            'üìà Operaci√≥n directa - Tu capital = Tu posici√≥n'
                                        ),
                                        React.createElement('button', {
                                            onClick: () => setCurrentView('new-spot-operation'),
                                            style: styles.continueBtn
                                        }, 'Continuar con SPOT')
                                    )
                                )
                            )
                        )
                    )
                );
            }

            // VISTA AN√ÅLISIS VISUAL
            if (currentView === 'visual-analytics') {
                return React.createElement('div', { style: styles.app },
                    React.createElement('header', { style: styles.header },
                        React.createElement('div', { style: styles.headerContent },
                            React.createElement('div', { style: styles.headerLeft },
                                React.createElement('div', { style: styles.logo }, 'üìä'),
                                React.createElement('h1', { style: styles.title }, 'An√°lisis Visual - Trading Manager Pro')
                            ),
                            React.createElement('div', { style: styles.headerRight },
                                React.createElement('button', { 
                                    onClick: () => setCurrentView('dashboard'), 
                                    style: styles.backBtn 
                                }, '‚Üê Dashboard'),
                                React.createElement('button', { 
                                    onClick: handleLogout, 
                                    style: styles.logoutBtn 
                                }, 'Salir')
                            )
                        )
                    ),

                    React.createElement('main', { 
                        style: { 
                            ...styles.main,
                            display: 'grid',
                            gridTemplateColumns: '600px 1fr',
                            gap: '2rem',
                            alignItems: 'start'
                        } 
                    },
                        // LEFT SIDE: Charts
                        React.createElement('div', {
                            style: {
                                backgroundColor: '#252936',
                                borderRadius: '12px',
                                border: '1px solid rgba(168, 178, 193, 0.1)',
                                padding: '2rem'
                            }
                        },
                            React.createElement('h2', {
                                style: {
                                    fontSize: '1.5rem',
                                    fontWeight: '600',
                                    marginBottom: '2rem',
                                    color: '#E8ECEF',
                                    textAlign: 'center'
                                }
                            }, 'Gr√°ficos Interactivos'),
                            
                            React.createElement('div', {
                                style: {
                                    display: 'grid',
                                    gridTemplateColumns: '1fr 1fr',
                                    gap: '1.5rem',
                                    gridTemplateRows: '200px 200px 150px',
                                }
                            },
                                // Chart 1: Distribution
                                React.createElement('div', {
                                    style: {
                                        backgroundColor: 'rgba(37, 41, 54, 0.4)',
                                        borderRadius: '8px',
                                        padding: '1rem',
                                        border: '1px solid rgba(168, 178, 193, 0.08)'
                                    }
                                },
                                    React.createElement('h3', {
                                        style: {
                                            fontSize: '0.9rem',
                                            fontWeight: '600',
                                            marginBottom: '1rem',
                                            color: '#E8ECEF',
                                            textAlign: 'center'
                                        }
                                    }, 'Distribuci√≥n Capital'),
                                    React.createElement('div', { 
                                        style: { position: 'relative', height: '140px' } 
                                    },
                                        React.createElement('canvas', { 
                                            id: 'distributionChart',
                                            style: { width: '100%', height: '100%' }
                                        })
                                    )
                                ),
                                
                                // Chart 2: TP Profits
                                React.createElement('div', {
                                    style: {
                                        backgroundColor: 'rgba(37, 41, 54, 0.4)',
                                        borderRadius: '8px',
                                        padding: '1rem',
                                        border: '1px solid rgba(168, 178, 193, 0.08)'
                                    }
                                },
                                    React.createElement('h3', {
                                        style: {
                                            fontSize: '0.9rem',
                                            fontWeight: '600',
                                            marginBottom: '1rem',
                                            color: '#E8ECEF',
                                            textAlign: 'center'
                                        }
                                    }, 'Ganancias por TP'),
                                    React.createElement('div', { 
                                        style: { position: 'relative', height: '140px' } 
                                    },
                                        React.createElement('canvas', { 
                                            id: 'profitsChart',
                                            style: { width: '100%', height: '100%' }
                                        })
                                    )
                                ),
                                
                                // Chart 3: Capital Released - Full width
                                React.createElement('div', {
                                    style: {
                                        backgroundColor: 'rgba(37, 41, 54, 0.4)',
                                        borderRadius: '8px',
                                        padding: '1rem',
                                        border: '1px solid rgba(168, 178, 193, 0.08)',
                                        gridColumn: '1 / -1'
                                    }
                                },
                                    React.createElement('h3', {
                                        style: {
                                            fontSize: '0.9rem',
                                            fontWeight: '600',
                                            marginBottom: '1rem',
                                            color: '#E8ECEF',
                                            textAlign: 'center'
                                        }
                                    }, 'Capital Liberado Progresivo'),
                                    React.createElement('div', { 
                                        style: { position: 'relative', height: '90px' } 
                                    },
                                        React.createElement('canvas', { 
                                            id: 'releasedChart',
                                            style: { width: '100%', height: '100%' }
                                        })
                                    )
                                )
                            )
                        ),
                        
                        // RIGHT SIDE: Information Panel (like operations style)
                        React.createElement('div', { style: styles.operationsCard },
                            React.createElement('div', { style: styles.operationsHeader },
                                React.createElement('h2', { style: styles.sectionTitle }, 
                                    'An√°lisis Detallado'
                                )
                            ),

                            // TAB STYLE NAVIGATION
                            React.createElement('div', { style: styles.tabsContainer },
                                React.createElement('div', { style: styles.tabs },
                                    React.createElement('button', {
                                        onClick: () => setActiveAnalyticsTab('distribution'),
                                        style: {
                                            ...styles.tab,
                                            ...(activeAnalyticsTab === 'distribution' ? styles.tabActive : {})
                                        }
                                    }, 'Distribuci√≥n'),
                                    React.createElement('button', {
                                        onClick: () => setActiveAnalyticsTab('profits'),
                                        style: {
                                            ...styles.tab,
                                            ...(activeAnalyticsTab === 'profits' ? styles.tabActive : {})
                                        }
                                    }, 'Ganancias TP'),
                                    React.createElement('button', {
                                        onClick: () => setActiveAnalyticsTab('capital'),
                                        style: {
                                            ...styles.tab,
                                            ...(activeAnalyticsTab === 'capital' ? styles.tabActive : {})
                                        }
                                    }, 'Capital Liberado')
                                ),

                                // TAB CONTENT
                                activeAnalyticsTab === 'distribution' && React.createElement('div', { style: styles.tabContent },
                                    React.createElement('div', { style: { padding: '1.5rem' } },
                                        React.createElement('h3', { 
                                            style: { color: '#E8ECEF', fontSize: '1.2rem', marginBottom: '1rem' } 
                                        }, 'üíº Distribuci√≥n de Capital'),
                                        
                                        React.createElement('div', { style: { marginBottom: '1.5rem' } },
                                            React.createElement('div', { 
                                                style: { 
                                                    display: 'flex', 
                                                    justifyContent: 'space-between',
                                                    padding: '1rem',
                                                    backgroundColor: 'rgba(136, 212, 152, 0.1)',
                                                    borderRadius: '8px',
                                                    marginBottom: '0.5rem'
                                                }
                                            },
                                                React.createElement('span', { style: { color: '#88D498', fontWeight: '600' } }, 'SPOT'),
                                                React.createElement('span', { style: { color: '#E8ECEF' } }, 
                                                    `$${(spotOperations.reduce((sum, op) => sum + op.ownCapital + op.additionalMargin, 0)).toLocaleString()} (${((spotOperations.reduce((sum, op) => sum + op.ownCapital + op.additionalMargin, 0) / portfolio.totalCapital) * 100).toFixed(1)}%)`
                                                )
                                            ),
                                            React.createElement('div', { 
                                                style: { 
                                                    display: 'flex', 
                                                    justifyContent: 'space-between',
                                                    padding: '1rem',
                                                    backgroundColor: 'rgba(124, 157, 212, 0.1)',
                                                    borderRadius: '8px',
                                                    marginBottom: '0.5rem'
                                                }
                                            },
                                                React.createElement('span', { style: { color: '#7C9DD4', fontWeight: '600' } }, 'Futuros'),
                                                React.createElement('span', { style: { color: '#E8ECEF' } }, 
                                                    `$${(operations.reduce((sum, op) => sum + op.ownCapital + op.additionalMargin, 0)).toLocaleString()} (${((operations.reduce((sum, op) => sum + op.ownCapital + op.additionalMargin, 0) / portfolio.totalCapital) * 100).toFixed(1)}%)`
                                                )
                                            ),
                                            React.createElement('div', { 
                                                style: { 
                                                    display: 'flex', 
                                                    justifyContent: 'space-between',
                                                    padding: '1rem',
                                                    backgroundColor: 'rgba(168, 178, 193, 0.1)',
                                                    borderRadius: '8px'
                                                }
                                            },
                                                React.createElement('span', { style: { color: '#A8B2C1', fontWeight: '600' } }, 'Liquidez'),
                                                React.createElement('span', { style: { color: '#E8ECEF' } }, 
                                                    `$${portfolio.availableLiquidity.toLocaleString()} (${((portfolio.availableLiquidity / portfolio.totalCapital) * 100).toFixed(1)}%)`
                                                )
                                            )
                                        ),
                                        
                                        React.createElement('p', { 
                                            style: { color: '#A8B2C1', fontSize: '0.9rem', lineHeight: '1.5' } 
                                        }, `Tu portafolio mantiene un ${((portfolio.availableLiquidity / portfolio.totalCapital) * 100).toFixed(1)}% en liquidez, lo que te da gran flexibilidad para nuevas oportunidades. ${spotOperations.length > 0 ? 'El capital SPOT representa tu mayor exposici√≥n sin riesgo de liquidaci√≥n.' : 'Sin operaciones activas, tu capital est√° completamente l√≠quido.'}`)
                                    )
                                ),

                                activeAnalyticsTab === 'profits' && React.createElement('div', { style: styles.tabContent },
                                    React.createElement('div', { style: { padding: '1.5rem' } },
                                        React.createElement('h3', { 
                                            style: { color: '#E8ECEF', fontSize: '1.2rem', marginBottom: '1rem' } 
                                        }, 'üéØ Proyecci√≥n de Ganancias'),
                                        
                                        React.createElement('div', { 
                                            style: { 
                                                display: 'grid',
                                                gridTemplateColumns: '1fr 1fr',
                                                gap: '1rem',
                                                marginBottom: '1.5rem'
                                            }
                                        },
                                            ['TP1', 'TP2', 'TP3', 'TP4', 'TP5'].map((tp, index) => {
                                                // Calculate potential gains based on actual operations
                                                const futuresCapital = operations.reduce((sum, op) => sum + op.ownCapital + op.additionalMargin, 0);
                                                const spotCapital = spotOperations.reduce((sum, op) => sum + op.ownCapital + op.additionalMargin, 0);
                                                
                                                // Estimated ROI per TP level: 5%, 10%, 15%, 20%, 30%
                                                const roiLevels = [0.05, 0.10, 0.15, 0.20, 0.30];
                                                const futuresGain = Math.round(futuresCapital * roiLevels[index]);
                                                const spotGain = Math.round(spotCapital * roiLevels[index]);
                                                return React.createElement('div', {
                                                    key: tp,
                                                    style: {
                                                        padding: '1rem',
                                                        backgroundColor: 'rgba(37, 41, 54, 0.6)',
                                                        borderRadius: '8px',
                                                        gridColumn: index >= 4 ? '1 / -1' : undefined
                                                    }
                                                },
                                                    React.createElement('h4', { 
                                                        style: { color: '#E8ECEF', margin: '0 0 0.5rem 0' } 
                                                    }, tp),
                                                    React.createElement('div', { 
                                                        style: { fontSize: '0.85rem', color: '#7C9DD4' } 
                                                    }, `Futuros: +$${futuresGain.toLocaleString()}`),
                                                    React.createElement('div', { 
                                                        style: { fontSize: '0.85rem', color: '#88D498' } 
                                                    }, `SPOT: +$${spotGain.toLocaleString()}`)
                                                );
                                            })
                                        ),
                                        
                                        React.createElement('p', { 
                                            style: { color: '#A8B2C1', fontSize: '0.9rem', lineHeight: '1.5' } 
                                        }, 'Las proyecciones muestran el potencial de ganancia acumulativa. SPOT ofrece ganancias mayores debido al capital base m√°s alto, mientras que Futuros proporciona ROI m√°s eficiente por el apalancamiento.')
                                    )
                                ),

                                activeAnalyticsTab === 'capital' && React.createElement('div', { style: styles.tabContent },
                                    React.createElement('div', { style: { padding: '1.5rem' } },
                                        React.createElement('h3', { 
                                            style: { color: '#E8ECEF', fontSize: '1.2rem', marginBottom: '1rem' } 
                                        }, 'üîì Capital Progresivo'),
                                        
                                        React.createElement('div', { style: { marginBottom: '1.5rem' } },
                                            React.createElement('div', { 
                                                style: { 
                                                    padding: '1rem',
                                                    backgroundColor: 'rgba(124, 157, 212, 0.1)',
                                                    borderRadius: '8px',
                                                    marginBottom: '1rem'
                                                }
                                            },
                                                React.createElement('h4', { style: { color: '#7C9DD4', margin: '0 0 0.5rem 0' } }, 'Futuros - Liberaci√≥n Gradual'),
                                                React.createElement('p', { style: { color: '#A8B2C1', fontSize: '0.85rem', margin: 0 } }, 
                                                    (() => {
                                                        const futuresCapital = operations.reduce((sum, op) => sum + op.ownCapital + op.additionalMargin, 0);
                                                        if (futuresCapital === 0) return 'Sin operaciones Futuros activas';
                                                        const progression = [0.2, 0.4, 0.6, 0.8, 1.0].map(ratio => `$${Math.round(futuresCapital * ratio).toLocaleString()}`);
                                                        return `TP1: ${progression[0]} ‚Üí TP2: ${progression[1]} ‚Üí TP3: ${progression[2]} ‚Üí TP4: ${progression[3]} ‚Üí TP5: ${progression[4]}`;
                                                    })()
                                                )
                                            ),
                                            React.createElement('div', { 
                                                style: { 
                                                    padding: '1rem',
                                                    backgroundColor: 'rgba(136, 212, 152, 0.1)',
                                                    borderRadius: '8px'
                                                }
                                            },
                                                React.createElement('h4', { style: { color: '#88D498', margin: '0 0 0.5rem 0' } }, 'SPOT - Liberaci√≥n Progresiva'),
                                                React.createElement('p', { style: { color: '#A8B2C1', fontSize: '0.85rem', margin: 0 } }, 
                                                    (() => {
                                                        const spotCapital = spotOperations.reduce((sum, op) => sum + op.ownCapital + op.additionalMargin, 0);
                                                        if (spotCapital === 0) return 'Sin operaciones SPOT activas';
                                                        const progression = [0.2, 0.4, 0.6, 0.8, 1.0].map(ratio => `$${Math.round(spotCapital * ratio).toLocaleString()}`);
                                                        return `TP1: ${progression[0]} ‚Üí TP2: ${progression[1]} ‚Üí TP3: ${progression[2]} ‚Üí TP4: ${progression[3]} ‚Üí TP5: ${progression[4]}`;
                                                    })()
                                                )
                                            )
                                        ),
                                        
                                        React.createElement('p', { 
                                            style: { color: '#A8B2C1', fontSize: '0.9rem', lineHeight: '1.5' } 
                                        }, (() => {
                                            const hasSpot = spotOperations.length > 0;
                                            const hasFutures = operations.length > 0;
                                            
                                            if (!hasSpot && !hasFutures) {
                                                return 'Sin operaciones activas. El capital liberado aparecer√° cuando ejecutes TPs de operaciones abiertas.';
                                            } else if (hasSpot && hasFutures) {
                                                return 'El capital liberado te permite reinvertir progresivamente. La estrategia SPOT libera mayor capital absoluto, mientras que Futuros ofrece liberaci√≥n m√°s r√°pida proporcionalmente.';
                                            } else if (hasSpot) {
                                                return 'Tus operaciones SPOT liberar√°n capital progresivamente conforme ejecutes los Take Profits, sin riesgo de liquidaci√≥n.';
                                            } else {
                                                return 'Tus operaciones Futuros liberar√°n capital con apalancamiento, ofreciendo ROI m√°s eficiente pero con mayor riesgo.';
                                            }
                                        })())
                                    )
                                )
                            )
                        )
                    )
                );
            }

            // VISTA DASHBOARD
            return React.createElement('div', { style: styles.app },
                React.createElement('header', { style: styles.header },
                    React.createElement('div', { style: styles.headerContent },
                        React.createElement('div', { style: styles.headerLeft },
                            React.createElement('div', { style: styles.logo }, 'TP'),
                            React.createElement('h1', { style: styles.title }, 'Trading Manager Pro - AriParFue')
                        ),
                        React.createElement('div', { style: styles.headerRight },
                            React.createElement('button', {
                                onClick: checkAndFixOperations,
                                style: styles.fixBtn
                            }, 'üîß Revisar'),
                            React.createElement('button', {
                                onClick: () => setCurrentView('closed-operations'),
                                style: styles.closedOperationsBtn
                            }, 'üìã Historial'),
                            React.createElement('span', { style: styles.userEmail }, user.email),
                            React.createElement('span', { 
                                style: { 
                                    color: connectionStatus.includes('‚úÖ') ? '#88D498' : '#F4D896', 
                                    fontSize: '0.8rem'
                                } 
                            }, connectionStatus),
                            React.createElement('button', { 
                                onClick: handleLogout, 
                                style: styles.logoutBtn 
                            }, 'Salir')
                        )
                    )
                ),

                React.createElement('main', { style: styles.main },
                    React.createElement('div', { style: styles.metricsGrid },
                        React.createElement('div', { style: styles.metricCard },
                            React.createElement('div', { style: styles.metricLabel }, 'Capital Total'),
                            React.createElement('div', { style: styles.metricValue }, 
                                formatCurrency(portfolio.totalCapital)
                            )
                        ),
                        React.createElement('div', { style: styles.metricCard },
                            React.createElement('div', { style: styles.metricLabel }, 'Liquidez Disponible'),
                            React.createElement('div', { 
                                style: {...styles.metricValue, color: '#88D498'} 
                            }, formatCurrency(portfolio.availableLiquidity))
                        ),
                        React.createElement('div', { style: styles.metricCard },
                            React.createElement('div', { style: styles.metricLabel }, 'Capital Invertido'),
                            React.createElement('div', { 
                                style: {...styles.metricValue, color: '#7C9DD4'} 
                            }, formatCurrency(capitalInvertido))
                        ),
                        React.createElement('div', { style: styles.metricCard },
                            React.createElement('div', { style: styles.metricLabel }, 'Stop Danger Total'),
                            React.createElement('div', { 
                                style: {...styles.metricValue, color: '#F4D896'} 
                            }, formatCurrency(stopDangerTotal)),
                            React.createElement('div', { style: styles.metricSubtext }, 
                                'Capital necesario para 0 riesgo'
                            )
                        )
                    ),

                    React.createElement('div', { style: styles.operationsCard },
                        React.createElement('div', { style: styles.operationsHeader },
                            React.createElement('h2', { style: styles.sectionTitle }, 
                                'Operaciones Activas'
                            ),
                            React.createElement('div', { 
                                style: { display: 'flex', gap: '1rem', alignItems: 'center' }
                            },
                                React.createElement('button', {
                                    onClick: () => setCurrentView('visual-analytics'),
                                    style: {
                                        ...styles.newOperationBtn,
                                        backgroundColor: 'rgba(136, 212, 152, 0.15)',
                                        color: '#88D498',
                                        border: '1px solid rgba(136, 212, 152, 0.3)'
                                    }
                                }, 'üìä An√°lisis Visual'),
                                React.createElement('button', {
                                    onClick: () => setCurrentView(activeTab === 'futuros' ? 'new-operation' : 'new-spot-operation'),
                                    style: styles.newOperationBtn
                                }, '+ Nueva Operaci√≥n')
                            )
                        ),

                        // PESTA√ëAS
                        React.createElement('div', { style: styles.tabsContainer },
                            React.createElement('div', { style: styles.tabs },
                                React.createElement('button', {
                                    onClick: () => setActiveTab('futuros'),
                                    style: {
                                        ...styles.tab,
                                        ...(activeTab === 'futuros' ? styles.tabActive : {})
                                    }
                                }, `FUTUROS (${operations.length})`),
                                React.createElement('button', {
                                    onClick: () => setActiveTab('spot'),
                                    style: {
                                        ...styles.tab,
                                        ...(activeTab === 'spot' ? styles.tabActive : {})
                                    }
                                }, `SPOT (${spotOperations.length})`)
                            ),

                            // CONTENIDO TAB FUTUROS
                            activeTab === 'futuros' && React.createElement('div', { style: styles.tabContent },
                                operations.length === 0 ? 
                                    React.createElement('div', { style: styles.emptyState },
                                        React.createElement('div', { style: styles.emptyStateContent },
                                            React.createElement('h3', { style: styles.emptyStateTitle }, 
                                                'üöÄ Sin operaciones de Futuros'
                                            ),
                                            React.createElement('p', { style: styles.emptyStateText }, 
                                                'Crea tu primera operaci√≥n con apalancamiento para maximizar tu potencial.'
                                            )
                                        )
                                    ) :
                                    React.createElement('div', { style: styles.tableWrapper },
                                        React.createElement('table', { style: styles.table },
                                            React.createElement('thead', null,
                                                React.createElement('tr', { style: styles.tableHeaderRow },
                                                    React.createElement('th', { style: styles.th }, 'Crypto'),
                                                    React.createElement('th', { style: styles.th }, 'Tipo'),
                                                    React.createElement('th', { style: styles.th }, 'Operaci√≥n'),
                                                    React.createElement('th', { style: styles.th }, 'Palanca'),
                                                    React.createElement('th', { style: styles.th }, 'Capital'),
                                                    React.createElement('th', { style: styles.th }, 'Prestado'),
                                                    React.createElement('th', { style: styles.th }, 'Total'),
                                                    React.createElement('th', { style: styles.th }, 'Acciones')
                                                )
                                            ),
                                            React.createElement('tbody', null,
                                                operations.map((op) => {
                                                    return React.createElement('tr', { key: op.id, style: styles.tableRow },
                                                        React.createElement('td', { style: styles.td },
                                                            React.createElement('span', { style: styles.cryptoName }, op.crypto)
                                                        ),
                                                        React.createElement('td', { style: styles.td },
                                                            React.createElement('span', {
                                                                style: {
                                                                    ...styles.typeBadge,
                                                                    backgroundColor: op.type === 'LONG' ? 'rgba(136, 212, 152, 0.15)' : 'rgba(232, 155, 165, 0.15)',
                                                                    color: op.type === 'LONG' ? '#88D498' : '#E89BA5'
                                                                }
                                                            }, op.type)
                                                        ),
                                                        React.createElement('td', { style: styles.td },
                                                            React.createElement('span', {
                                                                style: {
                                                                    ...styles.operationBadge,
                                                                    backgroundColor: op.operationType === 'futuros' ? 'rgba(124, 157, 212, 0.15)' : 'rgba(244, 216, 150, 0.15)',
                                                                    color: op.operationType === 'futuros' ? '#7C9DD4' : '#F4D896'
                                                                }
                                                            }, op.operationType.charAt(0).toUpperCase() + op.operationType.slice(1))
                                                        ),
                                                        React.createElement('td', { style: styles.td }, op.leverage + 'x'),
                                                        React.createElement('td', { style: styles.td }, 
                                                            formatCurrency(op.ownCapital)
                                                        ),
                                                        React.createElement('td', { style: styles.td }, 
                                                            formatCurrency(op.borrowedCapital)
                                                        ),
                                                        React.createElement('td', { style: styles.td }, 
                                                            formatCurrency(op.totalInvestment)
                                                        ),
                                                        React.createElement('td', { style: styles.td },
                                                            React.createElement('div', { 
                                                                style: { display: 'flex', gap: '0.5rem', flexWrap: 'wrap' } 
                                                            },
                                                                React.createElement('button', {
                                                                    onClick: () => handleViewDetail(op),
                                                                    style: styles.actionBtn
                                                                }, 'Ver'),
                                                                user.role === 'admin' && React.createElement('button', {
                                                                    onClick: () => handleDeleteOperation(op.id),
                                                                    style: {...styles.actionBtn, backgroundColor: 'rgba(232, 155, 165, 0.15)', color: '#E89BA5'}
                                                                }, 'üóëÔ∏è')
                                                            )
                                                        )
                                                    );
                                                })
                                            )
                                        )
                                    )
                            ),

                            // CONTENIDO TAB SPOT
                            activeTab === 'spot' && React.createElement('div', { style: styles.tabContent },
                                spotOperations.length === 0 ? 
                                    React.createElement('div', { style: styles.emptyState },
                                        React.createElement('div', { style: styles.emptyStateContent },
                                            React.createElement('h3', { style: styles.emptyStateTitle }, 
                                                'üìà Sin operaciones SPOT'
                                            ),
                                            React.createElement('p', { style: styles.emptyStateText }, 
                                                'Crea tu primera operaci√≥n SPOT sin apalancamiento para empezar a construir tu portafolio.'
                                            )
                                        )
                                    ) :
                                    React.createElement('div', { style: styles.tableWrapper },
                                        React.createElement('table', { style: styles.table },
                                            React.createElement('thead', null,
                                                React.createElement('tr', { style: styles.tableHeaderRow },
                                                    React.createElement('th', { style: styles.th }, 'Crypto'),
                                                    React.createElement('th', { style: styles.th }, 'Tipo'),
                                                    React.createElement('th', { style: styles.th }, 'Operaci√≥n'),
                                                    React.createElement('th', { style: styles.th }, 'Capital'),
                                                    React.createElement('th', { style: styles.th }, 'Total'),
                                                    React.createElement('th', { style: styles.th }, 'Acciones')
                                                )
                                            ),
                                            React.createElement('tbody', null,
                                                spotOperations.map((operation) => {
                                                    return React.createElement('tr', { key: operation.id, style: styles.tableRow },
                                                        React.createElement('td', { style: styles.td },
                                                            React.createElement('span', { style: styles.cryptoName }, operation.crypto)
                                                        ),
                                                        React.createElement('td', { style: styles.td },
                                                            React.createElement('span', {
                                                                style: {
                                                                    ...styles.typeBadge,
                                                                    backgroundColor: operation.type === 'LONG' ? 'rgba(136, 212, 152, 0.15)' : 'rgba(232, 155, 165, 0.15)',
                                                                    color: operation.type === 'LONG' ? '#88D498' : '#E89BA5'
                                                                }
                                                            }, operation.type)
                                                        ),
                                                        React.createElement('td', { style: styles.td },
                                                            React.createElement('span', { style: styles.operationTypeBadge }, 'SPOT')
                                                        ),
                                                        React.createElement('td', { style: styles.td }, 
                                                            formatCurrency(operation.ownCapital + operation.additionalMargin)
                                                        ),
                                                        React.createElement('td', { style: styles.td }, 
                                                            formatCurrency(operation.totalInvestment + operation.additionalMargin)
                                                        ),
                                                        React.createElement('td', { style: styles.td },
                                                            React.createElement('div', { style: styles.actionButtons },
                                                                React.createElement('button', {
                                                                    onClick: () => handleViewSpotDetail(operation),
                                                                    style: styles.actionBtn
                                                                }, 'Ver'),
                                                                user.role === 'admin' && React.createElement('button', {
                                                                    onClick: () => handleDeleteSpotOperation(operation.id),
                                                                    style: {...styles.actionBtn, backgroundColor: 'rgba(232, 155, 165, 0.15)', color: '#E89BA5'}
                                                                }, 'üóëÔ∏è')
                                                            )
                                                        )
                                                    );
                                                })
                                            )
                                        )
                                    )
                            )
                        )
                    )
                )
            );
        }

        // ESTILOS PROFESIONALES
        const styles = {
            app: {
                minHeight: '100vh',
                backgroundColor: '#1a1d29',
                fontFamily: '-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif',
                color: '#E8ECEF',
            },
            loading: {
                minHeight: '100vh',
                display: 'flex',
                alignItems: 'center',
                justifyContent: 'center',
                backgroundColor: '#1a1d29',
                color: '#E8ECEF',
                fontSize: '1.25rem',
            },
            authContainer: {
                minHeight: '100vh',
                backgroundColor: '#1a1d29',
                display: 'flex',
                alignItems: 'center',
                justifyContent: 'center',
                padding: '2rem',
            },
            authCard: {
                backgroundColor: '#2d3142',
                borderRadius: '16px',
                padding: '3rem',
                border: '1px solid rgba(124, 157, 212, 0.2)',
                maxWidth: '450px',
                width: '100%',
            },
            authHeader: {
                textAlign: 'center',
                marginBottom: '2rem',
            },
            authTitle: {
                margin: '1rem 0 0 0',
                fontSize: '1.5rem',
                fontWeight: '600',
                color: '#E8ECEF',
            },
            authForm: {
                display: 'flex',
                flexDirection: 'column',
                gap: '1.5rem',
            },
            inputGroup: {
                display: 'flex',
                flexDirection: 'column',
                gap: '0.5rem',
            },
            authButton: {
                padding: '1rem',
                backgroundColor: '#7C9DD4',
                border: 'none',
                borderRadius: '8px',
                color: '#1a1d29',
                fontSize: '1rem',
                fontWeight: '600',
                cursor: 'pointer',
            },
            error: {
                padding: '1rem',
                backgroundColor: 'rgba(232, 155, 165, 0.15)',
                border: '1px solid rgba(232, 155, 165, 0.3)',
                borderRadius: '8px',
                color: '#E89BA5',
                fontSize: '0.9rem',
            },
            header: {
                backgroundColor: '#252936',
                borderBottom: '1px solid rgba(124, 157, 212, 0.1)',
                padding: '1.25rem 2rem',
                position: 'sticky',
                top: 0,
                zIndex: 100,
            },
            headerContent: {
                maxWidth: '1600px',
                margin: '0 auto',
                display: 'flex',
                justifyContent: 'space-between',
                alignItems: 'center',
                gap: '1rem',
            },
            headerLeft: {
                display: 'flex',
                alignItems: 'center',
                gap: '1rem',
            },
            headerRight: {
                display: 'flex',
                alignItems: 'center',
                gap: '1rem',
                flexWrap: 'wrap',
            },
            logo: {
                width: '40px',
                height: '40px',
                backgroundColor: '#7C9DD4',
                borderRadius: '8px',
                display: 'flex',
                alignItems: 'center',
                justifyContent: 'center',
                fontSize: '1.2rem',
                fontWeight: '700',
                color: '#1a1d29',
            },
            title: {
                margin: 0,
                fontSize: '1.25rem',
                fontWeight: '600',
                color: '#E8ECEF',
            },
            userEmail: {
                color: '#A8B2C1',
                fontSize: '0.9rem',
            },
            backBtn: {
                padding: '0.5rem 1rem',
                backgroundColor: 'transparent',
                border: '1px solid rgba(124, 157, 212, 0.3)',
                borderRadius: '6px',
                color: '#7C9DD4',
                cursor: 'pointer',
                fontSize: '0.85rem',
                fontWeight: '500',
            },
            logoutBtn: {
                padding: '0.5rem 1rem',
                backgroundColor: 'transparent',
                border: '1px solid rgba(232, 155, 165, 0.3)',
                borderRadius: '6px',
                color: '#E89BA5',
                cursor: 'pointer',
                fontSize: '0.85rem',
                fontWeight: '500',
            },
            main: {
                maxWidth: '1600px',
                margin: '0 auto',
                padding: '2rem',
            },
            metricsGrid: {
                display: 'grid',
                gridTemplateColumns: 'repeat(auto-fit, minmax(280px, 1fr))',
                gap: '1.25rem',
                marginBottom: '2rem',
            },
            metricCard: {
                backgroundColor: '#2d3142',
                borderRadius: '12px',
                padding: '1.5rem',
                border: '1px solid rgba(124, 157, 212, 0.08)',
            },
            metricLabel: {
                color: '#A8B2C1',
                fontSize: '0.85rem',
                fontWeight: '500',
                marginBottom: '0.5rem',
                textTransform: 'uppercase',
                letterSpacing: '0.5px',
            },
            metricValue: {
                color: '#E8ECEF',
                fontSize: '1.75rem',
                fontWeight: '600',
                marginBottom: '0.25rem',
            },
            metricSubtext: {
                color: '#A8B2C1',
                fontSize: '0.75rem',
                marginTop: '0.5rem',
            },
            operationsCard: {
                backgroundColor: '#2d3142',
                borderRadius: '12px',
                padding: '2rem',
                border: '1px solid rgba(124, 157, 212, 0.08)',
            },
            operationsHeader: {
                display: 'flex',
                justifyContent: 'space-between',
                alignItems: 'center',
                marginBottom: '1.5rem',
                flexWrap: 'wrap',
                gap: '1rem',
            },
            sectionTitle: {
                margin: 0,
                fontSize: '1.25rem',
                fontWeight: '600',
                color: '#E8ECEF',
            },
            newOperationBtn: {
                padding: '0.75rem 1.5rem',
                backgroundColor: '#7C9DD4',
                border: 'none',
                borderRadius: '8px',
                color: '#1a1d29',
                cursor: 'pointer',
                fontSize: '0.95rem',
                fontWeight: '600',
            },
            emptyState: {
                padding: '4rem 2rem',
                textAlign: 'center',
            },
            emptyStateContent: {
                maxWidth: '400px',
                margin: '0 auto',
            },
            emptyStateTitle: {
                color: '#E8ECEF',
                fontSize: '1.5rem',
                fontWeight: '600',
                marginBottom: '1rem',
            },
            emptyStateText: {
                color: '#A8B2C1',
                fontSize: '1rem',
                marginBottom: '1rem',
            },
            emptyStateBtn: {
                padding: '1rem 2rem',
                backgroundColor: '#7C9DD4',
                border: 'none',
                borderRadius: '8px',
                color: '#1a1d29',
                cursor: 'pointer',
                fontSize: '1rem',
                fontWeight: '600',
                marginTop: '1rem',
            },
            tableWrapper: {
                overflowX: 'auto',
                borderRadius: '8px',
            },
            table: {
                width: '100%',
                borderCollapse: 'collapse',
                minWidth: '600px',
            },
            tableHeaderRow: {
                backgroundColor: '#252936',
            },
            th: {
                padding: '0.875rem',
                textAlign: 'left',
                fontSize: '0.8rem',
                fontWeight: '600',
                color: '#A8B2C1',
                textTransform: 'uppercase',
                letterSpacing: '0.5px',
                borderBottom: '1px solid rgba(124, 157, 212, 0.1)',
            },
            tableRow: {
                borderBottom: '1px solid rgba(124, 157, 212, 0.05)',
            },
            td: {
                padding: '0.875rem',
                fontSize: '0.9rem',
                color: '#E8ECEF',
                verticalAlign: 'top',
            },
            cryptoName: {
                fontWeight: '700',
                color: '#7C9DD4',
                fontSize: '1rem',
            },
            typeBadge: {
                padding: '0.25rem 0.75rem',
                borderRadius: '6px',
                fontSize: '0.8rem',
                fontWeight: '600',
            },
            operationBadge: {
                padding: '0.25rem 0.75rem',
                borderRadius: '6px',
                fontSize: '0.75rem',
                fontWeight: '600',
            },
            actionBtn: {
                padding: '0.5rem 0.75rem',
                backgroundColor: 'rgba(124, 157, 212, 0.15)',
                border: '1px solid rgba(124, 157, 212, 0.3)',
                borderRadius: '6px',
                color: '#7C9DD4',
                cursor: 'pointer',
                fontSize: '0.8rem',
                fontWeight: '500',
            },
            
            // ESTILOS DE FORMULARIO
            formContainer: {
                display: 'flex',
                justifyContent: 'center',
            },
            formCard: {
                backgroundColor: '#2d3142',
                borderRadius: '12px',
                padding: '2.5rem',
                border: '1px solid rgba(124, 157, 212, 0.08)',
                width: '100%',
                maxWidth: '800px',
            },
            formTitle: {
                margin: '0 0 0.5rem 0',
                fontSize: '1.75rem',
                fontWeight: '600',
                color: '#E8ECEF',
            },
            formSubtitle: {
                margin: '0 0 2rem 0',
                color: '#A8B2C1',
                fontSize: '0.95rem',
            },
            form: {
                display: 'flex',
                flexDirection: 'column',
                gap: '1.5rem',
            },
            row: {
                display: 'grid',
                gridTemplateColumns: 'repeat(auto-fit, minmax(250px, 1fr))',
                gap: '1.5rem',
            },
            label: {
                color: '#A8B2C1',
                fontSize: '0.9rem',
                fontWeight: '500',
            },
            input: {
                padding: '0.875rem',
                backgroundColor: '#252936',
                border: '1px solid rgba(124, 157, 212, 0.2)',
                borderRadius: '8px',
                color: '#E8ECEF',
                fontSize: '0.95rem',
                outline: 'none',
                width: '100%',
                boxSizing: 'border-box',
            },
            select: {
                padding: '0.875rem',
                backgroundColor: '#252936',
                border: '1px solid rgba(124, 157, 212, 0.2)',
                borderRadius: '8px',
                color: '#E8ECEF',
                fontSize: '0.95rem',
                outline: 'none',
                cursor: 'pointer',
                width: '100%',
                boxSizing: 'border-box',
            },
            previewBox: {
                backgroundColor: 'rgba(124, 157, 212, 0.08)',
                border: '1px solid rgba(124, 157, 212, 0.2)',
                borderRadius: '10px',
                padding: '1.5rem',
            },
            previewTitle: {
                margin: '0 0 1rem 0',
                color: '#7C9DD4',
                fontSize: '1rem',
                fontWeight: '600',
            },
            previewGrid: {
                display: 'grid',
                gridTemplateColumns: 'repeat(auto-fit, minmax(200px, 1fr))',
                gap: '1rem',
            },
            previewItem: {
                display: 'flex',
                justifyContent: 'space-between',
                alignItems: 'center',
            },
            previewLabel: {
                color: '#A8B2C1',
                fontSize: '0.9rem',
            },
            previewValue: {
                color: '#E8ECEF',
                fontSize: '0.95rem',
                fontWeight: '600',
            },
            formActions: {
                display: 'flex',
                gap: '1rem',
                marginTop: '1rem',
                paddingTop: '1.5rem',
                borderTop: '1px solid rgba(124, 157, 212, 0.1)',
            },
            cancelBtn: {
                flex: 1,
                padding: '0.875rem',
                backgroundColor: 'transparent',
                border: '1px solid rgba(168, 178, 193, 0.3)',
                borderRadius: '8px',
                color: '#A8B2C1',
                cursor: 'pointer',
                fontSize: '0.95rem',
                fontWeight: '500',
            },
            submitBtn: {
                flex: 2,
                padding: '0.875rem',
                backgroundColor: '#7C9DD4',
                border: 'none',
                borderRadius: '8px',
                color: '#1a1d29',
                cursor: 'pointer',
                fontSize: '0.95rem',
                fontWeight: '600',
            },

            // ESTILOS PARA VER DETALLE
            detailContainer: {
                display: 'flex',
                justifyContent: 'center',
            },
            detailCard: {
                backgroundColor: '#2d3142',
                borderRadius: '12px',
                padding: '2.5rem',
                border: '1px solid rgba(124, 157, 212, 0.08)',
                width: '100%',
                maxWidth: '900px',
            },
            detailHeader: {
                marginBottom: '2rem',
                paddingBottom: '1.5rem',
                borderBottom: '1px solid rgba(124, 157, 212, 0.1)',
            },
            detailTitle: {
                margin: '0 0 1rem 0',
                fontSize: '2rem',
                fontWeight: '700',
                color: '#E8ECEF',
            },
            detailBadges: {
                display: 'flex',
                gap: '0.75rem',
                flexWrap: 'wrap',
            },
            detailBadge: {
                padding: '0.375rem 0.875rem',
                borderRadius: '6px',
                fontSize: '0.85rem',
                fontWeight: '600',
                backgroundColor: 'rgba(124, 157, 212, 0.15)',
                color: '#7C9DD4',
            },
            detailInfo: {
                marginBottom: '2rem',
            },
            infoGrid: {
                display: 'grid',
                gridTemplateColumns: 'repeat(auto-fit, minmax(250px, 1fr))',
                gap: '1.5rem',
            },
            infoItem: {
                display: 'flex',
                justifyContent: 'space-between',
                alignItems: 'center',
                padding: '1rem',
                backgroundColor: '#252936',
                borderRadius: '8px',
                border: '1px solid rgba(124, 157, 212, 0.1)',
            },
            infoLabel: {
                color: '#A8B2C1',
                fontSize: '0.9rem',
                fontWeight: '500',
            },
            infoValue: {
                color: '#E8ECEF',
                fontSize: '1rem',
                fontWeight: '600',
            },
            detailActions: {
                paddingTop: '1.5rem',
                borderTop: '1px solid rgba(124, 157, 212, 0.1)',
                textAlign: 'center',
            },
            primaryBtn: {
                padding: '0.875rem 2rem',
                backgroundColor: '#7C9DD4',
                border: 'none',
                borderRadius: '8px',
                color: '#1a1d29',
                cursor: 'pointer',
                fontSize: '1rem',
                fontWeight: '600',
            },

            // ESTILOS ADICIONALES PARA VER DETALLE
            advancedMetrics: {
                marginBottom: '2rem',
            },
            sectionTitle: {
                margin: '0 0 1rem 0',
                fontSize: '1.1rem',
                fontWeight: '600',
                color: '#E8ECEF',
            },
            metricsGrid: {
                display: 'grid',
                gridTemplateColumns: 'repeat(auto-fit, minmax(200px, 1fr))',
                gap: '1rem',
            },
            metricItem: {
                display: 'flex',
                flexDirection: 'column',
                gap: '0.5rem',
                padding: '1rem',
                backgroundColor: '#252936',
                borderRadius: '8px',
                border: '1px solid rgba(124, 157, 212, 0.1)',
            },
            metricLabel: {
                color: '#A8B2C1',
                fontSize: '0.8rem',
                fontWeight: '500',
                textTransform: 'uppercase',
                letterSpacing: '0.5px',
            },
            metricValue: {
                color: '#E8ECEF',
                fontSize: '1.1rem',
                fontWeight: '600',
            },
            entriesSection: {
                marginBottom: '2rem',
            },
            entriesHeader: {
                display: 'flex',
                justifyContent: 'space-between',
                alignItems: 'center',
                marginBottom: '1.5rem',
                flexWrap: 'wrap',
                gap: '1rem',
            },
            addEntryBtn: {
                padding: '0.6rem 1.25rem',
                backgroundColor: '#88D498',
                border: 'none',
                borderRadius: '6px',
                color: '#1a1d29',
                cursor: 'pointer',
                fontSize: '0.9rem',
                fontWeight: '600',
            },
            emptyEntries: {
                padding: '2rem',
                textAlign: 'center',
                color: '#A8B2C1',
                backgroundColor: '#252936',
                borderRadius: '8px',
                border: '1px solid rgba(124, 157, 212, 0.1)',
            },
            entriesTable: {
                overflowX: 'auto',
                borderRadius: '8px',
            },

            // ESTILOS FORMULARIO AGREGAR ENTRADA
            addEntryForm: {
                marginTop: '2rem',
                padding: '1.5rem',
                backgroundColor: 'rgba(124, 157, 212, 0.08)',
                border: '1px solid rgba(124, 157, 212, 0.2)',
                borderRadius: '10px',
            },
            formTitle: {
                margin: '0 0 1rem 0',
                fontSize: '1rem',
                fontWeight: '600',
                color: '#7C9DD4',
            },
            entryForm: {
                display: 'flex',
                flexDirection: 'column',
                gap: '1.5rem',
            },
            formRow: {
                display: 'grid',
                gridTemplateColumns: 'repeat(auto-fit, minmax(200px, 1fr))',
                gap: '1rem',
            },
            entryPreview: {
                padding: '1rem',
                backgroundColor: 'rgba(136, 212, 152, 0.08)',
                border: '1px solid rgba(136, 212, 152, 0.2)',
                borderRadius: '8px',
            },
            previewTitle: {
                margin: '0 0 0.75rem 0',
                fontSize: '0.9rem',
                fontWeight: '600',
                color: '#88D498',
            },
            previewRow: {
                display: 'flex',
                justifyContent: 'space-between',
                alignItems: 'center',
                marginBottom: '0.5rem',
            },
            previewLabel: {
                color: '#A8B2C1',
                fontSize: '0.85rem',
            },
            previewValue: {
                color: '#E8ECEF',
                fontSize: '0.85rem',
                fontWeight: '600',
            },
            saveEntryBtn: {
                flex: 2,
                padding: '0.75rem',
                backgroundColor: '#88D498',
                border: 'none',
                borderRadius: '6px',
                color: '#1a1d29',
                cursor: 'pointer',
                fontSize: '0.9rem',
                fontWeight: '600',
            },

            // ESTILOS TAKE PROFITS
            tpSection: {
                marginBottom: '2rem',
            },
            tpHeader: {
                display: 'flex',
                justifyContent: 'space-between',
                alignItems: 'center',
                marginBottom: '1.5rem',
                flexWrap: 'wrap',
                gap: '1rem',
            },
            configureTPBtn: {
                padding: '0.6rem 1.25rem',
                backgroundColor: '#F4D896',
                border: 'none',
                borderRadius: '6px',
                color: '#1a1d29',
                cursor: 'pointer',
                fontSize: '0.9rem',
                fontWeight: '600',
            },
            tpGrid: {
                display: 'grid',
                gridTemplateColumns: 'repeat(auto-fit, minmax(200px, 1fr))',
                gap: '1rem',
            },
            tpCard: {
                padding: '1rem',
                borderRadius: '8px',
                border: '1px solid',
                position: 'relative',
            },
            tpNumber: {
                fontSize: '0.9rem',
                fontWeight: '700',
                color: '#7C9DD4',
            },
            executedBadge: {
                fontSize: '0.75rem',
                color: '#88D498',
                fontWeight: '600',
            },
            tpInfo: {
                marginTop: '0.75rem',
                display: 'flex',
                flexDirection: 'column',
                gap: '0.5rem',
            },
            tpRow: {
                display: 'flex',
                justifyContent: 'space-between',
                alignItems: 'center',
            },
            tpLabel: {
                color: '#A8B2C1',
                fontSize: '0.8rem',
            },
            tpValue: {
                color: '#E8ECEF',
                fontSize: '0.85rem',
                fontWeight: '600',
            },
            tpEmpty: {
                marginTop: '0.75rem',
                textAlign: 'center',
                padding: '1rem 0',
            },
            tpEmptyText: {
                color: '#A8B2C1',
                fontSize: '0.8rem',
                fontStyle: 'italic',
            },

            // ESTILOS CONFIGURACI√ìN TPs
            tpConfigForm: {
                marginTop: '2rem',
                padding: '1.5rem',
                backgroundColor: 'rgba(244, 216, 150, 0.08)',
                border: '1px solid rgba(244, 216, 150, 0.2)',
                borderRadius: '10px',
            },
            configFormTitle: {
                margin: '0 0 0.5rem 0',
                fontSize: '1.1rem',
                fontWeight: '600',
                color: '#F4D896',
            },
            configFormSubtitle: {
                margin: '0 0 1.5rem 0',
                color: '#A8B2C1',
                fontSize: '0.9rem',
            },
            tpConfigGrid: {
                display: 'grid',
                gridTemplateColumns: 'repeat(auto-fit, minmax(200px, 1fr))',
                gap: '1rem',
                marginBottom: '1.5rem',
            },
            tpConfigCard: {
                padding: '1rem',
                backgroundColor: '#252936',
                borderRadius: '8px',
                border: '1px solid rgba(124, 157, 212, 0.1)',
            },
            tpConfigTitle: {
                margin: '0 0 1rem 0',
                fontSize: '0.9rem',
                fontWeight: '700',
                color: '#7C9DD4',
                textAlign: 'center',
            },
            tpConfigInputs: {
                display: 'flex',
                flexDirection: 'column',
                gap: '1rem',
            },
            tpConfigActions: {
                display: 'flex',
                gap: '1rem',
                paddingTop: '1rem',
                borderTop: '1px solid rgba(244, 216, 150, 0.2)',
            },
            saveTPsBtn: {
                flex: 2,
                padding: '0.75rem',
                backgroundColor: '#F4D896',
                border: 'none',
                borderRadius: '6px',
                color: '#1a1d29',
                cursor: 'pointer',
                fontSize: '0.9rem',
                fontWeight: '600',
            },

            // ESTILOS EJECUCI√ìN TPs
            tpProfitInfo: {
                marginTop: '0.75rem',
                paddingTop: '0.75rem',
                borderTop: '1px solid rgba(124, 157, 212, 0.1)',
            },
            executeTPBtn: {
                marginTop: '0.75rem',
                padding: '0.6rem',
                backgroundColor: '#88D498',
                border: 'none',
                borderRadius: '6px',
                color: '#1a1d29',
                cursor: 'pointer',
                fontSize: '0.8rem',
                fontWeight: '600',
                width: '100%',
            },
            executedInfo: {
                marginTop: '0.5rem',
                paddingTop: '0.5rem',
                borderTop: '1px solid rgba(136, 212, 152, 0.2)',
            },

            // ESTILOS OPERACIONES CERRADAS
            fixBtn: {
                padding: '0.5rem 1rem',
                backgroundColor: 'transparent',
                border: '1px solid rgba(244, 216, 150, 0.3)',
                borderRadius: '6px',
                color: '#F4D896',
                cursor: 'pointer',
                fontSize: '0.85rem',
                fontWeight: '500',
            },
            closedOperationsBtn: {
                padding: '0.5rem 1rem',
                backgroundColor: 'transparent',
                border: '1px solid rgba(124, 157, 212, 0.3)',
                borderRadius: '6px',
                color: '#7C9DD4',
                cursor: 'pointer',
                fontSize: '0.85rem',
                fontWeight: '500',
            },
            closedBadge: {
                padding: '0.25rem 0.75rem',
                borderRadius: '6px',
                fontSize: '0.8rem',
                fontWeight: '600',
                backgroundColor: 'rgba(136, 212, 152, 0.15)',
                color: '#88D498',
            },

            // ESTILOS DETALLE OPERACI√ìN CERRADA
            finalSummary: {
                marginBottom: '2rem',
                padding: '1.5rem',
                backgroundColor: 'rgba(136, 212, 152, 0.05)',
                borderRadius: '10px',
                border: '1px solid rgba(136, 212, 152, 0.2)',
            },
            summaryGrid: {
                display: 'grid',
                gridTemplateColumns: 'repeat(auto-fit, minmax(200px, 1fr))',
                gap: '1rem',
            },
            summaryItem: {
                display: 'flex',
                flexDirection: 'column',
                gap: '0.5rem',
                padding: '1rem',
                backgroundColor: '#252936',
                borderRadius: '8px',
            },
            summaryLabel: {
                color: '#A8B2C1',
                fontSize: '0.8rem',
                fontWeight: '500',
                textTransform: 'uppercase',
                letterSpacing: '0.5px',
            },
            summaryValue: {
                color: '#E8ECEF',
                fontSize: '1rem',
                fontWeight: '600',
            },

            // ESTILOS GESTI√ìN DE MARGEN
            marginSection: {
                marginBottom: '2rem',
                padding: '1.5rem',
                backgroundColor: 'rgba(244, 216, 150, 0.05)',
                borderRadius: '10px',
                border: '1px solid rgba(244, 216, 150, 0.2)',
            },
            marginHeader: {
                display: 'flex',
                justifyContent: 'space-between',
                alignItems: 'center',
                marginBottom: '1.5rem',
                flexWrap: 'wrap',
                gap: '1rem',
            },
            addMarginBtn: {
                padding: '0.6rem 1.25rem',
                backgroundColor: '#F4D896',
                border: 'none',
                borderRadius: '6px',
                color: '#1a1d29',
                cursor: 'pointer',
                fontSize: '0.9rem',
                fontWeight: '600',
            },
            marginButtons: {
                display: 'flex',
                gap: '1rem',
                flexWrap: 'wrap',
            },
            removeMarginBtn: {
                padding: '0.6rem 1.25rem',
                backgroundColor: 'transparent',
                border: '1px solid #E89BA5',
                borderRadius: '6px',
                color: '#E89BA5',
                cursor: 'pointer',
                fontSize: '0.9rem',
                fontWeight: '600',
            },
            marginInfo: {
                marginBottom: '1rem',
            },
            marginGrid: {
                display: 'grid',
                gridTemplateColumns: 'repeat(auto-fit, minmax(180px, 1fr))',
                gap: '1rem',
            },
            marginItem: {
                display: 'flex',
                flexDirection: 'column',
                gap: '0.5rem',
                padding: '1rem',
                backgroundColor: '#252936',
                borderRadius: '8px',
            },
            marginLabel: {
                color: '#A8B2C1',
                fontSize: '0.8rem',
                fontWeight: '500',
            },
            marginValue: {
                color: '#E8ECEF',
                fontSize: '1rem',
                fontWeight: '600',
            },
            addMarginForm: {
                marginTop: '1.5rem',
                padding: '1.5rem',
                backgroundColor: 'rgba(244, 216, 150, 0.08)',
                borderRadius: '8px',
                border: '1px solid rgba(244, 216, 150, 0.3)',
            },
            formTitle: {
                margin: '0 0 0.5rem 0',
                fontSize: '1.1rem',
                fontWeight: '600',
                color: '#F4D896',
            },
            formSubtitle: {
                margin: '0 0 1.5rem 0',
                color: '#A8B2C1',
                fontSize: '0.9rem',
            },
            marginForm: {
                display: 'flex',
                flexDirection: 'column',
                gap: '1rem',
            },
            marginPreview: {
                padding: '1rem',
                backgroundColor: '#252936',
                borderRadius: '8px',
                border: '1px solid rgba(124, 157, 212, 0.2)',
            },
            previewTitle: {
                margin: '0 0 1rem 0',
                fontSize: '0.9rem',
                fontWeight: '600',
                color: '#7C9DD4',
            },
            previewInfo: {
                display: 'flex',
                flexDirection: 'column',
                gap: '0.75rem',
            },
            previewRow: {
                display: 'flex',
                justifyContent: 'space-between',
                alignItems: 'center',
            },
            previewLabel: {
                color: '#A8B2C1',
                fontSize: '0.8rem',
            },
            previewValue: {
                color: '#E8ECEF',
                fontSize: '0.85rem',
                fontWeight: '600',
            },
            formActions: {
                display: 'flex',
                gap: '1rem',
                paddingTop: '1rem',
                borderTop: '1px solid rgba(244, 216, 150, 0.2)',
            },
            addMarginSubmitBtn: {
                flex: 2,
                padding: '0.75rem',
                backgroundColor: '#F4D896',
                border: 'none',
                borderRadius: '6px',
                color: '#1a1d29',
                cursor: 'pointer',
                fontSize: '0.9rem',
                fontWeight: '600',
            },

            // ESTILOS QUITAR MARGEN
            removeMarginForm: {
                marginTop: '1.5rem',
                padding: '1.5rem',
                backgroundColor: 'rgba(232, 155, 165, 0.08)',
                borderRadius: '8px',
                border: '1px solid rgba(232, 155, 165, 0.3)',
            },
            removeMarginPreview: {
                padding: '1rem',
                backgroundColor: '#252936',
                borderRadius: '8px',
                border: '1px solid rgba(232, 155, 165, 0.2)',
            },
            removeMarginSubmitBtn: {
                flex: 2,
                padding: '0.75rem',
                backgroundColor: '#E89BA5',
                border: 'none',
                borderRadius: '6px',
                color: '#1a1d29',
                cursor: 'pointer',
                fontSize: '0.9rem',
                fontWeight: '600',
            },

            // ESTILOS SPOT TRADING
            spotBtn: {
                padding: '0.5rem 1rem',
                backgroundColor: '#88D498',
                border: 'none',
                borderRadius: '6px',
                color: '#1a1d29',
                cursor: 'pointer',
                fontSize: '0.85rem',
                fontWeight: '600',
            },
            spotInfo: {
                padding: '1rem',
                backgroundColor: 'rgba(136, 212, 152, 0.08)',
                borderRadius: '8px',
                border: '1px solid rgba(136, 212, 152, 0.2)',
                marginBottom: '1rem',
            },
            infoTitle: {
                margin: '0 0 1rem 0',
                fontSize: '1rem',
                fontWeight: '600',
                color: '#88D498',
            },
            infoGrid: {
                display: 'grid',
                gridTemplateColumns: 'repeat(auto-fit, minmax(200px, 1fr))',
                gap: '0.75rem',
            },
            infoItem: {
                display: 'flex',
                justifyContent: 'space-between',
                alignItems: 'center',
            },
            infoLabel: {
                color: '#A8B2C1',
                fontSize: '0.8rem',
            },
            infoValue: {
                color: '#E8ECEF',
                fontSize: '0.8rem',
                fontWeight: '600',
            },
            spotPreview: {
                padding: '1rem',
                backgroundColor: '#252936',
                borderRadius: '8px',
                border: '1px solid rgba(136, 212, 152, 0.2)',
                marginBottom: '1rem',
            },

            // ESTILOS PESTA√ëAS
            tabsContainer: {
                marginBottom: '2rem',
            },
            tabs: {
                display: 'flex',
                gap: 0,
                background: 'rgba(26, 29, 41, 0.5)',
                borderRadius: '8px',
                padding: '4px',
                marginBottom: '1.5rem',
            },
            tab: {
                flex: 1,
                padding: '0.75rem 1.5rem',
                background: 'transparent',
                border: 'none',
                borderRadius: '6px',
                color: '#A8B2C1',
                fontWeight: '500',
                cursor: 'pointer',
                transition: 'all 0.2s',
            },
            tabActive: {
                background: 'rgba(124, 157, 212, 0.15)',
                color: '#7C9DD4',
                fontWeight: '600',
            },
            tabContent: {
                // Content is shown/hidden via conditional rendering
            },
            
            // ESTILOS BOTONES DE ACCI√ìN
            actionButtons: {
                display: 'flex',
                gap: '0.5rem',
                flexWrap: 'wrap'
            },

            // ESTILOS SELECTOR DE TIPO DE OPERACI√ìN
            operationTypeSelector: {
                marginBottom: '2rem'
            },
            typeToggle: {
                display: 'grid',
                gridTemplateColumns: '1fr 1fr',
                gap: '1rem',
                marginTop: '0.5rem'
            },
            typeOption: {
                display: 'flex',
                alignItems: 'center',
                gap: '1rem',
                padding: '1.5rem',
                background: 'rgba(37, 41, 54, 0.6)',
                border: '1px solid rgba(168, 178, 193, 0.1)',
                borderRadius: '12px',
                cursor: 'pointer',
                transition: 'all 0.2s ease',
                textAlign: 'left'
            },
            typeOptionActive: {
                background: 'rgba(124, 157, 212, 0.08)',
                borderColor: 'rgba(124, 157, 212, 0.3)',
                transform: 'translateY(-2px)',
                boxShadow: '0 4px 12px rgba(124, 157, 212, 0.1)'
            },
            typeIcon: {
                fontSize: '2rem',
                minWidth: '3rem',
                textAlign: 'center'
            },
            typeTitle: {
                fontSize: '1.1rem',
                fontWeight: '600',
                color: '#E8ECEF',
                marginBottom: '0.25rem'
            },
            typeDescription: {
                fontSize: '0.9rem',
                color: '#A8B2C1'
            },
            dynamicForm: {
                textAlign: 'center',
                padding: '2rem',
                background: 'rgba(37, 41, 54, 0.3)',
                borderRadius: '12px',
                marginTop: '2rem'
            },
            operationInfo: {
                color: '#A8B2C1',
                fontSize: '1rem',
                marginBottom: '2rem',
                lineHeight: '1.5'
            },
            continueBtn: {
                padding: '1rem 2rem',
                background: 'linear-gradient(135deg, #7C9DD4, #88D498)',
                border: 'none',
                borderRadius: '8px',
                color: '#1a1d29',
                fontSize: '1rem',
                fontWeight: '600',
                cursor: 'pointer',
                transition: 'transform 0.2s',
                minWidth: '200px'
            },
        };

        ReactDOM.render(React.createElement(TradingApp), document.getElementById('root'));
        
        // Chart initialization for Visual Analytics page
        let analyticsCharts = {};
        
        const initAnalyticsCharts = () => {
            if (document.getElementById('distributionChart')) {
                console.log('üìä Initializing Analytics Charts...');
                
                // Destroy existing charts first
                Object.keys(analyticsCharts).forEach(key => {
                    if (analyticsCharts[key]) {
                        analyticsCharts[key].destroy();
                        delete analyticsCharts[key];
                    }
                });

                Chart.defaults.color = '#A8B2C1';
                Chart.defaults.borderColor = 'rgba(168, 178, 193, 0.1)';
                
                // CHART 1: Distribution
                const ctx1 = document.getElementById('distributionChart');
                if (ctx1) {
                    analyticsCharts.distribution = new Chart(ctx1, {
                        type: 'doughnut',
                        data: {
                            labels: ['SPOT', 'Futuros', 'Liquidez'],
                            datasets: [{
                                data: [
                                    spotOperations.reduce((sum, op) => sum + op.ownCapital + op.additionalMargin, 0), // SPOT capital
                                    operations.reduce((sum, op) => sum + op.ownCapital + op.additionalMargin, 0),     // Futuros capital  
                                    portfolio.availableLiquidity                                                        // Available liquidity
                                ],
                                backgroundColor: ['rgba(136, 212, 152, 0.8)', 'rgba(124, 157, 212, 0.8)', 'rgba(168, 178, 193, 0.6)'],
                                borderColor: ['#88D498', '#7C9DD4', '#A8B2C1'],
                                borderWidth: 2,
                                cutout: '65%'
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: { 
                                legend: { display: false },
                                tooltip: {
                                    backgroundColor: 'rgba(37, 41, 54, 0.95)',
                                    titleColor: '#E8ECEF',
                                    bodyColor: '#A8B2C1',
                                    borderColor: 'rgba(124, 157, 212, 0.3)',
                                    borderWidth: 1,
                                    cornerRadius: 8
                                }
                            }
                        }
                    });
                }
                
                // CHART 2: TP Profits  
                const ctx2 = document.getElementById('profitsChart');
                if (ctx2) {
                    analyticsCharts.profits = new Chart(ctx2, {
                        type: 'bar',
                        data: {
                            labels: ['TP1', 'TP2', 'TP3', 'TP4', 'TP5'],
                            datasets: [{
                                label: 'Futuros',
                                data: [250, 400, 600, 800, 1200],
                                backgroundColor: 'rgba(124, 157, 212, 0.8)',
                                borderColor: '#7C9DD4',
                                borderWidth: 1,
                                borderRadius: 4
                            }, {
                                label: 'SPOT',
                                data: [625, 1250, 2000, 2750, 3750],
                                backgroundColor: 'rgba(136, 212, 152, 0.8)',
                                borderColor: '#88D498',
                                borderWidth: 1,
                                borderRadius: 4
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: { 
                                legend: { 
                                    display: true, 
                                    position: 'top',
                                    labels: { color: '#E8ECEF', usePointStyle: true, padding: 15, font: { size: 10 } }
                                }
                            },
                            scales: {
                                x: { grid: { display: false }, ticks: { color: '#A8B2C1', font: { size: 10 } } },
                                y: { 
                                    grid: { color: 'rgba(168, 178, 193, 0.1)' },
                                    ticks: { 
                                        color: '#A8B2C1',
                                        font: { size: 10 },
                                        callback: function(value) { return '$' + value; }
                                    }
                                }
                            }
                        }
                    });
                }
                
                // CHART 3: Capital Released
                const ctx3 = document.getElementById('releasedChart');
                if (ctx3) {
                    analyticsCharts.released = new Chart(ctx3, {
                        type: 'line',
                        data: {
                            labels: ['Inicio', 'TP1', 'TP2', 'TP3', 'TP4', 'TP5'],
                            datasets: [{
                                label: 'Futuros',
                                data: [0, 200, 400, 600, 800, 1000],
                                borderColor: '#7C9DD4',
                                backgroundColor: 'rgba(124, 157, 212, 0.2)',
                                fill: true,
                                tension: 0.4,
                                borderWidth: 2,
                                pointRadius: 3
                            }, {
                                label: 'SPOT',
                                data: [0, 2500, 5000, 7500, 10000, 12500],
                                borderColor: '#88D498', 
                                backgroundColor: 'rgba(136, 212, 152, 0.2)',
                                fill: true,
                                tension: 0.4,
                                borderWidth: 2,
                                pointRadius: 3
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: { 
                                legend: { 
                                    display: true, 
                                    position: 'top',
                                    labels: { color: '#E8ECEF', usePointStyle: true, padding: 15, font: { size: 10 } }
                                }
                            },
                            scales: {
                                x: { grid: { color: 'rgba(168, 178, 193, 0.1)' }, ticks: { color: '#A8B2C1', font: { size: 10 } } },
                                y: { 
                                    grid: { color: 'rgba(168, 178, 193, 0.1)' },
                                    ticks: { 
                                        color: '#A8B2C1',
                                        font: { size: 10 },
                                        callback: function(value) { return '$' + value.toLocaleString(); }
                                    }
                                }
                            }
                        }
                    });
                }
                
                console.log('‚úÖ Analytics Charts initialized successfully');
            }
        };
        
        // Check for analytics page and initialize charts
        let lastAnalyticsCheck = false;
        setInterval(() => {
            const isAnalytics = !!document.getElementById('distributionChart');
            // Only initialize if we just arrived at analytics page (state changed)
            if (isAnalytics && !lastAnalyticsCheck) {
                setTimeout(initAnalyticsCharts, 300);
            }
            lastAnalyticsCheck = isAnalytics;
        }, 500);
    </script>
</body>
</html>
